"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[3256],{68895:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>c,frontMatter:()=>t,metadata:()=>l,toc:()=>u});var r=s(74848),i=s(28453);const t={title:"La m\xe9moire virtuelle"},a=void 0,l={id:"enseirb/s7/prog_sys/8",title:"La m\xe9moire virtuelle",description:"Les m\xe9thodes de gestion m\xe9moire que nous venons de voir ont toutes un d\xe9faut",source:"@site/docs/enseirb/s7/prog_sys/8.md",sourceDirName:"enseirb/s7/prog_sys",slug:"/enseirb/s7/prog_sys/8",permalink:"/pr-preview/pr-12/docs/enseirb/s7/prog_sys/8",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"La m\xe9moire virtuelle"},sidebar:"tutorialSidebar",previous:{title:"La m\xe9moire",permalink:"/pr-preview/pr-12/docs/enseirb/s7/prog_sys/7"},next:{title:"Tubes et tubes nomm\xe9s",permalink:"/pr-preview/pr-12/docs/enseirb/s7/prog_sys/9"}},o={},u=[{value:"Les overlays",id:"les-overlays",level:3},{value:"Le chargement dynamique",id:"le-chargement-dynamique",level:3},{value:"Demande Paging",id:"demande-paging",level:2},{value:"Efficacit\xe9",id:"efficacit\xe9",level:3},{value:"Allocation de pages aux processus",id:"allocation-de-pages-aux-processus",level:2},{value:"L&#39;appel fork et la m\xe9moire virtuelle",id:"lappel-fork-et-la-m\xe9moire-virtuelle",level:2},{value:"Projection de fichiers en m\xe9moire",id:"projection-de-fichiers-en-m\xe9moire",level:2},{value:"Les conseils et politiques de chargement des zonnes mmap\xe9s",id:"les-conseils-et-politiques-de-chargement-des-zonnes-mmap\xe9s",level:2},{value:"Chargement dynamique",id:"chargement-dynamique",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Les m\xe9thodes de gestion m\xe9moire que nous venons de voir ont toutes un d\xe9faut\nmajeur qui est de garder l'ensemble du processus en m\xe9moire, ce qui donne :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"un co\xfbt en swap important"}),"\n",(0,r.jsx)(n.li,{children:"impossibilit\xe9 de cr\xe9er de tr\xe8s gros processus"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Les m\xe9thodes de m\xe9moire virtuelle permettent d'ex\xe9cuter un programme qui ne\ntient pas enti\xe8rement en m\xe9moire centrale ! Nous avons commenc\xe9 par pr\xe9senter\ndes algorithmes de gestion de la m\xe9moire qui utilisent le concept de base\nsuivante : l'ensemble de l'espace logique adressable d'un processus doit \xeatre en\nm\xe9moire pour pouvoir ex\xe9cuter le processus."}),"\n",(0,r.jsx)(n.p,{children:"Cette restriction semble \xe0 la fois raisonnable et n\xe9cessaire, mais aussi tr\xe8s\ndommageable car cela limite la taille des processus \xe0 la taille de la m\xe9moire\nphysique."}),"\n",(0,r.jsx)(n.p,{children:"Or si l'on regarde des programmes tr\xe8s standards, on voit que :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"il y a des portions de code qui g\xe8rent des cas tr\xe8s inhabituels qui ont lieu\ntr\xe8s rarement (si ils ont lieu)"}),"\n",(0,r.jsx)(n.li,{children:"les tableaux, les listes et autre tables sont en g\xe9n\xe9ral initialis\xe9s \xe0 des\ntailles beaucoup plus grandes que ce qui est r\xe9ellement utile"}),"\n",(0,r.jsx)(n.li,{children:"Certaines options d'application sont tr\xe8s rarement utilis\xe9es"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"M\xeame dans le cas o\xf9 le programme en entier doit r\xe9sider en m\xe9moire, tout n'est\npeut-\xeatre pas absolument n\xe9cessaire en m\xeame temps. Avec la m\xe9moire virtuelle, la\nm\xe9moire logique devient beaucoup plus grande que la m\xe9moire physique."}),"\n",(0,r.jsx)(n.p,{children:"Cela implique de nombreux avantages : comme les utilisateurs consomment\nindividuellement moins de m\xe9moire, plus d'utilisateurs peuvent travailler en\nm\xeame temps. Avec l'augmentation de l'utilisation du CPU et de d\xe9bit que cela\nimplique (mais pas d'augmentation de la vitesse). Moins d'entr\xe9es-sorties sont\neffectu\xe9es pour l'ex\xe9cution d'un processus, ce qui fait que le processus\ns'ex\xe9cute (temps r\xe9el) plus rapidement."}),"\n",(0,r.jsx)(n.h3,{id:"les-overlays",children:"Les overlays"}),"\n",(0,r.jsx)(n.p,{children:"Une des premi\xe8res versions d'ex\xe9cutable partiellement en m\xe9moire est celle des\n\"overlay\" qui est l'id\xe9e de charger successivement des portions disjointes et\ndiff\xe9rentes de code en m\xe9moire, ex\xe9cut\xe9es l'une apr\xe8s l'autre. Les diff\xe9rentes\npasses d'un compilateur sont souvent r\xe9alis\xe9es en utilisant un overlay. Les\noverlay n\xe9cessitent quelques adaptations de l'\xe9diteur de liens et des m\xe9canismes\nde relocation."}),"\n",(0,r.jsx)(n.h3,{id:"le-chargement-dynamique",children:"Le chargement dynamique"}),"\n",(0,r.jsx)(n.p,{children:"Un autre syst\xe8me couramment utilis\xe9 dans les logiciels du march\xe9 des micros est\nle chargement dynamique. Avec le chargement dynamique, une fonction n'est charg\xe9\nen m\xe9moire qu'au moment de son appel. Le chargement dynamique demande que toutes\nles fonctions soient repositionnables en m\xe9moire de fa\xe7on ind\xe9pendante. A chaque\nappel de fonction on regarde si la fonction est en m\xe9moire sinon un \xe9diteur de\nliens dynamique est appel\xe9 pour la charger. Dans les deux cas (overlay et\nchargement dynamique), le syst\xe8me joue un r\xf4le tr\xe8s restreint, il suffit en\neffet d'avoir un bon syst\xe8me de gestion de fichiers. Malheureusement, le travail\nque doit r\xe9aliser le programmeur pour choisir les overlays et/ou installer un\nm\xe9canisme de chargement dynamique efficace est non trivial et requiert que le\nprogrammeur ait une parfaite connaissance du programme. Ceci nous am\xe8ne aux\ntechniques automatiques."}),"\n",(0,r.jsx)(n.h2,{id:"demande-paging",children:"Demande Paging"}),"\n",(0,r.jsx)(n.p,{children:"La m\xe9thode de Demand Paging est la plus r\xe9pandue des impl\xe9mentations de m\xe9moire\nvirtuelle, elle demande de nombreuse capcit\xe9s mat\xe9rielles."}),"\n",(0,r.jsx)(n.p,{children:'Nous partons d\'un syst\xe8me de swap o\xf9 la m\xe9moire est d\xe9coup\xe9e en pages. Comme\npour le swap, quand un programme doit \xeatre ex\xe9cut\xe9 nous le chargeons en m\xe9moire\n(swap in) mais au lieu de faire un swap complet, on utilise un "swappeur paresseur"\n(lazy swapper). Un swappeur paresseux charge une page uniquement si elle est n\xe9cessaire.'}),"\n",(0,r.jsx)(n.p,{children:"Que ce passe-t-il quand le programme essaie d'acc\xe9der \xe0 une page qui est hors\nm\xe9moire ?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"le mat\xe9riel va traduire l'adresse logique en une adresse physique gr\xe2ce \xe0 la\ntable des pages"}),"\n",(0,r.jsxs)(n.li,{children:["tant que les pages demand\xe9es sont en m\xe9moire, le programme tourne normalement,\nsinon la page est contenue dans l'espace des adresses logiques mais n'est pas\ncharg\xe9e, il y a une ",(0,r.jsx)(n.strong,{children:"page fault"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["En g\xe9n\xe9ral, une erreur d'adresse est d\xfbe \xe0 une tentative d'acc\xe8s \xe0 une adresse\next\xe9rieure (invalide). Dans ce cas, le programme doit \xeatre interrompu, c'est le\ncomportement normal d'un syst\xe8me de swap. Mais il est possible avec un swappeur\nparesseux que la page existe mais ne soit pas en m\xe9moire centrale, d'o\xf9 les\n\xe9tapes suivantes dans ce cas : On peut faire d\xe9marrer un processus sans aucune\npage en m\xe9moire. La premi\xe8re ",(0,r.jsx)(n.strong,{children:"Page fault"})," aurait lieu \xe0 la lecture de la\npremi\xe8re instruction (l'instruction n'\xe9tant pas en m\xe9moire). Il faut r\xe9aliser\nune forme sp\xe9ciale de sauvegarde de contexte, il faut garder une image de l'\xe9tat\ndu processus qui vient d'effectuer une ",(0,r.jsx)(n.strong,{children:"Page Fault"})," mais de plus il faudra\nred\xe9marrer (r\xe9ex\xe9cuter) l'instruction qui a plac\xe9 le processus dans cet \xe9tat, en\neffet il est possible que l'instruction ne soit pas termin\xe9 par manque de\ndonn\xe9es. Le syst\xe8me d'exploitation a ici un r\xf4le important, c'est lui qui va\nr\xe9aliser le chargement de la page manquante puis relancer le processus et\nl'instruction. Les circuits n\xe9cessaires \xe0 la m\xe9thode de Demande Paging sont les\nm\xeames que ceux que l'on utilise pour un syst\xe8me de swap pagin\xe9, c'est \xe0 dire une\nm\xe9moire secondaire et un gestionnaire de pages (table des pages). Par contre, la\npartie logicielle est beaucoup plus importante. Enfin il faut que les\n",(0,r.jsx)(n.strong,{children:"instructions soient interruptibles"}),", ce qui n'est pas toujours le cas sur\ntous les processeurs et ce qui est fondamental."]}),"\n",(0,r.jsx)(n.h3,{id:"efficacit\xe9",children:"Efficacit\xe9"}),"\n",(0,r.jsx)(n.p,{children:"Efficacit\xe9 des performances de Demande Paging : Soit ma = 500 nanosecondes, le\ntemps moyen d'acc\xe8s a une m\xe9moire. Le temps effectif d'acc\xe8s avec le Demand\nPaging est : temps effectif = (1-p)*ma + p* \"temps de gestion de l'erreur de\npage\" o\xf9 p est la probabilit\xe9 d'occurrence d'une erreur de page (page fault).\nUne erreur de page n\xe9cessite de r\xe9aliser les op\xe9rations suivantes"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"lever une interruption pour le syst\xe8me"}),"\n",(0,r.jsx)(n.li,{children:"sauvegarder le contexte du processus"}),"\n",(0,r.jsx)(n.li,{children:"d\xe9terminer que l'interruption est une erreur de page"}),"\n",(0,r.jsx)(n.li,{children:"v\xe9rifier que la page en question est une page l\xe9gale de l'espace logique,\nd\xe9terminer o\xf9 se trouve la page dans la m\xe9moire secondaire"}),"\n",(0,r.jsxs)(n.li,{children:["ex\xe9cuter une lecture de la page sur une m\xe9moire libre (lib\xe9rer \xe9ventuellement\nune page cf. algorithme de remplacement de page)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"attendre que le p\xe9riph\xe9rique soit libre"}),"\n",(0,r.jsx)(n.li,{children:"temps de latence du p\xe9riph\xe9rique"}),"\n",(0,r.jsx)(n.li,{children:"commencer le transfert"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"allouer pendant ce temps l\xe0 le cpu \xe0 un autre utilisateur"}),"\n",(0,r.jsx)(n.li,{children:"interruption du p\xe9riph\xe9rique"}),"\n",(0,r.jsx)(n.li,{children:"sauvegarde du contexte du processus courant"}),"\n",(0,r.jsx)(n.li,{children:"d\xe9terminer que l'interruption \xe9tait la bonne interruption (venant du\np\xe9riph\xe9rique)"}),"\n",(0,r.jsx)(n.li,{children:"mise \xe0 jour de la table des pages et d'autres pages pour indiquer que la\npage demand\xe9e est en m\xe9moire maintenant."}),"\n",(0,r.jsx)(n.li,{children:"attendre que le processus soit s\xe9lectionn\xe9 de nouveau pour utiliser l'unit\xe9\ncentrale (cpu)"}),"\n",(0,r.jsx)(n.li,{children:"charger le contexte du processus"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Toutes ces instructions ne sont pas toujours r\xe9alis\xe9es (on peut en particulier\nsupposer que l'on ne peut pas pr\xe9empter l'unit\xe9 centrale, mais alors quelle\nperte de temps pour l'ensemble du syst\xe8me). Dans tous les cas, nous devons au\nmoins r\xe9aliser les 3 actions suivantes :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"g\xe9rer l'interruption"}),"\n",(0,r.jsx)(n.li,{children:"swapper la page demand\xe9e"}),"\n",(0,r.jsx)(n.li,{children:"relance le processus"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Ce qui co\xfbte le plus cher est la recherche de la page sur le disque et son\ntransfert en m\xe9moire, ce qui prend de l'ordre de 1 \xe0 10 millisecondes."}),"\n",(0,r.jsx)(n.p,{children:"Ce qui nous donne en prenant une vitesse d'acc\xe8s m\xe9moire de 1 microseconde et un\ntemps de gestion de page de 5 millisecondes un"}),"\n",(0,r.jsx)(n.p,{children:"temps effectif = (1-p)+p * 5000 microsecondes"}),"\n",(0,r.jsx)(n.p,{children:"Une erreur de page toutes les mille pages nous donne un temps effectif onze fois\nplus long que l'acc\xe8s standard."}),"\n",(0,r.jsx)(n.p,{children:"Il faut r\xe9duire \xe0 moins d'une erreur de page tout les 100 000 acc\xe8s pour obtenir\nune d\xe9gradation inf\xe9rieur \xe0 10. On comprend bien que les choix \xe0 faire sur des\npages qu'il faut placer en m\xe9moire sont donc tr\xe8s importants."}),"\n",(0,r.jsx)(n.p,{children:"Ces choix deviennent encore plus importants quand l'on a de nombreux\nutilisateurs et qu'il y a sur-allocation de la m\xe9moire, ex\xe9cution concurrente de\n6 processus de la taille sup\xe9rieure ou \xe9gale \xe0 la m\xe9moire physique !"}),"\n",(0,r.jsx)(n.p,{children:"Si l'on suppose de plus que nos 6 programmes utilisent dans une petite s\xe9quence\nd'instructions toutes les pages de leur m\xe9moire logique, nous nous trouvons\nalors dans une situation de p\xe9nurie de pages libres. Le syst\xe8me d'exploitation\npeut avoir recours \xe0 plusieurs solution dans ce cas-l\xe0"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"tuer le processus fautif"}),"\n",(0,r.jsx)(n.li,{children:"utiliser un algorithme de remplacement de page"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Cet algorithme de remplacement est introduit dans notre s\xe9quence de gestion\nd'erreur de page l\xe0 o\xf9 l'on s'attribuait une page libre de la m\xe9moire centrale."}),"\n",(0,r.jsxs)(n.p,{children:["Maintenant il nous faut s\xe9lectionne une victime, c'est \xe0 dire, une des pages\noccup\xe9es de la m\xe9moire centrale qui sera swapp\xe9e sur disque et remplac\xe9e par la\npage demand\xe9e. Remarquons que dans ce cas-l\xe0 notre temps de transfert est\ndoubl\xe9, comme i faut \xe0 la fois lire une page et sauvegarder une page sur disque\n(le temps de transfert disque est ce qui est le plus co\xfbteux dans la gestion\nd'une erreur de page). Il est possible de r\xe9aliser des syst\xe8mes de ",(0,r.jsx)(n.strong,{children:"demande\nsegments"}),", mais le lecteur avis\xe9 remarquera rapidement les probl\xe8mes pos\xe9s par\nla taille variable des segments."]}),"\n",(0,r.jsx)(n.h2,{id:"allocation-de-pages-aux-processus",children:"Allocation de pages aux processus"}),"\n",(0,r.jsx)(n.p,{children:"Comment r\xe9partir les pages sur les diff\xe9rents processus et le syst\xe8me ?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"remplacement local"})," le processus se voit affect\xe9 un certain nombre de pages\nqu'il va utiliser de fa\xe7on autonome, son temps d'ex\xe9cution ne d\xe9pend que de\nson propre comportement"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"remplacement global"})," le comportement d'allocation de pages aux processus\nd\xe9pend de la charge du syst\xe8me et du comportement des diff\xe9rents processus."]}),"\n",(0,r.jsx)(n.p,{children:"Le remplacement local demande que l'on r\xe9alise un partage entre les diff\xe9rents\nprocessus."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:['Le partage "\xe9quitable" : ',(0,r.jsx)(n.code,{children:"m"})," pages de m\xe9moire physique, ",(0,r.jsx)(n.code,{children:"n"})," processus, ",(0,r.jsx)(n.code,{children:"m/n"}),"\npages par processus ! O nretrouve ici un probl\xe8me proche de la fragmentation\ninterne, un grand nombre de pages est donn\xe9 \xe0 un processus qui en utilise\neffectivement peu."]}),"\n",(0,r.jsx)(n.p,{children:"Si la m\xe9moire est libre et assez grande, les deux processus sont grossi\xe8rement\naussi rapides, par contre si on lance dix exemplaires du premier, le temps\nd'attente est juste multipli\xe9 par 10. Pour le deuxi\xe8me, le temps d'attente est\nau moins multipli\xe9 par 100."}),"\n",(0,r.jsx)(n.h2,{id:"lappel-fork-et-la-m\xe9moire-virtuelle",children:"L'appel fork et la m\xe9moire virtuelle"}),"\n",(0,r.jsxs)(n.p,{children:["Nous avons vu que la primitive ",(0,r.jsx)(n.code,{children:"fork()"})," r\xe9alise une copie de l'image m\xe9moire du\nprocessus p\xe8re pour cr\xe9er le processus fils. Cette copie n'est pas int\xe9grale car\nles deux processus peuvent partager des pages marqu\xe9es en lecture seule, en\nparticulier le segment du code est partag\xe9 par les deux processus (r\xe9entrance\nstandard des processus unix)."]}),"\n",(0,r.jsxs)(n.p,{children:["Mais avec le syst\xe8me de demand-paging, on peut introduire une nouvelle notion\nqui est la \"copie sur \xe9criture\" (copy on write). On ajoute \xe0 la structure de\npage de la table des pages des indicateurs de \"copie sur \xe9criture\". L'id\xe9e est\nde r\xe9aliser la copie de la page uniquement dans le cas o\xf9 l'un des processus qui\npeuvent y acc\xe9der r\xe9aliser une \xe9criture. Dans ce cas-l\xe0, la page est recopi\xe9e\navant l'\xe9criture et le processus \xe9crivain poss\xe8de alors sa propre page.\nL'int\xe9r\xeat de ce m\xe9canisme est srutout visible dans le cas tr\xe8s fr\xe9quent o\xf9 le\n",(0,r.jsx)(n.code,{children:"fork"})," est imm\xe9diatement suivi par un ",(0,r.jsx)(n.code,{children:"exec"}),". En effet ce dernier va r\xe9aliser\nune lib\xe9ration de toutes les pages, il est donc inutile de les recopier juste\navant cette lib\xe9ration."]}),"\n",(0,r.jsxs)(n.p,{children:["Le syst\xe8me BSD a introduit la premi\xe8re version de cette id\xe9e en partant de\nl'appel syst\xe8me ",(0,r.jsx)(n.code,{children:"vfork()"})," qui lui permet le partage total de toutes les pages\nentre le processus p\xe8re et le processus fils sans aucune copie. L'int\xe9r\xeat est de\npouvoir r\xe9aliser rapidement un ",(0,r.jsx)(n.code,{children:"execve"})," sans avoir \xe0 recopier l'espace\nd'adressage du processus p\xe8re."]}),"\n",(0,r.jsx)(n.h2,{id:"projection-de-fichiers-en-m\xe9moire",children:"Projection de fichiers en m\xe9moire"}),"\n",(0,r.jsxs)(n.p,{children:["La fonction ",(0,r.jsx)(n.code,{children:"mmap"})," permet la projection de fichiers en m\xe9moire. LE segment du\nfichier indique est plac\xe9 en m\xe9moire \xe0 partir de l'adresse indiqu\xe9e. Le segment\nde fichier peut aisni \xeatre parcouru par des acc\xe8s par adresse sans utiliser de\ncommande de lecture ou d'\xe9criture."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"#include <sys/mman.h>\n#include <sys/types.h>\n\nvoid *mmap(void *adr, int len, int prot, int options, int desc, int offset);\n\nint munmap(void *adr, int len);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["L'adresse ",(0,r.jsx)(n.code,{children:"adr"})," indique o\xf9 doit \xeatre plac\xe9 le fichier, cette adresse doit \xeatre\nune adresse de d\xe9but de page (un multiple de ",(0,r.jsx)(n.code,{children:"sysconf(_SC_PAGE_SIZE)"}),", si le\nparam\xe8tre est ",(0,r.jsx)(n.code,{children:"NULL"})," alors le syst\xe8me s\xe9lectionne l'adresse de placement qui est\nretourn\xe9e par la fonction. L'intervalle de position ",(0,r.jsx)(n.code,{children:"[offset, offset+len]"})," du\nfichier ",(0,r.jsx)(n.code,{children:"desc"})," est plac\xe9 en m\xe9moire). ",(0,r.jsx)(n.code,{children:"prot"})," indique les protections d'acc\xe8s\nsous ",(0,r.jsx)(n.code,{children:"HP-UX"})," les protections suivantes sont disponibles : ",(0,r.jsx)(n.code,{children:"PROT_NONE, PROT_READ, PROT_READ|PROT_EXECUTE, PROT_READ|PROT_WRITE, PROT_READ|PROT_WRITE|PROT_EXECUTE"}),"\n",(0,r.jsx)(n.code,{children:"options"})," indique si l'on veut que les \xe9critures r\xe9alis\xe9es dans les pages\ncontenant la projection soient partag\xe9es (",(0,r.jsx)(n.code,{children:"MAP_SHARED"}),"), ou au contraire qu'une\ncopie sur \xe9criture soit r\xe9alis\xe9e (",(0,r.jsx)(n.code,{children:"MAP_PRIVATE"}),"). La fonction ",(0,r.jsx)(n.code,{children:"munmap"})," permet de\nlib\xe9rer la zone m\xe9moire d'adresse ",(0,r.jsx)(n.code,{children:"adr"})," et de longueur ",(0,r.jsx)(n.code,{children:"len"}),". Pour une autre\nforme de m\xe9moire partag\xe9e."]}),"\n",(0,r.jsx)(n.h2,{id:"les-conseils-et-politiques-de-chargement-des-zonnes-mmap\xe9s",children:"Les conseils et politiques de chargement des zonnes mmap\xe9s"}),"\n",(0,r.jsxs)(n.p,{children:["Une fois que l'on a d\xe9cid\xe9 de faire des projections en m\xe9moire avec ",(0,r.jsx)(n.code,{children:"mmap"})," il\npeut \xeatre opportun de faire appel \xe0 la fonction ",(0,r.jsx)(n.code,{children:"madvise"})," qui permet de donner\nun conseil au syst\xe8me en le pr\xe9venant par avance de la fa\xe7on dont vous allez\nutiliser le segment de m\xe9moire. En particulier allez vous lire le fichier\nsequentiellement ou de fa\xe7on al\xe9aatoire. Avez vous encore besoin du fichier\napr\xe8s lecture etc. Biensur la fonction ",(0,r.jsx)(n.code,{children:"madvise"})," ne se limite pas aux pages\nmapp\xe9s mais c'est sur celle ci q'il est le plus facile de prendre des d\xe9cisions,\nles autres pages \xe9tant g\xe9r\xe9es dans la pile, le tas et le code dans des zone plus\nd\xe9licates et moins bien cartographi\xe9es en g\xe9n\xe9ral (sic)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"#include <sys/mman.h>\nint madvise(void *start, size_t length, int advise*);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["La valeur du conseil ",(0,r.jsx)(n.code,{children:"advice"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"MADV_NORMAL : Comportement par d\xe9faut"}),"\n",(0,r.jsx)(n.li,{children:"MADV_RANDOM : pr\xe9voit des acc\xe8s aux pages dans un ordre al\xe9atoire"}),"\n",(0,r.jsx)(n.li,{children:"MADV_SEQUENTIAL : pr\xe9voit des acc\xe8s aux pages dans un ordre s\xe9quentiel"}),"\n",(0,r.jsx)(n.li,{children:"MADV_WILINEED : pr\xe9voit un acc\xe8s dans un futur proche"}),"\n",(0,r.jsx)(n.li,{children:"MADV_DONTNEED : ne pr\xe9voit pas d'acc\xe8s dans un futur proche"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Biensur ce ne sont que des conseils le syst\xe8me les utilisera si il en a la\npossibilit\xe9, soit parce qu'il a du temps idle soit parce qu'il profitera des\nlectures group\xe9es sur disque en r\xe9alisant des lectures en avance dans le cas\ns\xe9quentiel. Il peut aussi profiter de l'indication ",(0,r.jsx)(n.code,{children:"DONTNEED"})," pour prendre des\nd\xe9cisions dans le code de remplacement de page."]}),"\n",(0,r.jsx)(n.h2,{id:"chargement-dynamique",children:"Chargement dynamique"}),"\n",(0,r.jsx)(n.p,{children:'Ind\xe9pendemment de l\'existence de la m\xe9moire virtuelle il est possible de g\xe9rer\n"\xe0 la main" le code accessible en utilisant le chargement direct (non\nautomatique) de librairies.'})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var r=s(96540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);