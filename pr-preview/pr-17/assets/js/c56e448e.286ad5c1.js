"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[3505],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var t=s(96540);const i={},r=t.createContext(i);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},44058:e=>{e.exports=JSON.parse('{"permalink":"/pr-preview/pr-17/blog/2024/03/17/04-ci-cd/workflow","source":"@site/blog/04-ci-cd/2024-03-17-workflow.md","title":"Workflows","description":"Cr\xe9\xe9er un workflow avec GitHub Actions","date":"2024-03-17T00:00:00.000Z","tags":[{"inline":true,"label":"CI/CD","permalink":"/pr-preview/pr-17/blog/tags/ci-cd"},{"inline":true,"label":"GitHub","permalink":"/pr-preview/pr-17/blog/tags/git-hub"},{"inline":true,"label":"Devops","permalink":"/pr-preview/pr-17/blog/tags/devops"}],"readingTime":4.895,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Workflows","description":"Cr\xe9\xe9er un workflow avec GitHub Actions","tags":["CI/CD","GitHub","Devops"]},"unlisted":false,"prevItem":{"title":"Actions Composites","permalink":"/pr-preview/pr-17/blog/2024/03/28/04-ci-cd/action"},"nextItem":{"title":"Introduction \xe0 GitHub Actions","permalink":"/pr-preview/pr-17/blog/2024/02/22/04-ci-cd/github-actions"}}')},90323:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>a});var t=s(44058),i=s(74848),r=s(28453);const o={title:"Workflows",description:"Cr\xe9\xe9er un workflow avec GitHub Actions",tags:["CI/CD","GitHub","Devops"]},c=void 0,l={authorsImageUrls:[]},a=[{value:"Exemple d&#39;int\xe9gration des actions GitHub dans les workflows",id:"exemple-dint\xe9gration-des-actions-github-dans-les-workflows",level:2},{value:"D\xe9clenchement des actions",id:"d\xe9clenchement-des-actions",level:2},{value:"Marketplace",id:"marketplace",level:2},{value:"R\xe9utiliser les Workflows et Actions",id:"r\xe9utiliser-les-workflows-et-actions",level:2},{value:"Type de machine",id:"type-de-machine",level:2},{value:"Container",id:"container",level:2},{value:"Strategy",id:"strategy",level:2},{value:"Art\xe9fact",id:"art\xe9fact",level:2},{value:"Vrac",id:"vrac",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"exemple-dint\xe9gration-des-actions-github-dans-les-workflows",children:"Exemple d'int\xe9gration des actions GitHub dans les workflows"}),"\n",(0,i.jsx)(n.p,{children:"Voici un exemple d'int\xe9gration des actions GitHub dans un workflow pour automatiser le d\xe9ploiement d'une application Node.js."}),"\n",(0,i.jsxs)(n.p,{children:["Un workflow est l'\xe9l\xe9ment central de GitHub Actions. Il s'agit d'un processus automatis\xe9 compos\xe9 de ",(0,i.jsx)(n.code,{children:"jobs"})," et de ",(0,i.jsx)(n.code,{children:"steps"})," qui s'ex\xe9cutent sur des ",(0,i.jsx)(n.code,{children:"runners"}),". Les workflows sont d\xe9clench\xe9s par des \xe9v\xe9nements, tels que des pushs, des pull requests, des forks, etc."]}),"\n",(0,i.jsxs)(n.p,{children:["Pour cr\xe9er un fichier de workflow, il faut cr\xe9er un fichier ",(0,i.jsx)(n.code,{children:".yml"})," dans le dossier ",(0,i.jsx)(n.code,{children:".github/workflows"})," du d\xe9p\xf4t. Un workflow est compos\xe9 de ",(0,i.jsx)(n.code,{children:"jobs"})," et de ",(0,i.jsx)(n.code,{children:"steps"}),". Un ",(0,i.jsx)(n.code,{children:"job"})," est une suite d'\xe9tapes qui s'ex\xe9cutent sur le m\xeame runner, tandis qu'un ",(0,i.jsx)(n.code,{children:"step"})," est une t\xe2che individuelle qui peut s'ex\xe9cuter dans un ",(0,i.jsx)(n.code,{children:"job"}),". Chaque ",(0,i.jsx)(n.code,{children:"job"})," est ex\xe9cut\xe9 dans un environnement d\xe9di\xe9 d\xe9fini par ",(0,i.jsx)(n.a,{href:"#type-de-machine",children:(0,i.jsx)(n.code,{children:"runs-on"})}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"name: CI\n\non: [push]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - name: Run a one-line script\n        run: echo Hello, world!\n      - name: Run a multi-line script\n        run: |\n          echo Add other actions to build,\n          echo test, and deploy your project.\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Documentation Compl\xe8te  : ",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions",children:"https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions"})]}),"\n",(0,i.jsx)(n.h2,{id:"d\xe9clenchement-des-actions",children:"D\xe9clenchement des actions"}),"\n",(0,i.jsx)(n.p,{children:"Les d\xe9clencheurs de workflow sont des \xe9v\xe9nements qui entra\xeenent l\u2019ex\xe9cution d\u2019un workflow. La syntaxe d\xe9pend du niveau de pr\xe9cision"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pour tout ce qui concerne un \xe9v\xe9nement :"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"    on: [push] # pull_request, fork etc\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Pour plus de finesse sur l\u2019\xe9v\xe9nement :"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"    on: # trigger\n      label: # type d'event (push, fork, pull_request)\n        types:\n          - created # trigger \xe0 chaque fois qu'un label est cr\xe9\xe9\n      push:\n        branches:\n          - main # tous les push sur la branche main\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"D\xe9clenchement manuel de l\u2019op\xe9ration (avec prise d\u2019argument)"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"    on:\n      workflow_dispatch:\n        inputs:\n          test_mode:\n            description: 'True or False'\n            required: true\n"})}),"\n",(0,i.jsxs)(n.p,{children:["La liste compl\xe8te des d\xe9clencheurs est disponible dans la ",(0,i.jsx)(n.a,{href:"https://docs.github.com/fr/actions/using-workflows/events-that-trigger-workflows",children:"Documentation Github"})]}),"\n",(0,i.jsxs)(n.p,{children:["Une ex\xe9cution de workflow est compos\xe9e d\u2019un ou de plusieurs ",(0,i.jsx)(n.code,{children:"jobs"}),", qui s\u2019ex\xe9cutent en parall\xe8le par d\xe9faut. Chaque job est constitu\xe9 d\u2019un ",(0,i.jsx)(n.code,{children:"name"})," et d\u2019au moins un ",(0,i.jsx)(n.code,{children:"step"})," pour \xeatre ex\xe9cutable et peut \xeatre configur\xe9.\nLa documentation pr\xe9cise des job est disponible dans la ",(0,i.jsx)(n.a,{href:"https://docs.github.com/fr/actions/using-workflows/workflow-syntax-for-github-actions#jobs",children:"Documentation Github"})]}),"\n",(0,i.jsx)(n.h2,{id:"marketplace",children:"Marketplace"}),"\n",(0,i.jsxs)(n.p,{children:["Chaque ",(0,i.jsx)(n.code,{children:"job"})," permet d\u2019ex\xe9cuter un script. Le script le plus basique est un simple ",(0,i.jsx)(n.code,{children:"run"})," avec des commandes ",(0,i.jsx)(n.code,{children:"bash"})," derri\xe8re. Cependant, il est possible de r\xe9utiliser des actions d\xe9finies dans le marketplace. Par exemple le ",(0,i.jsx)(n.code,{children:"steps"})," ci-dessous permet d\u2019ex\xe9cuter l\u2019action ",(0,i.jsx)(n.a,{href:"https://github.com/ros-tooling/action-ros-ci",children:"https://github.com/ros-tooling/action-ros-ci"}),". Le mot cl\xe9 ",(0,i.jsx)(n.code,{children:"with"})," permet de passer des param\xe8tres \xe0 l\u2019action."]}),"\n",(0,i.jsx)(n.admonition,{type:"danger",children:(0,i.jsx)(n.p,{children:"Le marketplace permet de r\xe9utiliser des actions d\xe9j\xe0 d\xe9finies par la communaut\xe9. Il est important de v\xe9rifier la source de l\u2019action avant de l\u2019utiliser."})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"steps:\n    - name: build and test ROS 2\n    uses: ros-tooling/action-ros-ci@v0.2\n    with:\n        package-name: github-action-test\n        target-ros2-distro: ${{ matrix.ros_distribution }}\n        import-token: ${{ secrets.GITHUB_TOKEN }} # token autogenerated par github\n"})}),"\n",(0,i.jsx)(n.h2,{id:"r\xe9utiliser-les-workflows-et-actions",children:"R\xe9utiliser les Workflows et Actions"}),"\n",(0,i.jsxs)(n.p,{children:["Il est possible de r\xe9utiliser des ",(0,i.jsx)(n.code,{children:"workflows"})," et des ",(0,i.jsx)(n.code,{children:"actions"})," dans un workflow. Pour cela, il est possible de cr\xe9er des ",(0,i.jsx)(n.code,{children:"workflows"})," et des ",(0,i.jsx)(n.code,{children:"actions"})," dans des fichiers s\xe9par\xe9s et de les appeler dans le workflow principal."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"jobs:\n    workflow: # r\xe9utilisation du workflow\n      uses: path/to/your-workflow.yml@v1\n    action: # r\xe9utilisation d'une action\n      runs-on: ubuntu-latest\n      container: ubuntu:latest\n      steps:\n        - uses: path/to/your-action@v1\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/learn-github-actions/reusing-workflows",children:"Documentation des wokflows r\xe9utilisables"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://docs.github.com/en/actions/creating-actions/creating-a-composite-action",children:"Documentation des actions r\xe9utilisables"})}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["Lorsqu'un workflow est r\xe9utilis\xe9 il d\xe9fini son propre environnement (runner, container, etc). De plus il n'est pas utilisable dans une ",(0,i.jsx)(n.code,{children:"step"}),"."]}),(0,i.jsxs)(n.p,{children:["\xc0 l'inverse, une action est utilisable dans une ",(0,i.jsx)(n.code,{children:"step"})," et fonctionne dans l'environnement du ",(0,i.jsx)(n.code,{children:"job"})," qui l'appelle."]})]}),"\n",(0,i.jsx)(n.h2,{id:"type-de-machine",children:"Type de machine"}),"\n",(0,i.jsxs)(n.p,{children:["Utilisez ",(0,i.jsx)(n.code,{children:"jobs.<job_id>.runs-on"})," pour d\xe9finir le type de machine sur laquelle le travail doit \xeatre ex\xe9cut\xe9. La configuration prend en argument un ",(0,i.jsx)(n.code,{children:"tag"})," d\xe9fini pour les runners"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'jobs:\n    name-job:\n    runs-on: ubuntu-latest # runner distant sur les serveur de Github\n    runs-on: self-hosted # runner local\n    steps:\n        - run: echo "Hello World !"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Les ",(0,i.jsx)(n.code,{children:"runners"})," distants fourni par Github consomment du temps pour l\u2019organisation dans les limites de 2 000 minutes gratuites par mois. Il est pr\xe9f\xe9rable d\u2019utiliser des ",(0,i.jsx)(n.code,{children:"runners self hosted"})," (voir ",(0,i.jsx)(n.a,{href:"https://docs.github.com/fr/actions/hosting-your-own-runners/managing-self-hosted-runners/about-self-hosted-runners",children:"https://docs.github.com/fr/actions/hosting-your-own-runners/managing-self-hosted-runners/about-self-hosted-runners"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["Le choix du ",(0,i.jsx)(n.code,{children:"runner"})," se fait via les tags. Toutes les machines auto-h\xe9berg\xe9es partagent le tag ",(0,i.jsx)(n.code,{children:"self-hosted"})," , le tag de leur syst\xe8me d\u2019exploitation (",(0,i.jsx)(n.code,{children:"Linux"}),", ",(0,i.jsx)(n.code,{children:"Windows"}),"), leur architecture (",(0,i.jsx)(n.code,{children:"x64"}),") et des tags personnalis\xe9s par machine."]}),"\n",(0,i.jsx)(n.h2,{id:"container",children:"Container"}),"\n",(0,i.jsxs)(n.p,{children:["L\u2019utilisation d\u2019un ",(0,i.jsx)(n.code,{children:"container"})," permet de cr\xe9er un nouveau conteneur permettant d\u2019ex\xe9cuter les \xe9tapes d\u2019un travail dans un conteneur sp\xe9cifif\xe9. Si vous ne d\xe9finissez pas de ",(0,i.jsx)(n.code,{children:"container"}),", toutes les \xe9tapes s\u2019ex\xe9cutent directement sur l\u2019h\xf4te sp\xe9cifi\xe9 par ",(0,i.jsx)(n.code,{children:"runs-on"})," dans le cas d\u2019une machine auto-h\xe9berg\xe9es, il n\u2019y a donc acc\xe8s qu\u2019aux packages install\xe9s sur la machine. Un ",(0,i.jsx)(n.code,{children:"container"})," est rattach\xe9 \xe0 un ",(0,i.jsx)(n.code,{children:"job"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'jobs:\n    name-job:\n    runs-on: self-hosted\n    container:\n    image: ubuntu:jammy # run job with ubuntu:jammy docker\n        steps:\n            - run: echo "Hello World !"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"strategy",children:"Strategy"}),"\n",(0,i.jsxs)(n.p,{children:["L\u2019utilisation de ",(0,i.jsx)(n.code,{children:"strategy"})," permet cr\xe9er automatiquement plusieurs ex\xe9cutions de travaux bas\xe9es sur des combinaisons de variables. Une strat\xe9gie de matrice est utile pour tester du code dans diff\xe9rentes versions d'un langage ou sur diff\xe9rents syst\xe8mes d'exploitation.\nPar exemple"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'jobs:\n    example_matrix:\n    strategy:\n        matrix:\n        version: [10, 12, 14]\n        os: [ubuntu-latest, windows-latest]\n        steps:\n            - run : echo "${{ matrix.version }} ${{ matrix.os }}"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Un travail s\u2019ex\xe9cute pour chaque combinaison possible des variables. Dans cet exemple, le workflow ex\xe9cute six travaux, un pour chaque combinaison des variables ",(0,i.jsx)(n.code,{children:"os"})," et ",(0,i.jsx)(n.code,{children:"version"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"art\xe9fact",children:"Art\xe9fact"}),"\n",(0,i.jsx)(n.p,{children:"Les artefacts permettent de conserver des donn\xe9es une fois un travail termin\xe9 et de les partager avec une autre action. Un artefact est un fichier ou une collection de fichiers g\xe9n\xe9r\xe9s pendant l\u2019ex\xe9cution d\u2019un workflow. Cet exemple permet de stocker un fichier comme artefact."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"- name: Archive code coverage results\n    uses: actions/upload-artifact@v3\n    with:\n        name: code-coverage-report\n        path: output/test/code-coverage.html\n"})}),"\n",(0,i.jsx)(n.p,{children:"Pour r\xe9cup\xe9rer un artefact"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"- name: Download math result for job 2\n    uses: actions/download-artifact@v3\n    with:\n        name: homework\n"})}),"\n",(0,i.jsx)(n.h2,{id:"vrac",children:"Vrac"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"needs"})," le job actuel ne commencera que quand le job mentionn\xe9 sera termin\xe9"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"if"})," condition de lancement du job"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"permission"})," permet d\u2019augmenter les droits du ",(0,i.jsx)(n.code,{children:"GITHUB_TOKEN"})," (voir ",(0,i.jsx)(n.a,{href:"https://docs.github.com/fr/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token",children:"https://docs.github.com/fr/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"environnement"})," permet de d\xe9finir des variables d\u2019environnement"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);