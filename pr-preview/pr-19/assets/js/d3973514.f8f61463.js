"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[4511],{9835(e,s,n){n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var r=n(69740),t=n(74848),l=n(28453);const i={title:"Prometheus",description:"Prometheus, l'outil de monitoring et d'alerting open-source devenu incontournable dans l'\xe9cosyst\xe8me Cloud Native.",tags:["Prometheus","Monitoring","Observabilit\xe9","DevOps"]},o=void 0,a={authorsImageUrls:[]},d=[{value:"Qu&#39;est-ce que Prometheus ? \ud83e\udd14",id:"quest-ce-que-prometheus--",level:2},{value:"Architecture de Prometheus \ud83c\udfd7\ufe0f",id:"architecture-de-prometheus-\ufe0f",level:2},{value:"Installation de Prometheus \ud83d\ude80",id:"installation-de-prometheus-",level:2},{value:"Installation avec Docker",id:"installation-avec-docker",level:3},{value:"Installation binaire",id:"installation-binaire",level:3},{value:"Installation sur Kubernetes avec Helm",id:"installation-sur-kubernetes-avec-helm",level:3},{value:"Configuration de base",id:"configuration-de-base",level:3},{value:"Concepts de base : M\xe9triques et Scraping \ud83d\udcc8",id:"concepts-de-base--m\xe9triques-et-scraping-",level:2},{value:"Les types de m\xe9triques",id:"les-types-de-m\xe9triques",level:3},{value:"Le mod\xe8le de donn\xe9es",id:"le-mod\xe8le-de-donn\xe9es",level:3},{value:"Le processus de scraping",id:"le-processus-de-scraping",level:3},{value:"Exporters : collecter des m\xe9triques \ud83d\udce1",id:"exporters--collecter-des-m\xe9triques-",level:2},{value:"Node Exporter (m\xe9triques syst\xe8me)",id:"node-exporter-m\xe9triques-syst\xe8me",level:3},{value:"Exporters populaires",id:"exporters-populaires",level:3},{value:"Introduction \xe0 PromQL \ud83d\udcca",id:"introduction-\xe0-promql-",level:2},{value:"Requ\xeates de base",id:"requ\xeates-de-base",level:3},{value:"S\xe9lecteurs temporels",id:"s\xe9lecteurs-temporels",level:3},{value:"Fonctions courantes",id:"fonctions-courantes",level:3},{value:"Op\xe9rations math\xe9matiques",id:"op\xe9rations-math\xe9matiques",level:3},{value:"Agr\xe9gations avanc\xe9es",id:"agr\xe9gations-avanc\xe9es",level:3},{value:"Exemples pratiques",id:"exemples-pratiques",level:3},{value:"Interface Web de Prometheus \ud83d\udda5\ufe0f",id:"interface-web-de-prometheus-\ufe0f",level:2},{value:"Onglet Graph",id:"onglet-graph",level:3},{value:"Onglet Alerts",id:"onglet-alerts",level:3},{value:"Onglet Status",id:"onglet-status",level:3},{value:"D\xe9couverte de services \ud83d\udd0d",id:"d\xe9couverte-de-services-",level:2},{value:"D\xe9couverte Kubernetes",id:"d\xe9couverte-kubernetes",level:3},{value:"D\xe9couverte avec fichiers",id:"d\xe9couverte-avec-fichiers",level:3},{value:"Bonnes pratiques \ud83d\udc4d",id:"bonnes-pratiques-",level:2},{value:"Conclusion \ud83c\udfaf",id:"conclusion-",level:2},{value:"Ressources utiles \ud83d\udcda",id:"ressources-utiles-",level:2}];function u(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"Prometheus est un syst\xe8me de monitoring et d'alerting open-source qui s'est impos\xe9 comme la r\xe9f\xe9rence dans l'\xe9cosyst\xe8me Cloud Native. Con\xe7u initialement chez SoundCloud en 2012, Prometheus est aujourd'hui un projet gradu\xe9 de la Cloud Native Computing Foundation (CNCF). Cet article explore l'installation, le fonctionnement et les bases du langage de requ\xeate PromQL. \ud83d\udcca"}),"\n",(0,t.jsx)(s.h2,{id:"quest-ce-que-prometheus--",children:"Qu'est-ce que Prometheus ? \ud83e\udd14"}),"\n",(0,t.jsx)(s.p,{children:"Prometheus est un syst\xe8me de monitoring qui collecte et stocke des m\xe9triques sous forme de s\xe9ries temporelles (time-series). Il se distingue par :"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Architecture pull"})," : Prometheus r\xe9cup\xe8re activement les m\xe9triques depuis les cibles"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Mod\xe8le de donn\xe9es multi-dimensionnel"})," : m\xe9triques identifi\xe9es par un nom et des labels (cl\xe9-valeur)"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Langage de requ\xeate puissant"})," : PromQL pour interroger et agr\xe9ger les donn\xe9es"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Syst\xe8me d'alerting int\xe9gr\xe9"})," : d\xe9finition de r\xe8gles d'alerte directement dans Prometheus"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"D\xe9couverte de services"})," : int\xe9gration native avec Kubernetes, Consul, etc."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Stockage local"})," : pas de d\xe9pendance \xe0 un syst\xe8me de stockage distribu\xe9"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"architecture-de-prometheus-\ufe0f",children:"Architecture de Prometheus \ud83c\udfd7\ufe0f"}),"\n",(0,t.jsx)(s.p,{children:"L'architecture de Prometheus se compose de plusieurs \xe9l\xe9ments :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Prometheus Server                     \u2502\n\u2502                                                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502   Retrieval   \u2502  \u2502   Storage    \u2502  \u2502  HTTP Server \u2502 \u2502\n\u2502  \u2502   (Scraping)  \u2502\u2500\u25b6\u2502  (TSDB)      \u2502\u25c0\u2500\u2502  (PromQL)    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502         \u2502                                      \u25b2         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                                      \u2502\n          \u25bc                                      \u2502\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502   Exporters   \u2502                    \u2502   Grafana /     \u2502\n  \u2502   (Metrics)   \u2502                    \u2502   API Clients   \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502  Pushgateway   \u2502  (pour jobs courts)\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502  Alertmanager   \u2502  (gestion des alertes)\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Composants principaux :"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Prometheus Server"})," : collecte, stocke et permet d'interroger les m\xe9triques"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Exporters"})," : exposent les m\xe9triques des syst\xe8mes tiers au format Prometheus"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Pushgateway"})," : permet aux jobs courts de pousser leurs m\xe9triques"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Alertmanager"})," : g\xe8re les alertes (d\xe9duplication, groupage, routage, notifications)"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"installation-de-prometheus-",children:"Installation de Prometheus \ud83d\ude80"}),"\n",(0,t.jsx)(s.h3,{id:"installation-avec-docker",children:"Installation avec Docker"}),"\n",(0,t.jsx)(s.p,{children:"La m\xe9thode la plus simple pour tester Prometheus :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# T\xe9l\xe9charger et lancer Prometheus\ndocker run -d \\\n  --name prometheus \\\n  -p 9090:9090 \\\n  -v $(pwd)/prometheus.yml:/etc/prometheus/prometheus.yml \\\n  prom/prometheus\n"})}),"\n",(0,t.jsx)(s.h3,{id:"installation-binaire",children:"Installation binaire"}),"\n",(0,t.jsx)(s.p,{children:"Pour une installation plus traditionnelle :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# T\xe9l\xe9charger la derni\xe8re version\nwget https://github.com/prometheus/prometheus/releases/download/v2.45.0/prometheus-2.45.0.linux-amd64.tar.gz\n\n# Extraire\ntar xvfz prometheus-2.45.0.linux-amd64.tar.gz\ncd prometheus-2.45.0.linux-amd64\n\n# Lancer Prometheus\n./prometheus --config.file=prometheus.yml\n"})}),"\n",(0,t.jsx)(s.h3,{id:"installation-sur-kubernetes-avec-helm",children:"Installation sur Kubernetes avec Helm"}),"\n",(0,t.jsx)(s.p,{children:"Pour d\xe9ployer Prometheus dans un cluster Kubernetes :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Ajouter le repo Helm de Prometheus\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\n\n# Installer Prometheus\nhelm install prometheus prometheus-community/prometheus \\\n  --namespace monitoring \\\n  --create-namespace\n\n# V\xe9rifier le d\xe9ploiement\nkubectl get pods -n monitoring\n"})}),"\n",(0,t.jsx)(s.h3,{id:"configuration-de-base",children:"Configuration de base"}),"\n",(0,t.jsxs)(s.p,{children:["Cr\xe9ez un fichier ",(0,t.jsx)(s.code,{children:"prometheus.yml"})," avec la configuration minimale :"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"global:\n  scrape_interval: 15s      # Intervalle de collecte par d\xe9faut\n  evaluation_interval: 15s  # Intervalle d'\xe9valuation des r\xe8gles\n  external_labels:\n    cluster: 'dev'\n    environment: 'development'\n\n# R\xe8gles d'alerting (optionnel)\nrule_files:\n  - \"rules/*.yml\"\n\n# Configuration des cibles \xe0 scraper\nscrape_configs:\n  # Prometheus se monitore lui-m\xeame\n  - job_name: 'prometheus'\n    static_configs:\n      - targets: ['localhost:9090']\n        labels:\n          instance: 'prometheus-server'\n\n  # Exemple : monitorer Node Exporter\n  - job_name: 'node-exporter'\n    static_configs:\n      - targets: ['localhost:9100']\n        labels:\n          instance: 'server-01'\n"})}),"\n",(0,t.jsx)(s.h2,{id:"concepts-de-base--m\xe9triques-et-scraping-",children:"Concepts de base : M\xe9triques et Scraping \ud83d\udcc8"}),"\n",(0,t.jsx)(s.h3,{id:"les-types-de-m\xe9triques",children:"Les types de m\xe9triques"}),"\n",(0,t.jsx)(s.p,{children:"Prometheus supporte quatre types de m\xe9triques :"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Counter"})," : compteur qui ne peut qu'augmenter (ou se r\xe9initialiser \xe0 0)"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'http_requests_total{method="GET", status="200"} 1234\n'})}),"\n",(0,t.jsx)(s.p,{children:"Exemples : nombre de requ\xeates, erreurs, t\xe2ches compl\xe9t\xe9es"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Gauge"})," : valeur qui peut augmenter ou diminuer"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'memory_usage_bytes{instance="server-01"} 8589934592\n'})}),"\n",(0,t.jsx)(s.p,{children:"Exemples : temp\xe9rature, m\xe9moire utilis\xe9e, nombre de connexions actives"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Histogram"})," : \xe9chantillonne des observations et les compte dans des buckets"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'http_request_duration_seconds_bucket{le="0.1"} 100\nhttp_request_duration_seconds_bucket{le="0.5"} 250\nhttp_request_duration_seconds_bucket{le="1.0"} 300\n'})}),"\n",(0,t.jsx)(s.p,{children:"Exemples : dur\xe9e de requ\xeates, taille de r\xe9ponses"}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Summary"})," : similaire \xe0 histogram, mais calcule des quantiles c\xf4t\xe9 client"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'http_request_duration_seconds{quantile="0.5"} 0.23\nhttp_request_duration_seconds{quantile="0.9"} 0.87\nhttp_request_duration_seconds{quantile="0.99"} 1.2\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"le-mod\xe8le-de-donn\xe9es",children:"Le mod\xe8le de donn\xe9es"}),"\n",(0,t.jsx)(s.p,{children:"Chaque m\xe9trique dans Prometheus est identifi\xe9e par :"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Nom de la m\xe9trique"})," : d\xe9crit ce qui est mesur\xe9"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Labels"})," : paires cl\xe9-valeur pour distinguer les dimensions"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Exemple :"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'api_http_requests_total{method="POST", handler="/users", status="200"} 1234\n'})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Nom : ",(0,t.jsx)(s.code,{children:"api_http_requests_total"})]}),"\n",(0,t.jsxs)(s.li,{children:["Labels : ",(0,t.jsx)(s.code,{children:'method="POST"'}),", ",(0,t.jsx)(s.code,{children:'handler="/users"'}),", ",(0,t.jsx)(s.code,{children:'status="200"'})]}),"\n",(0,t.jsxs)(s.li,{children:["Valeur : ",(0,t.jsx)(s.code,{children:"1234"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"le-processus-de-scraping",children:"Le processus de scraping"}),"\n",(0,t.jsx)(s.p,{children:"Le scraping est le processus par lequel Prometheus collecte les m\xe9triques :"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Prometheus initie la connexion"})," vers la cible (pull model)"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Requ\xeate HTTP GET"})," sur l'endpoint ",(0,t.jsx)(s.code,{children:"/metrics"})]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"R\xe9ception des m\xe9triques"})," au format texte Prometheus"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Stockage"})," dans la base de donn\xe9es time-series"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Exemple de r\xe9ponse d'un endpoint ",(0,t.jsx)(s.code,{children:"/metrics"})," :"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'# HELP http_requests_total Total number of HTTP requests\n# TYPE http_requests_total counter\nhttp_requests_total{method="GET",status="200"} 1234\nhttp_requests_total{method="GET",status="404"} 42\nhttp_requests_total{method="POST",status="200"} 567\n\n# HELP memory_usage_bytes Current memory usage in bytes\n# TYPE memory_usage_bytes gauge\nmemory_usage_bytes 8589934592\n\n# HELP http_request_duration_seconds HTTP request duration\n# TYPE http_request_duration_seconds histogram\nhttp_request_duration_seconds_bucket{le="0.1"} 100\nhttp_request_duration_seconds_bucket{le="0.5"} 250\nhttp_request_duration_seconds_bucket{le="1.0"} 300\nhttp_request_duration_seconds_sum 187.5\nhttp_request_duration_seconds_count 300\n'})}),"\n",(0,t.jsx)(s.h2,{id:"exporters--collecter-des-m\xe9triques-",children:"Exporters : collecter des m\xe9triques \ud83d\udce1"}),"\n",(0,t.jsx)(s.p,{children:"Les exporters sont des programmes qui exposent des m\xe9triques de syst\xe8mes tiers au format Prometheus."}),"\n",(0,t.jsx)(s.h3,{id:"node-exporter-m\xe9triques-syst\xe8me",children:"Node Exporter (m\xe9triques syst\xe8me)"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'# Installation avec Docker\ndocker run -d \\\n  --name node-exporter \\\n  --net="host" \\\n  --pid="host" \\\n  -v "/:/host:ro,rslave" \\\n  prom/node-exporter \\\n  --path.rootfs=/host\n\n# Configuration dans prometheus.yml\nscrape_configs:\n  - job_name: \'node\'\n    static_configs:\n      - targets: [\'localhost:9100\']\n'})}),"\n",(0,t.jsx)(s.h3,{id:"exporters-populaires",children:"Exporters populaires"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"node_exporter"})," : m\xe9triques syst\xe8me (CPU, m\xe9moire, disque, r\xe9seau)"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"blackbox_exporter"})," : probes HTTP, TCP, ICMP, DNS"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"mysqld_exporter"})," : m\xe9triques MySQL/MariaDB"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"postgres_exporter"})," : m\xe9triques PostgreSQL"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"redis_exporter"})," : m\xe9triques Redis"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"nginx_exporter"})," : m\xe9triques Nginx"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"kube-state-metrics"})," : m\xe9triques d'\xe9tat Kubernetes"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"introduction-\xe0-promql-",children:"Introduction \xe0 PromQL \ud83d\udcca"}),"\n",(0,t.jsx)(s.p,{children:"PromQL (Prometheus Query Language) est le langage de requ\xeate pour interroger les m\xe9triques."}),"\n",(0,t.jsx)(s.h3,{id:"requ\xeates-de-base",children:"Requ\xeates de base"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-promql",children:'# S\xe9lectionner toutes les s\xe9ries d\'une m\xe9trique\nhttp_requests_total\n\n# Filtrer par label\nhttp_requests_total{method="GET"}\n\n# Filtrer avec plusieurs labels\nhttp_requests_total{method="GET", status="200"}\n\n# Op\xe9rateurs de correspondance\nhttp_requests_total{status=~"2.."} # Regex: status commence par 2\nhttp_requests_total{status!="200"} # status diff\xe9rent de 200\nhttp_requests_total{method=~"GET|POST"} # method est GET ou POST\n'})}),"\n",(0,t.jsx)(s.h3,{id:"s\xe9lecteurs-temporels",children:"S\xe9lecteurs temporels"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-promql",children:"# Valeur actuelle\nhttp_requests_total\n\n# Plage de temps (range vector)\nhttp_requests_total[5m] # Les 5 derni\xe8res minutes\n\n# D\xe9calage temporel (offset)\nhttp_requests_total offset 5m # Valeur d'il y a 5 minutes\nhttp_requests_total[1h] offset 1d # Les valeurs d'hier sur 1h\n"})}),"\n",(0,t.jsx)(s.h3,{id:"fonctions-courantes",children:"Fonctions courantes"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-promql",children:"# Rate : taux de changement par seconde (pour les counters)\nrate(http_requests_total[5m])\n\n# Increase : augmentation totale sur une p\xe9riode\nincrease(http_requests_total[1h])\n\n# Sum : somme des valeurs\nsum(http_requests_total)\n\n# Sum by : grouper par label\nsum by (method) (http_requests_total)\n\n# Avg : moyenne\navg(cpu_usage_percent)\n\n# Max / Min\nmax(memory_usage_bytes)\nmin(disk_free_bytes)\n\n# Count : nombre de s\xe9ries\ncount(up == 1) # Nombre de cibles up\n"})}),"\n",(0,t.jsx)(s.h3,{id:"op\xe9rations-math\xe9matiques",children:"Op\xe9rations math\xe9matiques"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-promql",children:"# Op\xe9rations arithm\xe9tiques\nnode_memory_MemTotal_bytes - node_memory_MemFree_bytes\n\n# Pourcentage\n(node_memory_MemTotal_bytes - node_memory_MemFree_bytes) / node_memory_MemTotal_bytes * 100\n\n# Comparaisons\nup == 1 # Toutes les cibles actives\nhttp_requests_total > 1000 # Requ\xeates sup\xe9rieures \xe0 1000\n"})}),"\n",(0,t.jsx)(s.h3,{id:"agr\xe9gations-avanc\xe9es",children:"Agr\xe9gations avanc\xe9es"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-promql",children:"# Grouper par plusieurs labels\nsum by (method, status) (rate(http_requests_total[5m]))\n\n# Exclure des labels du groupage\nsum without (instance) (rate(http_requests_total[5m]))\n\n# Top K\ntopk(5, http_requests_total) # Top 5 des s\xe9ries\n\n# Bottom K\nbottomk(3, rate(cpu_usage[5m])) # Bottom 3 des taux CPU\n"})}),"\n",(0,t.jsx)(s.h3,{id:"exemples-pratiques",children:"Exemples pratiques"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-promql",children:'# Taux de requ\xeates HTTP par seconde\nrate(http_requests_total[5m])\n\n# Taux d\'erreur HTTP (5xx)\nsum(rate(http_requests_total{status=~"5.."}[5m]))\n/\nsum(rate(http_requests_total[5m]))\n\n# Utilisation m\xe9moire en pourcentage\n100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))\n\n# Utilisation disque en pourcentage\n100 * (node_filesystem_size_bytes - node_filesystem_free_bytes) / node_filesystem_size_bytes\n\n# Latence p95 (histogram)\nhistogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))\n\n# Pr\xe9diction : disque plein dans combien de temps ?\npredict_linear(node_filesystem_free_bytes[1h], 4*3600) < 0\n'})}),"\n",(0,t.jsx)(s.h2,{id:"interface-web-de-prometheus-\ufe0f",children:"Interface Web de Prometheus \ud83d\udda5\ufe0f"}),"\n",(0,t.jsxs)(s.p,{children:["Prometheus embarque une interface web accessible sur ",(0,t.jsx)(s.code,{children:"http://localhost:9090"})," :"]}),"\n",(0,t.jsx)(s.h3,{id:"onglet-graph",children:"Onglet Graph"}),"\n",(0,t.jsx)(s.p,{children:"Permet d'ex\xe9cuter des requ\xeates PromQL et de visualiser les r\xe9sultats sous forme de graphique ou de tableau."}),"\n",(0,t.jsx)(s.h3,{id:"onglet-alerts",children:"Onglet Alerts"}),"\n",(0,t.jsx)(s.p,{children:"Affiche l'\xe9tat des r\xe8gles d'alerting et les alertes actives."}),"\n",(0,t.jsx)(s.h3,{id:"onglet-status",children:"Onglet Status"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Targets"})," : \xe9tat des cibles scrap\xe9es (up/down)"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Configuration"})," : configuration actuelle de Prometheus"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Rules"})," : r\xe8gles d'alerting et d'enregistrement charg\xe9es"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Service Discovery"})," : cibles d\xe9couvertes dynamiquement"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"d\xe9couverte-de-services-",children:"D\xe9couverte de services \ud83d\udd0d"}),"\n",(0,t.jsx)(s.p,{children:"Prometheus peut d\xe9couvrir automatiquement les cibles \xe0 monitorer."}),"\n",(0,t.jsx)(s.h3,{id:"d\xe9couverte-kubernetes",children:"D\xe9couverte Kubernetes"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"scrape_configs:\n  - job_name: 'kubernetes-pods'\n    kubernetes_sd_configs:\n      - role: pod\n    relabel_configs:\n      # Ne scraper que les pods avec l'annotation prometheus.io/scrape\n      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]\n        action: keep\n        regex: true\n      # Utiliser le port d\xe9fini dans l'annotation\n      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_port]\n        action: replace\n        target_label: __address__\n        regex: ([^:]+)(?::\\d+)?;(\\d+)\n        replacement: $1:$2\n      # Ajouter des labels depuis les annotations\n      - action: labelmap\n        regex: __meta_kubernetes_pod_label_(.+)\n"})}),"\n",(0,t.jsx)(s.h3,{id:"d\xe9couverte-avec-fichiers",children:"D\xe9couverte avec fichiers"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"scrape_configs:\n  - job_name: 'file_sd'\n    file_sd_configs:\n      - files:\n          - 'targets/*.json'\n          - 'targets/*.yml'\n        refresh_interval: 5m\n"})}),"\n",(0,t.jsxs)(s.p,{children:["Fichier ",(0,t.jsx)(s.code,{children:"targets/web-servers.json"})," :"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'[\n  {\n    "targets": ["web-01:9100", "web-02:9100"],\n    "labels": {\n      "job": "web-servers",\n      "environment": "production"\n    }\n  }\n]\n'})}),"\n",(0,t.jsx)(s.h2,{id:"bonnes-pratiques-",children:"Bonnes pratiques \ud83d\udc4d"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Nommer les m\xe9triques correctement"})," :"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Format : ",(0,t.jsx)(s.code,{children:"namespace_subsystem_unit_suffix"})]}),"\n",(0,t.jsxs)(s.li,{children:["Exemple : ",(0,t.jsx)(s.code,{children:"http_requests_total"}),", ",(0,t.jsx)(s.code,{children:"node_cpu_seconds_total"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Utiliser des labels judicieusement"})," :"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Labels pour les dimensions importantes (method, status, instance)"}),"\n",(0,t.jsx)(s.li,{children:"\xc9viter les labels avec une cardinalit\xe9 \xe9lev\xe9e (user_id, request_id)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Choisir le bon intervalle de scraping"})," :"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"15-60s pour la plupart des cas"}),"\n",(0,t.jsx)(s.li,{children:"Plus court pour des syst\xe8mes critiques"}),"\n",(0,t.jsx)(s.li,{children:"Plus long pour des m\xe9triques qui changent lentement"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Utiliser rate() pour les counters"})," :"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Ne jamais afficher un counter brut (il ne fait qu'augmenter)"}),"\n",(0,t.jsxs)(s.li,{children:["Toujours utiliser ",(0,t.jsx)(s.code,{children:"rate()"})," ou ",(0,t.jsx)(s.code,{children:"increase()"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"D\xe9finir des alertes pertinentes"})," :"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Alerter sur les sympt\xf4mes, pas sur les causes"}),"\n",(0,t.jsx)(s.li,{children:"\xc9viter les alertes redondantes"}),"\n",(0,t.jsx)(s.li,{children:"Pr\xe9voir des p\xe9riodes de silence (for: 5m)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"conclusion-",children:"Conclusion \ud83c\udfaf"}),"\n",(0,t.jsx)(s.p,{children:"Prometheus est devenu l'outil de monitoring de r\xe9f\xe9rence dans l'\xe9cosyst\xe8me Cloud Native. Sa simplicit\xe9 d'installation, son mod\xe8le de donn\xe9es flexible et son langage de requ\xeate puissant en font un choix excellent pour monitorer les infrastructures modernes."}),"\n",(0,t.jsx)(s.p,{children:"Les prochains articles aborderont :"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"La cr\xe9ation de dashboards avec Grafana"}),"\n",(0,t.jsx)(s.li,{children:"La configuration d'alertes avec Alertmanager"}),"\n",(0,t.jsx)(s.li,{children:"Le monitoring d'applications Kubernetes"}),"\n",(0,t.jsx)(s.li,{children:"L'optimisation des performances et du stockage"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"ressources-utiles-",children:"Ressources utiles \ud83d\udcda"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://prometheus.io/docs/",children:"Documentation officielle Prometheus"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://promlabs.com/promql-cheat-sheet/",children:"PromQL Cheat Sheet"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/roaldnefs/awesome-prometheus",children:"Awesome Prometheus"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://prometheus.io/docs/instrumenting/exporters/",children:"Prometheus Exporters"})}),"\n"]})]})}function c(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},28453(e,s,n){n.d(s,{R:()=>i,x:()=>o});var r=n(96540);const t={},l=r.createContext(t);function i(e){const s=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),r.createElement(l.Provider,{value:s},e.children)}},69740(e){e.exports=JSON.parse('{"permalink":"/pr-preview/pr-19/blog/2025/11/21/07-monitoring/prometheus-introduction","source":"@site/blog/07-monitoring/2025-11-21-prometheus-introduction.md","title":"Prometheus","description":"Prometheus, l\'outil de monitoring et d\'alerting open-source devenu incontournable dans l\'\xe9cosyst\xe8me Cloud Native.","date":"2025-11-21T00:00:00.000Z","tags":[{"inline":true,"label":"Prometheus","permalink":"/pr-preview/pr-19/blog/tags/prometheus"},{"inline":true,"label":"Monitoring","permalink":"/pr-preview/pr-19/blog/tags/monitoring"},{"inline":true,"label":"Observabilit\xe9","permalink":"/pr-preview/pr-19/blog/tags/observabilite"},{"inline":true,"label":"DevOps","permalink":"/pr-preview/pr-19/blog/tags/dev-ops"}],"readingTime":7.3,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Prometheus","description":"Prometheus, l\'outil de monitoring et d\'alerting open-source devenu incontournable dans l\'\xe9cosyst\xe8me Cloud Native.","tags":["Prometheus","Monitoring","Observabilit\xe9","DevOps"]},"unlisted":false,"prevItem":{"title":"Loki","permalink":"/pr-preview/pr-19/blog/2025/11/21/07-monitoring/loki-logs-management"},"nextItem":{"title":"Ansible : avanc\xe9","permalink":"/pr-preview/pr-19/blog/2025/11/21/08-iac/ansible-playbooks-avances"}}')}}]);