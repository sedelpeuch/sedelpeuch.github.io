<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-enseirb/s7/prog_sys/14" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Les threads POSIX | Sébastien Delpeuch</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://delpeuch.net/docs/enseirb/s7/prog_sys/14"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Les threads POSIX | Sébastien Delpeuch"><meta data-rh="true" name="description" content="La programmation par thread (activité) est naturelle pour gérer des phénomènes"><meta data-rh="true" property="og:description" content="La programmation par thread (activité) est naturelle pour gérer des phénomènes"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://delpeuch.net/docs/enseirb/s7/prog_sys/14"><link data-rh="true" rel="alternate" href="https://delpeuch.net/docs/enseirb/s7/prog_sys/14" hreflang="en"><link data-rh="true" rel="alternate" href="https://delpeuch.net/docs/enseirb/s7/prog_sys/14" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Sébastien Delpeuch&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Sébastien Delpeuch&#39;s Blog Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="Sébastien Delpeuch&#39;s Blog JSON Feed">





<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c9a3849aa75f9c4a4e65f846cd1a5155",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script>
<meta name="baidu-site-verification" content="code-rqLUw5reVS">
<script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js",t.defer=!0;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script>

<link rel="icon" href="/img/logo.png">
<meta name="theme-color" content="#12affa">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/misans@4.0.0/lib/Normal/MiSans-Normal.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/misans@4.0.0/lib/Normal/MiSans-Semibold.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="https://plausible.io/js/script.js" defer="defer" data-domain="delpeuch.net"></script><link rel="stylesheet" href="/assets/css/styles.5d6cffb3.css">
<script src="/assets/js/runtime~main.dfa8f3fa.js" defer="defer"></script>
<script src="/assets/js/main.45ec7f04.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="navbar" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.webp" alt="navbar" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/about">Résumé</a><a class="navbar__item navbar__link" href="/project">Projets</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/associatif">Associatif</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ENSEIRB-MATMECA</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/enseirb/s9">Semestre 9</a></li><li><a class="dropdown__link" href="/docs/enseirb/s8">Semestre 8</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/enseirb/s7">Semestre 7</a></li><li><a class="dropdown__link" href="/docs/enseirb/s6">Semestre 6</a></li><li><a class="dropdown__link" href="/docs/enseirb/s5">Semestre 5</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">CPBx</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/cpbx/s4">Semestre 4</a></li><li><a class="dropdown__link" href="/docs/cpbx/s3">Semestre 3</a></li><li><a class="dropdown__link" href="/docs/cpbx/s2">Semestre 2</a></li><li><a class="dropdown__link" href="/docs/cpbx/s1">Semestre 1</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/cpbx/">CPBx</a><button aria-label="Expand sidebar category &#x27;CPBx&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/enseirb/">ENSEIRB-MATMECA</a><button aria-label="Collapse sidebar category &#x27;ENSEIRB-MATMECA&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s5/">Semestre 5</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/enseirb/s6/">Semestre 6</a><button aria-label="Expand sidebar category &#x27;Semestre 6&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/enseirb/s7/">Semestre 7</a><button aria-label="Collapse sidebar category &#x27;Semestre 7&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/GL">Génie Logiciel </a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/enseirb/s7/TCP/">Architecture des réseaux TCP/IP</a><button aria-label="Expand sidebar category &#x27;Architecture des réseaux TCP/IP&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/enseirb/s7/bdd/">SGBD</a><button aria-label="Expand sidebar category &#x27;SGBD&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/enseirb/s7/compilation/">Compilation</a><button aria-label="Expand sidebar category &#x27;Compilation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/enseirb/s7/cpp/">Programmation C++</a><button aria-label="Expand sidebar category &#x27;Programmation C++&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/enseirb/s7/poo/">Programmation Orientée Objets</a><button aria-label="Expand sidebar category &#x27;Programmation Orientée Objets&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/enseirb/s7/prog_sys/">Programmation Système</a><button aria-label="Collapse sidebar category &#x27;Programmation Système&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/1">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/10">Les signaux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/11">Les verous de fichiers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/12">Algorithmes Distribués &amp; Interblocages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/13">Multiplexer des entrées-sorties</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/enseirb/s7/prog_sys/14">Les threads POSIX</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/2">Système de Gestion de Fichiers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/3">Le Buffer Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/4">La bibliothèque standard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/5">Appels système du Système de Gestion de Fichier</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/6">Les processus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/7">La mémoire</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/8">La mémoire virtuelle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/enseirb/s7/prog_sys/9">Tubes et tubes nommés</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/enseirb/s7/quantique/">Introduction à l&#x27;informatique quantique</a><button aria-label="Expand sidebar category &#x27;Introduction à l&#x27;informatique quantique&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/enseirb/s8/">Semestre 8</a><button aria-label="Expand sidebar category &#x27;Semestre 8&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/enseirb/s9/">Semestre 9</a><button aria-label="Expand sidebar category &#x27;Semestre 9&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/enseirb/"><span itemprop="name">ENSEIRB-MATMECA</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/enseirb/s7/"><span itemprop="name">Semestre 7</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/enseirb/s7/prog_sys/"><span itemprop="name">Programmation Système</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Les threads POSIX</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Les threads POSIX</h1></header><p>La programmation par thread (activité) est naturelle pour gérer des phénomènes
asynchrones. Les entrées utilisateur dans les interfaces graphiques (souris,
clavier) sont plus facile à gérer si l&#x27;on peut séparer l&#x27;activité principale du
logiciel de la gestion des commandes utilisateurs. Les entrées sorites multiples
sont gérées plus simplement en utilisant des threads.</p>
<p>Les activités sont une nouvelle façon de voire les processus dans un système.
L&#x27;idée est de séparer en deux le concept de processus. La première partie est
l&#x27;environnement d&#x27;exécution, on y retrouve une très grande partie des éléments
constitutifs d&#x27;un processus en particulier les informations sur le propriétaire,
la position dans l&#x27;arborescence le masque de création de fichier etc. La
deuxième partie est l&#x27;activité, c&#x27;est la partie dynamique, elle contient une
pile, un context processeur (pointeur d&#x27;instruction etc), et des données
d&#x27;ordonancement.</p>
<p>L&#x27;idée de ce découpage est de pouvoir associer plusieurs activité au même
environnement d&#x27;exécution. L&#x27;organisation en mémoire pour un processus UNIX avec
plusieurs threads est disponible dans la figure ci dessous</p>
<center><p><img decoding="async" loading="lazy" src="/assets/images/SYS7-5bb2691f9b7335b999d3723de7daacdf.png" width="646" height="874" class="img_ev3q"></p></center>
<p>On peut grâce au thread gérer plusieurs phénomènes asynchrone dans le même
contexte, c&#x27;est à dire, un espace d&#x27;adressage commun, ce qui est plus confortable
que de la mémoire partagée et moins coûteux en ressource que plusieurs processus
avec un segment de mémoire partagé. Un processus correspond à une instance d&#x27;un
programme en cours d&#x27;exécution. Un thread correspond à l&#x27;activité d&#x27;un
processeur dans le cadre d&#x27;un processus. Un thead ne peut pas exister sans
processus (la tâche englobante), mais il peut y avoir plusieurs thread par
processus dans le cas de linux il ne peut y avoir de tâche sans au moins une
activité.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="description">Description<a href="#description" class="hash-link" aria-label="Direct link to Description" title="Direct link to Description">​</a></h3>
<p>Un processus est composé des parties suivantes : du code, des données, une pile,
des descripteurs de fichiers, des tables de signaux. Du point de vue du noyau,
transférer l&#x27;exécution à un autre processus revient à rediriger les bons
pointeurs et recharger les registres du processeur de la pile. Les divers
threads d&#x27;un même processus peuvent partager certaines parties : le code, les
données, les descripteurs de fichiers, les tables de signaux. En fait, ils ont
au minimum leur propre pile, et partagent le reste.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fork-et-exec"><code>fork</code> et <code>exec</code><a href="#fork-et-exec" class="hash-link" aria-label="Direct link to fork-et-exec" title="Direct link to fork-et-exec">​</a></h3>
<p>Après un fork, le fils ne contient qu&#x27;une seule activité (celle qui a exécuté le
fork). Attention aux variables d&#x27;exclusion mutuelle (qui font parti de l&#x27;espace
d&#x27;adressage partagé) qui sont conservées après le <code>fork()</code> et donc le contenu ne
varie pas. Ainsi si une activité a pris le sémaphore avant le <code>fork()</code>, si
l&#x27;activité principale cherche à prendre ce sémaphore après le <code>fork()</code> elle sera
indéfiniment bloquée.</p>
<p>Après un <code>exec</code>, le processus ne contient plus que la thread qui a executé l&#x27;une
des six commandes <code>exec</code>. Pas de problème avec les sémaphores comme l&#x27;espace
d&#x27;adressage a changé.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clone"><code>clone</code><a href="#clone" class="hash-link" aria-label="Direct link to clone" title="Direct link to clone">​</a></h3>
<p>Sous linux (et rarement sous les sytèmes Unix) il existe un appel système un peu
spécial. Cet appel système réalise un dédoublement de processus comme <code>fork</code>
d&#x27;où son nom de <code>clone</code>. Cet appel système permet de préciser exactement ce que
l&#x27;on entend partager entre le processus père et le processus fils. Éléments
partageables :</p>
<ul>
<li><strong>ppid</strong> Création d&#x27;un frère au lieux d&#x27;un fils</li>
<li><strong>FS</strong> Partage de la structure d&#x27;information liée au système de fichier</li>
<li><strong>FILES</strong> Partage de la table des descripteurs</li>
<li><strong>SIGHAND</strong> Partage de la table des gestionnaires de Signaux, mais pas des
masques de signaux</li>
<li><strong>PTRACE</strong> Partage du crochet (hook) de debug voir l&#x27;appel ptrace</li>
<li><strong>VFORK</strong> Partage du processeur ! le processus père est bloqué tant que le
fils n&#x27;a pas exécuté soit <code>_exit</code> soit <code>execve</code>, c&#x27;est à dire qu&#x27;il s&#x27;est
détaché de tout les éléments partageable du processus père (sauf les <code>FILEs</code>)</li>
<li><strong>VM</strong> Partage de la mémoire virtuelle, en particulier les allocations et
désallocations par <code>mmap</code> et <code>munmap</code> sont visibles par les deux processus.</li>
<li><strong>pid</strong> Les deux processus ont le même numéro</li>
<li><strong>THREAD</strong> Partage du groupe de thread, les deux processus sont ou ne sont pas
dans le même groupe de threads.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="les-noms-de-fonctions">Les noms de fonctions<a href="#les-noms-de-fonctions" class="hash-link" aria-label="Direct link to Les noms de fonctions" title="Direct link to Les noms de fonctions">​</a></h3>
<p><code>pthread[_objet]_operation[_np]</code> où</p>
<ul>
<li><strong>objet</strong> désigne si il est présent le type de l&#x27;objet auquel la fonction
s&#x27;applique. Les valeurs possibles de objet peuvent être <code>cond</code> pour une
variable de condition et <code>mutex</code> pour un sémaphore d&#x27;exclusion mutuelle</li>
<li><strong>opération</strong> désigne l&#x27;opération a réaliser, par exemple <code>create</code>, <code>exit</code> ou
<code>init</code>.</li>
</ul>
<p>Le suffixe <code>np</code> indique, si il est présent, qu&#x27;il s&#x27;agit d&#x27;une fonction non
portable, c&#x27;est à dire Hors Norme.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="les-noms-de-types">Les noms de types<a href="#les-noms-de-types" class="hash-link" aria-label="Direct link to Les noms de types" title="Direct link to Les noms de types">​</a></h3>
<p><code>pthread[_objet]_t</code></p>
<p>avec objet prenant comme valeur cond, mutex ou rien pour une thread</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="attributs-dune-activité">Attributs d&#x27;une activité<a href="#attributs-dune-activité" class="hash-link" aria-label="Direct link to Attributs d&#x27;une activité" title="Direct link to Attributs d&#x27;une activité">​</a></h3>
<p>Identification d&#x27;une <code>pthread</code> : le TIP de type <code>pthread_t</code> obtenu par un appel
à la primitive : <code>pthread_t pthread_self(void);</code> pour le processus propriétaire
<code>pid_t getpid(void);</code>. En POSIX, le fait de tuer la thread de numéro 1 a pour
effet de tuer les processus ainsi que toutes les autres threads éventuelles du
processus. Pour tester l&#x27;égalité de deux pthreads on utilise <code>int pthread_equal(pthread_t tid1, pthread_t tid2);</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="création-et-terminaison-des-activités">Création et terminaison des activités<a href="#création-et-terminaison-des-activités" class="hash-link" aria-label="Direct link to Création et terminaison des activités" title="Direct link to Création et terminaison des activités">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="création">Création<a href="#création" class="hash-link" aria-label="Direct link to Création" title="Direct link to Création">​</a></h4>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_create</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_t</span><span class="token plain">      </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_tid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                   </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_attr_t</span><span class="token plain"> attr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                   </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain">           </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">fonction</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">arg</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                   </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain">           </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">arg</span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                  </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La création et l&#x27;activation d&#x27;une activité retourne -1 en cas d&#x27;échec, 0 sinon.</p>
<ul>
<li>le tid de la nouvelle thread est placé à l&#x27;adresse p_tid</li>
<li>attr attribut de l&#x27;activité (ordonnancement), utiliser pthread_attr_default</li>
<li>le paramètre fonction correspond à la fonction exécutée par l&#x27;activité après
sa création : il s&#x27;agit donc de son point d&#x27;entrée (comme la fonction main
pour les processus). Un retour de cette fonction correspondra à la terminaison
de cette activité</li>
<li>le paramètre arg est transmis à la fonction au lancement de l&#x27;activité</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="terminaison">Terminaison<a href="#terminaison" class="hash-link" aria-label="Direct link to Terminaison" title="Direct link to Terminaison">​</a></h4>
<ul>
<li>les appels UNIX <code>_exit</code> et donc <code>exit</code> terminent toutes les threads du
processus</li>
<li>terminaison d&#x27;une thread</li>
</ul>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_exit</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_status</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>p_status</code> code retour de la thread, comme dans les processus UNIX la thread est
zombifiée pour attendre la lecture du code de retour par une autre thread. À
l&#x27;inverse des processus, comme il peut y avoir plusieurs threads qui attendent,
la thread zombie n&#x27;est pas libérée par la lecture du <code>p_status</code>, il faut pour
cela utiliser une commande spéciale qui permettra de libérer effectivement
l&#x27;espace mémoire utilisé par la thread. Cette destruction est explicitement
demandée par la commande</p>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_detack</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_tid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Si un tel appel a lieu alors que l&#x27;activité est en cours d&#x27;exécution, cela
indique seulement qu&#x27;à l&#x27;exécution de pthread_exit les ressources seront
restituées.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="synchronisation">Synchronisation<a href="#synchronisation" class="hash-link" aria-label="Direct link to Synchronisation" title="Direct link to Synchronisation">​</a></h2>
<p>Trois mécanismes de synchronisation inter-activités :</p>
<ul>
<li>la primitive <code>join</code></li>
<li>les sémaphores d&#x27;exclusion mutuelle</li>
<li>les conditions (évènements)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="le-modèle-forkjoin-paterson">Le modèle fork/join (Paterson)<a href="#le-modèle-forkjoin-paterson" class="hash-link" aria-label="Direct link to Le modèle fork/join (Paterson)" title="Direct link to Le modèle fork/join (Paterson)">​</a></h3>
<p>Les rendez-vous : join</p>
<div class="language-cpp codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-cpp codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_join</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token plain">pthread_t tid</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">status</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Cette primitive permet de suspendre l&#x27;exécution de l&#x27;activité courante jusqu&#x27;à
ce que l&#x27;activité <code>tid</code> exécute un appel (implicite ou explicite) à
<code>pthread_exit</code>. Si l&#x27;activité <code>tid</code> est déjà terminée, le retour est immédiat,
et le code de retour de l&#x27;activité visée est égal à <code>**status</code> (double
indirection). La primitive retourne 0 en cas de succès et -1 en cas d&#x27;erreur.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="le-problème-de-lexclusion-mutuelle-sur-les-variables-gérées-par-le-noyau">Le problème de l&#x27;exclusion mutuelle sur les variables gérées par le noyau<a href="#le-problème-de-lexclusion-mutuelle-sur-les-variables-gérées-par-le-noyau" class="hash-link" aria-label="Direct link to Le problème de l&#x27;exclusion mutuelle sur les variables gérées par le noyau" title="Direct link to Le problème de l&#x27;exclusion mutuelle sur les variables gérées par le noyau">​</a></h3>
<p>Il est nécessaire d&#x27;avoir plusieurs variables <code>errno</code>, une par activité. En
effet cette variable globale pourrait être changée par une autre activité. Voir
plus loin comment définir des variables globales locales à chaque activité.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="les-sémaphores-dexclusion-mutuelle">Les sémaphores d&#x27;exclusion mutuelle<a href="#les-sémaphores-dexclusion-mutuelle" class="hash-link" aria-label="Direct link to Les sémaphores d&#x27;exclusion mutuelle" title="Direct link to Les sémaphores d&#x27;exclusion mutuelle">​</a></h3>
<p>Ces sémaphores binaires permettent d&#x27;assurer l&#x27;exclusion mutuelle.</p>
<ul>
<li>Il faut définir un objet de type <code>pthread_mutex_t</code> qui correspond à un
ensemble d&#x27;attributs de type <code>pthread_mutexattr_t</code></li>
<li>Initialiser la variable par un appel à la fonction</li>
</ul>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_mutex_init</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_mutex_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_mutex</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                       </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_mutexattr_t</span><span class="token plain"> attr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>On pourra détruire le sémaphore par un appel à la fonction <code>int pthread_mutex_destroy(pthread_mutex_t *p_mutex);</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="utilisation-des-sémaphores">Utilisation des sémaphores<a href="#utilisation-des-sémaphores" class="hash-link" aria-label="Direct link to Utilisation des sémaphores" title="Direct link to Utilisation des sémaphores">​</a></h3>
<p>Opération P : Un appel à la fonction <code>pthread_mutex_lock(pthread_mutex_t *pmutex);</code> permet à une activité de réaliser une opération P sur le sémaphore.
Si le sémaphore est déjà utilisé, l&#x27;activité est bloquée jusqu&#x27;à la réalisation
de l&#x27;opération V (par une autre activité) qui libèrera le sémaphore.</p>
<p>Opération P non bloquante : <code>pthread_mutex_trylock(pthread_mutex_t *pmutex);</code>
renvoie 1 si le sémaphore est libre, 0 si le sémaphore est occupé par une autre
activité et -1 en cas d&#x27;erreur.</p>
<p>Opération v : un appel à la fonction <code>pthread_mutex_unlock(pthread_mutex_t *pmutex);</code> réalise la libération du sémaphore désigné.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="les-conditions-évènements">Les conditions (évènements)<a href="#les-conditions-évènements" class="hash-link" aria-label="Direct link to Les conditions (évènements)" title="Direct link to Les conditions (évènements)">​</a></h3>
<p>Les conditions permettent de bloquer une activité sur une attente d&#x27;évènement.
Pour cela l&#x27;activité doit posséder un sémaphore, l&#x27;activité peut alors libérer
le sémaphore sur l&#x27;évènement, c&#x27;est à dire : elle libère le sémaphore, se bloque
en attente de l&#x27;évènement, à la réception de l&#x27;évènement elle reprend le
sémaphore. Initialisation d&#x27;une variable de type <code>pthread_cond_t</code> se fait avec
la fonction</p>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_cond_init</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_cond_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_cond</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_condattr_t</span><span class="token plain"> attr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>L&#x27;attente sur une condition se fait via la fonction suivante</p>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_cond_wait</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_cond_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_cond</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_mutex_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_mutex</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>libération du sémaphore <code>*p_mutex</code></li>
<li>activité mise en sommeil sur l&#x27;évènement</li>
<li>réception de l&#x27;évènement, récupération du sémaphore</li>
</ol>
<p>La condition est indépendante de l&#x27;évènement et n&#x27;est pas nécessairement valide
à la reception.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ordonnancement-des-activités">Ordonnancement des activités<a href="#ordonnancement-des-activités" class="hash-link" aria-label="Direct link to Ordonnancement des activités" title="Direct link to Ordonnancement des activités">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lordonnancement-posix-des-activités">L&#x27;ordonnancement POSIX des activités<a href="#lordonnancement-posix-des-activités" class="hash-link" aria-label="Direct link to L&#x27;ordonnancement POSIX des activités" title="Direct link to L&#x27;ordonnancement POSIX des activités">​</a></h3>
<p>L&#x27;ordonnancement des activités DCE basé sur POSIX est très similaire à
l&#x27;ordonnancement des activités sous MACH. Deux valeurs permettent de définir le
mode d&#x27;ordonnancement d&#x27;une activité : la politique et la priorité. Pour
manipuler ces deux valeurs, il vous faut créer un objet attribut d&#x27;activité
(pthread_attr) en appelant <code>pthread_attr_create()</code>, puis changer les valeurs par
défaut avec les fonctions décrites plus loin et créer la pthread avec cet objet
<code>pthread_attr</code>. Ou bien la pthread peut elle-même changer ses deux valeurs,
priorité et politique. Les fonctions sont :</p>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token macro property directive-hash" style="color:hsl(355, 65%, 65%)">#</span><span class="token macro property directive keyword" style="color:hsl(286, 60%, 67%)">include</span><span class="token macro property" style="color:hsl(355, 65%, 65%)"> </span><span class="token macro property string" style="color:hsl(95, 38%, 62%)">&lt;pthread.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_attr_setsched</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_attr_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">attr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> politique</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_attr_setprio</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_attr_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">attr</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> prio</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Les différentes politiques possibles sont :</p>
<ul>
<li><code>SCHED_FIFO</code> la thread la plus prioritaire s&#x27;exécute jusqu&#x27;à ce qu&#x27;elle
bloque. Si il y a plus d&#x27;une pthread de priorité maximum, la première qui
obtient le cpu s&#x27;exécute jusqu&#x27;à ce qu&#x27;elle bloque</li>
<li><code>SCHED_RR</code> Round Robin. La thread la plus prioritaire s&#x27;exécute jusqu&#x27;à ce
qu&#x27;elle bloque. Les threads de même priorités maximum sont organisées avec le
principe du tourniquet, c&#x27;est à dire qu&#x27;il existe un quantum de temps au bout
duquel le cpu est préempté pour une autre thread.</li>
<li><code>SCHED_OTHER</code> Comportement par défaut. Tous les threads sont dans le même
tourniquet, il n&#x27;y a pas de niveau de priorité, ceci permet l&#x27;absence de
famine. Mais les threads avec une politique <code>SCHED_FIFO</code> ou <code>SCHED_RR</code> peuvent
placer les threads <code>SCHED_OTHER</code> en situation de famine.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="les-variables-spécifiques-à-une-thread">Les variables spécifiques à une thread<a href="#les-variables-spécifiques-à-une-thread" class="hash-link" aria-label="Direct link to Les variables spécifiques à une thread" title="Direct link to Les variables spécifiques à une thread">​</a></h3>
<p>Avec un processus multi-thread, nous sommes dans une situation de partage de
données. Toutes les données du processus sont à priori manipulables par toutes
les threads. Or certainns données sont critiques et difficilement partageables.
Premièrement ce sont les données de la bibliothèque standard. Pour les fonctions
de la bibliothèque standard, on peut résoudre le problème en utilisant un
sémaphore d&#x27;exclusion mutuelle <code>pthread_mutex_t</code> pour POSIX.</p>
<p>Mais certaines variables ne peuvent être protégées. C&#x27;est le cas de la variable
<code>errno</code>, comme nous l&#x27;avons vu précédemment. Pour cette variable, la solution
est d&#x27;avoir une variable par thread. Ainsi le fichier <code>&lt;errno.h&gt;</code> contient</p>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token keyword" style="color:hsl(286, 60%, 67%)">extern</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token function" style="color:hsl(207, 82%, 66%)">_errno</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token macro property directive-hash" style="color:hsl(355, 65%, 65%)">#</span><span class="token macro property directive keyword" style="color:hsl(286, 60%, 67%)">define</span><span class="token macro property" style="color:hsl(355, 65%, 65%)"> </span><span class="token macro property macro-name" style="color:hsl(355, 65%, 65%)">errno</span><span class="token macro property" style="color:hsl(355, 65%, 65%)"> </span><span class="token macro property expression punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token macro property expression operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token macro property expression function" style="color:hsl(207, 82%, 66%)">_errno</span><span class="token macro property expression punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token macro property expression punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token macro property expression punctuation" style="color:hsl(220, 14%, 71%)">)</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>La valeur <code>errno</code> est obtenue par une fonction qui retourne la valeur de <code>errno</code>
associée à la thread qui fait l&#x27;appel à <code>_errno</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="principe-général-des-données-spécifiques-posix">Principe général des données spécifiques, POSIX<a href="#principe-général-des-données-spécifiques-posix" class="hash-link" aria-label="Direct link to Principe général des données spécifiques, POSIX" title="Direct link to Principe général des données spécifiques, POSIX">​</a></h3>
<p>L&#x27;idée des données spécifique est de créer un vecteur pour chaque donnée
spécifique. Ainsi pour des données spécifique statiques, chaque thread possède
son propre exemplaire. Les données spécifiques sont identifiées par des clés de
type <code>pthread_key_t</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="création-de-clés">Création de clés<a href="#création-de-clés" class="hash-link" aria-label="Direct link to Création de clés" title="Direct link to Création de clés">​</a></h3>
<p>La création d&#x27;une clé est liée à la création d&#x27;un tableau statique (variable
globale), initialisé à NULL à la création. La fonction</p>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token macro property directive-hash" style="color:hsl(355, 65%, 65%)">#</span><span class="token macro property directive keyword" style="color:hsl(286, 60%, 67%)">include</span><span class="token macro property" style="color:hsl(355, 65%, 65%)"> </span><span class="token macro property string" style="color:hsl(95, 38%, 62%)">&lt;pthread.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_keycreate</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_key_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_cle</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain">                      </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">destructeur</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">valeur</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>permet la création du tableau, 0 succès et -1 échec. La structure pointée par
<code>p_cle</code> nous permettra d&#x27;accéder aux valeurs stockées, la clé est évidemment la
même pour toutes les threads. Le paramètre <code>destructeur</code> de type pointeur sur
fonction prenant un pointeur sur void en paramètre et renvoyant void, donne
l&#x27;adresse d&#x27;une fonction qui est exécutée à la terminaison de la thread (ce qui
permet de faire le ménage). Si ce pointeur est nul, l&#x27;information n&#x27;est pas
détruite à la terminaison de l&#x27;activité.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lecture--écriture-dune-variable-spécifique">Lecture / écriture d&#x27;une variable spécifique<a href="#lecture--écriture-dune-variable-spécifique" class="hash-link" aria-label="Direct link to Lecture / écriture d&#x27;une variable spécifique" title="Direct link to Lecture / écriture d&#x27;une variable spécifique">​</a></h3>
<p>La fonction</p>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token macro property directive-hash" style="color:hsl(355, 65%, 65%)">#</span><span class="token macro property directive keyword" style="color:hsl(286, 60%, 67%)">include</span><span class="token macro property" style="color:hsl(355, 65%, 65%)"> </span><span class="token macro property string" style="color:hsl(95, 38%, 62%)">&lt;pthread.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_getspecific</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_key_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_clé</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">pvaleur</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>permet la lecture de la valeur qui est copiée à l&#x27;adresse <code>pvaleur</code> retourne 0
ou -1 selon que l&#x27;appel a réussi ou non. La fonction</p>
<div class="language-c codeBlockContainer_APcc theme-code-block" style="--prism-background-color:hsl(220, 13%, 18%);--prism-color:hsl(220, 14%, 71%)"><div class="codeBlockContent_m3Ux"><pre tabindex="0" class="prism-code language-c codeBlock_qGQc thin-scrollbar" style="background-color:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><code class="codeBlockLines_p187"><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token macro property directive-hash" style="color:hsl(355, 65%, 65%)">#</span><span class="token macro property directive keyword" style="color:hsl(286, 60%, 67%)">include</span><span class="token macro property" style="color:hsl(355, 65%, 65%)"> </span><span class="token macro property string" style="color:hsl(95, 38%, 62%)">&lt;pthread.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3)"><span class="token plain"></span><span class="token keyword" style="color:hsl(286, 60%, 67%)">int</span><span class="token plain"> </span><span class="token function" style="color:hsl(207, 82%, 66%)">pthread_setspecific</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">(</span><span class="token class-name" style="color:hsl(29, 54%, 61%)">pthread_key_t</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">p_clé</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(286, 60%, 67%)">void</span><span class="token plain"> </span><span class="token operator" style="color:hsl(207, 82%, 66%)">*</span><span class="token plain">valeur</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">)</span><span class="token punctuation" style="color:hsl(220, 14%, 71%)">;</span><br></span></code></pre><div class="buttonGroup_6DOT"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FhaS" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_phi_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_FfTR"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>permet la création du tableau, 0 succès et -1 échec. La structure pointée par
<code>p_cle</code> nous permettra d&#x27;accéder aux valeurs stockées, la clé est évidemment la
même pour toutes les threads. Le paramètre <code>destructeur</code> de type pointeur sur
fonction prenant un pointeur sur void en paramètre et renvoyant void, donne
l&#x27;adresse d&#x27;une fonction qui est exécutée à la terminaison de la thread (ce qui
permet de faire le ménage). Si ce pointeur est nul, l&#x27;information n&#x27;est pas
détruite à la terminaison de l&#x27;activité.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="les-fonctions-standardes-utilisant-des-zones-statiques">Les fonctions standardes utilisant des zones statiques<a href="#les-fonctions-standardes-utilisant-des-zones-statiques" class="hash-link" aria-label="Direct link to Les fonctions standardes utilisant des zones statiques" title="Direct link to Les fonctions standardes utilisant des zones statiques">​</a></h2>
<p>Certaines fonctions standardes comme <code>ttyname()</code> ou <code>readdir()</code> retourne
l&#x27;adresse d&#x27;une zone statique. Plusieurs threads en concurrence peuvent donc
nous amener à des situations incohérentes. La solution des sémaphores
d&#x27;exclusion étant coûteuse, ces fonctions sont réécrites pour la bibliothèque de
thread de façon à être réentrantes.</p>
<p>Attention les problèmes de réentrance peuvent avoir lieu en utilisant des appels
systèmes non réentrant dans les handlers des signaux ! Ceci sans utiliser de
threads !</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/enseirb/s7/prog_sys/13"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Multiplexer des entrées-sorties</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/enseirb/s7/prog_sys/2"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Système de Gestion de Fichiers</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_jeP5 thin-scrollbar theme-doc-toc-desktop" style="opacity:0;transform:translateX(100px) translateZ(0)"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#description" class="table-of-contents__link toc-highlight">Description</a></li><li><a href="#fork-et-exec" class="table-of-contents__link toc-highlight"><code>fork</code> et <code>exec</code></a></li><li><a href="#clone" class="table-of-contents__link toc-highlight"><code>clone</code></a></li><li><a href="#les-noms-de-fonctions" class="table-of-contents__link toc-highlight">Les noms de fonctions</a></li><li><a href="#les-noms-de-types" class="table-of-contents__link toc-highlight">Les noms de types</a></li><li><a href="#attributs-dune-activité" class="table-of-contents__link toc-highlight">Attributs d&#39;une activité</a></li><li><a href="#création-et-terminaison-des-activités" class="table-of-contents__link toc-highlight">Création et terminaison des activités</a></li><li><a href="#synchronisation" class="table-of-contents__link toc-highlight">Synchronisation</a><ul><li><a href="#le-modèle-forkjoin-paterson" class="table-of-contents__link toc-highlight">Le modèle fork/join (Paterson)</a></li><li><a href="#le-problème-de-lexclusion-mutuelle-sur-les-variables-gérées-par-le-noyau" class="table-of-contents__link toc-highlight">Le problème de l&#39;exclusion mutuelle sur les variables gérées par le noyau</a></li><li><a href="#les-sémaphores-dexclusion-mutuelle" class="table-of-contents__link toc-highlight">Les sémaphores d&#39;exclusion mutuelle</a></li><li><a href="#utilisation-des-sémaphores" class="table-of-contents__link toc-highlight">Utilisation des sémaphores</a></li><li><a href="#les-conditions-évènements" class="table-of-contents__link toc-highlight">Les conditions (évènements)</a></li></ul></li><li><a href="#ordonnancement-des-activités" class="table-of-contents__link toc-highlight">Ordonnancement des activités</a><ul><li><a href="#lordonnancement-posix-des-activités" class="table-of-contents__link toc-highlight">L&#39;ordonnancement POSIX des activités</a></li><li><a href="#les-variables-spécifiques-à-une-thread" class="table-of-contents__link toc-highlight">Les variables spécifiques à une thread</a></li><li><a href="#principe-gén éral-des-données-spécifiques-posix" class="table-of-contents__link toc-highlight">Principe général des données spécifiques, POSIX</a></li><li><a href="#création-de-clés" class="table-of-contents__link toc-highlight">Création de clés</a></li><li><a href="#lecture--écriture-dune-variable-spécifique" class="table-of-contents__link toc-highlight">Lecture / écriture d&#39;une variable spécifique</a></li></ul></li><li><a href="#les-fonctions-standardes-utilisant-des-zones-statiques" class="table-of-contents__link toc-highlight">Les fonctions standardes utilisant des zones statiques</a></li></ul><hr class="hr_UhE0"><span class="percent_H6RK">0%<!-- --> </span></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sedelpeuch" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>