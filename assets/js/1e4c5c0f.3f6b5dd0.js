"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[6136],{20656(e){e.exports=JSON.parse('{"permalink":"/blog/2025/11/21/09-scripting/python-async-await","source":"@site/blog/09-scripting/2025-11-21-python-async-await.md","title":"Python : async/await","description":"Ma\xeetrisez la programmation asynchrone en Python pour cr\xe9er des applications performantes et r\xe9actives.","date":"2025-11-21T00:00:00.000Z","tags":[{"inline":true,"label":"Python","permalink":"/blog/tags/python"},{"inline":true,"label":"Async","permalink":"/blog/tags/async"},{"inline":true,"label":"Asyncio","permalink":"/blog/tags/asyncio"},{"inline":true,"label":"Performance","permalink":"/blog/tags/performance"},{"inline":true,"label":"FastAPI","permalink":"/blog/tags/fast-api"},{"inline":true,"label":"DevOps","permalink":"/blog/tags/dev-ops"}],"readingTime":9.92,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Python : async/await","description":"Ma\xeetrisez la programmation asynchrone en Python pour cr\xe9er des applications performantes et r\xe9actives.","tags":["Python","Async","Asyncio","Performance","FastAPI","DevOps"]},"unlisted":false,"prevItem":{"title":"Ansible : avanc\xe9","permalink":"/blog/2025/11/21/08-iac/ansible-playbooks-avances"},"nextItem":{"title":"API : REST vs GraphQL","permalink":"/blog/2025/08/04/09-scripting/graphql"}}')},28453(e,n,s){s.d(n,{R:()=>i,x:()=>o});var t=s(96540);const r={},a=t.createContext(r);function i(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:n},e.children)}},87985(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>c});var t=s(20656),r=s(74848),a=s(28453);const i={title:"Python : async/await",description:"Ma\xeetrisez la programmation asynchrone en Python pour cr\xe9er des applications performantes et r\xe9actives.",tags:["Python","Async","Asyncio","Performance","FastAPI","DevOps"]},o=void 0,l={authorsImageUrls:[]},c=[{value:"Comprendre la programmation asynchrone \ud83e\udd14",id:"comprendre-la-programmation-asynchrone-",level:2},{value:"Le probl\xe8me : l&#39;attente inutile",id:"le-probl\xe8me--lattente-inutile",level:3},{value:"La solution : l&#39;asynchrone",id:"la-solution--lasynchrone",level:3},{value:"Quand utiliser l&#39;asynchrone ?",id:"quand-utiliser-lasynchrone-",level:3},{value:"Les bases d&#39;async/await \ud83d\udcda",id:"les-bases-dasyncawait-",level:2},{value:"Les coroutines : des fonctions &quot;pausables&quot;",id:"les-coroutines--des-fonctions-pausables",level:3},{value:"Le mot-cl\xe9 <code>await</code> : point de suspension",id:"le-mot-cl\xe9-await--point-de-suspension",level:3},{value:"Ex\xe9cuter plusieurs coroutines en parall\xe8le",id:"ex\xe9cuter-plusieurs-coroutines-en-parall\xe8le",level:3},{value:"asyncio : fonctionnalit\xe9s essentielles \ud83d\udee0\ufe0f",id:"asyncio--fonctionnalit\xe9s-essentielles-\ufe0f",level:2},{value:"L&#39;Event Loop : le chef d&#39;orchestre",id:"levent-loop--le-chef-dorchestre",level:3},{value:"Gestion des erreurs : ne pas tout casser",id:"gestion-des-erreurs--ne-pas-tout-casser",level:3},{value:"Timeouts : limiter le temps d&#39;attente",id:"timeouts--limiter-le-temps-dattente",level:3},{value:"Requ\xeates HTTP asynchrones \ud83c\udf10",id:"requ\xeates-http-asynchrones-",level:2},{value:"Le cas d&#39;usage parfait pour l&#39;asynchrone",id:"le-cas-dusage-parfait-pour-lasynchrone",level:3},{value:"Avec httpx : le client HTTP asynchrone",id:"avec-httpx--le-client-http-asynchrone",level:3},{value:"Int\xe9gration avec FastAPI \ud83d\ude80",id:"int\xe9gration-avec-fastapi-",level:2},{value:"Pourquoi FastAPI et async sont faits l&#39;un pour l&#39;autre",id:"pourquoi-fastapi-et-async-sont-faits-lun-pour-lautre",level:3},{value:"Routes asynchrones",id:"routes-asynchrones",level:3},{value:"Base de donn\xe9es asynchrone avec SQLAlchemy",id:"base-de-donn\xe9es-asynchrone-avec-sqlalchemy",level:3},{value:"Cache Redis asynchrone",id:"cache-redis-asynchrone",level:3},{value:"Patterns avanc\xe9s \ud83c\udfaf",id:"patterns-avanc\xe9s-",level:2},{value:"Limiter la concurrence avec Semaphore",id:"limiter-la-concurrence-avec-semaphore",level:3},{value:"Retry avec backoff exponentiel",id:"retry-avec-backoff-exponentiel",level:3},{value:"Context Manager asynchrone",id:"context-manager-asynchrone",level:3},{value:"Bonnes pratiques \ud83d\udc1b",id:"bonnes-pratiques-",level:2},{value:"Erreurs courantes \xe0 \xe9viter",id:"erreurs-courantes-\xe0-\xe9viter",level:3},{value:"1. Oublier le <code>await</code>",id:"1-oublier-le-await",level:4},{value:"2. Bloquer l&#39;event loop",id:"2-bloquer-levent-loop",level:4},{value:"3. N\xe9gliger la gestion des ressources",id:"3-n\xe9gliger-la-gestion-des-ressources",level:4},{value:"Mode debug : d\xe9tecter les probl\xe8mes",id:"mode-debug--d\xe9tecter-les-probl\xe8mes",level:3},{value:"Conclusion \ud83c\udfaf",id:"conclusion-",level:2},{value:"Ressources utiles \ud83d\udcda",id:"ressources-utiles-",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["La programmation asynchrone est devenue essentielle pour cr\xe9er des applications Python performantes, notamment pour les APIs, les web scrapers, ou les applications traitant de nombreuses op\xe9rations I/O. Dans cet article, nous explorerons en profondeur ",(0,r.jsx)(n.code,{children:"async"}),"/",(0,r.jsx)(n.code,{children:"await"})," et ",(0,r.jsx)(n.code,{children:"asyncio"}),", avec des cas d'usage pratiques notamment avec FastAPI. \ud83d\ude80"]}),"\n",(0,r.jsx)(n.h2,{id:"comprendre-la-programmation-asynchrone-",children:"Comprendre la programmation asynchrone \ud83e\udd14"}),"\n",(0,r.jsx)(n.h3,{id:"le-probl\xe8me--lattente-inutile",children:"Le probl\xe8me : l'attente inutile"}),"\n",(0,r.jsx)(n.p,{children:"Dans un programme synchrone classique, chaque op\xe9ration attend la fin de la pr\xe9c\xe9dente, m\xeame si elle ne fait rien d'utile pendant ce temps. C'est comme faire la queue au supermarch\xe9 : si la caissi\xe8re attend que le client pr\xe9c\xe9dent range ses courses dans son sac, tout le monde attend inutilement."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Exemple concret :"})," Imaginez une application qui doit r\xe9cup\xe9rer des donn\xe9es depuis 3 APIs diff\xe9rentes. En mode synchrone, le programme attend la r\xe9ponse de l'API 1 (2 secondes), puis attend l'API 2 (2 secondes), puis l'API 3 (2 secondes) = ",(0,r.jsx)(n.strong,{children:"6 secondes au total"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"la-solution--lasynchrone",children:"La solution : l'asynchrone"}),"\n",(0,r.jsx)(n.p,{children:"La programmation asynchrone permet de ne pas rester bloqu\xe9 pendant les op\xe9rations d'attente (I/O). Pendant qu'une requ\xeate HTTP est en cours, le programme peut lancer d'autres requ\xeates ou effectuer d'autres t\xe2ches."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Avec l'asynchrone :"})," Les 3 requ\xeates sont lanc\xe9es simultan\xe9ment, et le programme attend seulement le temps de la plus longue = ",(0,r.jsx)(n.strong,{children:"2 secondes au total"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import asyncio\n\nasync def faire_requete(url):\n    await asyncio.sleep(2)  # Simule une requ\xeate HTTP\n    return f"Donn\xe9es de {url}"\n\nasync def main():\n    # Les 3 requ\xeates s\'ex\xe9cutent en parall\xe8le\n    resultats = await asyncio.gather(\n        faire_requete("api.example.com/1"),\n        faire_requete("api.example.com/2"),\n        faire_requete("api.example.com/3")\n    )\n    return resultats\n\nasyncio.run(main())\n'})}),"\n",(0,r.jsx)(n.h3,{id:"quand-utiliser-lasynchrone-",children:"Quand utiliser l'asynchrone ?"}),"\n",(0,r.jsxs)(n.p,{children:["L'asynchrone est efficace uniquement pour les op\xe9rations ",(0,r.jsx)(n.strong,{children:"I/O-bound"})," (limit\xe9es par les entr\xe9es/sorties), pas pour les calculs ",(0,r.jsx)(n.strong,{children:"CPU-bound"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Bon pour (I/O-bound) :"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Requ\xeates HTTP/API : attente r\xe9seau"}),"\n",(0,r.jsx)(n.li,{children:"Op\xe9rations de base de donn\xe9es : attente disque/r\xe9seau"}),"\n",(0,r.jsx)(n.li,{children:"Lecture/\xe9criture de fichiers : attente disque"}),"\n",(0,r.jsx)(n.li,{children:"WebSockets : attente de messages"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u274c ",(0,r.jsx)(n.strong,{children:"Pas adapt\xe9 pour (CPU-bound) :"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Calculs math\xe9matiques complexes"}),"\n",(0,r.jsx)(n.li,{children:"Traitement d'images/vid\xe9os"}),"\n",(0,r.jsx)(n.li,{children:"Compression de donn\xe9es"}),"\n",(0,r.jsxs)(n.li,{children:["Pour ces cas, utiliser ",(0,r.jsx)(n.code,{children:"multiprocessing"})," ou ",(0,r.jsx)(n.code,{children:"threading"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"les-bases-dasyncawait-",children:"Les bases d'async/await \ud83d\udcda"}),"\n",(0,r.jsx)(n.h3,{id:"les-coroutines--des-fonctions-pausables",children:'Les coroutines : des fonctions "pausables"'}),"\n",(0,r.jsxs)(n.p,{children:["Une ",(0,r.jsx)(n.strong,{children:"coroutine"})," est une fonction sp\xe9ciale qui peut \xeatre suspendue et reprise. Elle se d\xe9clare avec ",(0,r.jsx)(n.code,{children:"async def"})," au lieu de ",(0,r.jsx)(n.code,{children:"def"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Concept cl\xe9 :"})," Une coroutine ne s'ex\xe9cute pas imm\xe9diatement quand on l'appelle. Elle retourne un objet \"coroutine\" qui doit \xeatre ",(0,r.jsx)(n.code,{children:"await"}),"\xe9 pour s'ex\xe9cuter r\xe9ellement."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def fonction_async():\n    return \"Hello\"\n\n# \u274c Ceci ne fait RIEN, retourne juste un objet coroutine\nresultat = fonction_async()\n\n# \u2705 Pour ex\xe9cuter, il faut await dans un contexte async\nasync def main():\n    resultat = await fonction_async()  # Maintenant \xe7a s'ex\xe9cute\n    print(resultat)\n\nasyncio.run(main())  # Point d'entr\xe9e pour d\xe9marrer l'async\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"le-mot-cl\xe9-await--point-de-suspension",children:["Le mot-cl\xe9 ",(0,r.jsx)(n.code,{children:"await"})," : point de suspension"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"await"})," signifie \"attends que cette op\xe9ration se termine, mais pendant ce temps, laisse d'autres t\xe2ches s'ex\xe9cuter\"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Analogie :"})," C'est comme dire \"je mets cette t\xe2che en pause, fais autre chose en attendant, et reviens me voir quand c'est pr\xeat\"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'async def operation_longue():\n    print("D\xe9but")\n    await asyncio.sleep(2)  # "Pause ici pendant 2s, fais autre chose"\n    print("Fin")\n    return "Termin\xe9"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"ex\xe9cuter-plusieurs-coroutines-en-parall\xe8le",children:"Ex\xe9cuter plusieurs coroutines en parall\xe8le"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Le probl\xe8me :"})," Comment lancer plusieurs t\xe2ches asynchrones en m\xeame temps ?"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Solution 1 : ",(0,r.jsx)(n.code,{children:"asyncio.gather()"})]})," - Lance tout en parall\xe8le et attend tous les r\xe9sultats"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'async def tache(nom, duree):\n    await asyncio.sleep(duree)\n    return f"{nom} termin\xe9e"\n\nasync def main():\n    # Les 3 t\xe2ches d\xe9marrent en m\xeame temps\n    resultats = await asyncio.gather(\n        tache("T\xe2che 1", 2),\n        tache("T\xe2che 2", 1),\n        tache("T\xe2che 3", 3)\n    )\n    # Attend que TOUTES soient finies\n    print(resultats)  # [\'T\xe2che 1 termin\xe9e\', \'T\xe2che 2 termin\xe9e\', \'T\xe2che 3 termin\xe9e\']\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsxs)(n.strong,{children:["Solution 2 : ",(0,r.jsx)(n.code,{children:"asyncio.create_task()"})]})," - Plus de contr\xf4le individuel"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'async def main():\n    # D\xe9marre la t\xe2che imm\xe9diatement en arri\xe8re-plan\n    task = asyncio.create_task(tache("A", 1))\n\n    # Fait autre chose...\n    print("La t\xe2che tourne en arri\xe8re-plan")\n\n    # Attend le r\xe9sultat quand n\xe9cessaire\n    resultat = await task\n'})}),"\n",(0,r.jsx)(n.h2,{id:"asyncio--fonctionnalit\xe9s-essentielles-\ufe0f",children:"asyncio : fonctionnalit\xe9s essentielles \ud83d\udee0\ufe0f"}),"\n",(0,r.jsx)(n.h3,{id:"levent-loop--le-chef-dorchestre",children:"L'Event Loop : le chef d'orchestre"}),"\n",(0,r.jsxs)(n.p,{children:["L'",(0,r.jsx)(n.strong,{children:"event loop"})," (boucle d'\xe9v\xe9nements) est le moteur qui g\xe8re l'ex\xe9cution de toutes les coroutines. C'est lui qui d\xe9cide quelle t\xe2che ex\xe9cuter et quand."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Analogie :"})," C'est comme un chef d'orchestre qui coordonne tous les musiciens (coroutines). Quand un musicien doit faire une pause (await), le chef donne la parole \xe0 un autre."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'async def hello():\n    await asyncio.sleep(1)\n    print("World")\n\n# asyncio.run() cr\xe9e l\'event loop, ex\xe9cute la coroutine, puis nettoie\nasyncio.run(hello())\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Point important :"})," ",(0,r.jsx)(n.code,{children:"asyncio.run()"})," est le point d'entr\xe9e principal. C'est lui qui d\xe9marre l'event loop et permet \xe0 tout le syst\xe8me asynchrone de fonctionner."]}),"\n",(0,r.jsx)(n.h3,{id:"gestion-des-erreurs--ne-pas-tout-casser",children:"Gestion des erreurs : ne pas tout casser"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Le probl\xe8me :"})," Si une t\xe2che \xe9choue avec ",(0,r.jsx)(n.code,{children:"gather()"}),", par d\xe9faut toutes les autres sont annul\xe9es."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"La solution :"})," ",(0,r.jsx)(n.code,{children:"return_exceptions=True"})," capture les erreurs comme des r\xe9sultats normaux."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# Sans return_exceptions : si operation_risquee(2) \xe9choue, tout s\'arr\xeate\nresultats = await asyncio.gather(\n    operation_risquee(1),  # R\xe9ussit\n    operation_risquee(2),  # \xc9choue\n    operation_risquee(3),  # Ne s\'ex\xe9cute jamais\n)\n\n# Avec return_exceptions : toutes s\'ex\xe9cutent, les erreurs sont dans les r\xe9sultats\nresultats = await asyncio.gather(\n    operation_risquee(1),\n    operation_risquee(2),\n    operation_risquee(3),\n    return_exceptions=True  # Les exceptions sont retourn\xe9es comme r\xe9sultats\n)\n# resultats = ["Succ\xe8s 1", Exception(...), "Succ\xe8s 3"]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"timeouts--limiter-le-temps-dattente",children:"Timeouts : limiter le temps d'attente"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Utilit\xe9 :"})," \xc9viter d'attendre ind\xe9finiment une op\xe9ration qui ne r\xe9pond plus."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'try:\n    # Attend maximum 3 secondes\n    resultat = await asyncio.wait_for(operation_longue(), timeout=3.0)\nexcept asyncio.TimeoutError:\n    print("L\'op\xe9ration a pris trop de temps !")\n'})}),"\n",(0,r.jsx)(n.h2,{id:"requ\xeates-http-asynchrones-",children:"Requ\xeates HTTP asynchrones \ud83c\udf10"}),"\n",(0,r.jsx)(n.h3,{id:"le-cas-dusage-parfait-pour-lasynchrone",children:"Le cas d'usage parfait pour l'asynchrone"}),"\n",(0,r.jsx)(n.p,{children:"Les requ\xeates HTTP sont le meilleur exemple d'op\xe9ration I/O-bound : le programme passe la majorit\xe9 du temps \xe0 attendre la r\xe9ponse du serveur, sans rien faire."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Avantage de l'async :"})," Pendant qu'une requ\xeate attend la r\xe9ponse, on peut en lancer d'autres. R\xe9sultat : 10 requ\xeates prennent le temps d'une seule !"]}),"\n",(0,r.jsx)(n.h3,{id:"avec-httpx--le-client-http-asynchrone",children:"Avec httpx : le client HTTP asynchrone"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"httpx"})," est l'\xe9quivalent moderne et asynchrone de ",(0,r.jsx)(n.code,{children:"requests"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import httpx\nimport asyncio\n\nasync def fetch_users(usernames: list[str]) -> list[dict]:\n    # AsyncClient g\xe8re les connexions de mani\xe8re asynchrone\n    async with httpx.AsyncClient() as client:\n        # Cr\xe9e une liste de coroutines (pas encore ex\xe9cut\xe9es)\n        tasks = [\n            client.get(f"https://api.github.com/users/{username}")\n            for username in usernames\n        ]\n        # Lance toutes les requ\xeates en parall\xe8le\n        responses = await asyncio.gather(*tasks)\n        return [response.json() for response in responses]\n\n# 10 utilisateurs r\xe9cup\xe9r\xe9s en parall\xe8le = temps d\'une seule requ\xeate\nusers = await fetch_users(["python", "microsoft", "google", "facebook", "apple"])\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Gain de performance :"})," Sans async, 10 requ\xeates de 200ms = 2 secondes. Avec async = 200ms !"]}),"\n",(0,r.jsx)(n.h2,{id:"int\xe9gration-avec-fastapi-",children:"Int\xe9gration avec FastAPI \ud83d\ude80"}),"\n",(0,r.jsx)(n.h3,{id:"pourquoi-fastapi-et-async-sont-faits-lun-pour-lautre",children:"Pourquoi FastAPI et async sont faits l'un pour l'autre"}),"\n",(0,r.jsx)(n.p,{children:"FastAPI est con\xe7u d\xe8s le d\xe9part pour l'asynchrone. Une API web est l'exemple parfait d'application I/O-bound : la plupart du temps est pass\xe9 \xe0 attendre des bases de donn\xe9es, des APIs externes, ou des fichiers."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Avantage :"})," Avec async, un serveur FastAPI peut g\xe9rer des milliers de requ\xeates simultan\xe9es sans cr\xe9er de threads, simplement en utilisant l'event loop."]}),"\n",(0,r.jsx)(n.h3,{id:"routes-asynchrones",children:"Routes asynchrones"}),"\n",(0,r.jsxs)(n.p,{children:["D\xe9clarer une route avec ",(0,r.jsx)(n.code,{children:"async def"})," permet \xe0 FastAPI de g\xe9rer plusieurs requ\xeates en parall\xe8le sans blocage."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from fastapi import FastAPI\nimport httpx\n\napp = FastAPI()\n\n@app.get("/users/{username}")\nasync def get_user(username: str):\n    # Pendant que cette requ\xeate attend la r\xe9ponse de GitHub,\n    # FastAPI peut traiter d\'autres requ\xeates entrantes\n    async with httpx.AsyncClient() as client:\n        response = await client.get(f"https://api.github.com/users/{username}")\n        return response.json()\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Sans async :"})," Chaque requ\xeate bloque le serveur pendant l'appel \xe0 GitHub (100-200ms). Avec async : des centaines de requ\xeates peuvent attendre en parall\xe8le."]}),"\n",(0,r.jsx)(n.h3,{id:"base-de-donn\xe9es-asynchrone-avec-sqlalchemy",children:"Base de donn\xe9es asynchrone avec SQLAlchemy"}),"\n",(0,r.jsx)(n.p,{children:"Les requ\xeates SQL sont des op\xe9rations I/O qui b\xe9n\xe9ficient \xe9norm\xe9ment de l'async."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine\nfrom sqlalchemy import select\n\n# asyncpg est le driver PostgreSQL asynchrone\nengine = create_async_engine("postgresql+asyncpg://user:pass@localhost/db")\n\n@app.get("/users")\nasync def get_users(db: AsyncSession = Depends(get_db)):\n    # Requ\xeate SQL non-bloquante\n    result = await db.execute(select(User))\n    return result.scalars().all()\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Gain :"})," Pendant qu'une requ\xeate SQL s'ex\xe9cute sur la DB, FastAPI peut traiter d'autres endpoints."]}),"\n",(0,r.jsx)(n.h3,{id:"cache-redis-asynchrone",children:"Cache Redis asynchrone"}),"\n",(0,r.jsx)(n.p,{children:"Redis est souvent utilis\xe9 comme cache pour acc\xe9l\xe9rer les r\xe9ponses. L'async permet de ne pas bloquer pendant les acc\xe8s Redis."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import aioredis\n\n@app.get("/users/{user_id}")\nasync def get_user_cached(user_id: int):\n    # V\xe9rifie le cache (op\xe9ration r\xe9seau)\n    cached = await redis.get(f"user:{user_id}")\n    if cached:\n        return json.loads(cached)\n\n    # R\xe9cup\xe8re depuis la DB si pas en cache\n    user = await fetch_user_from_db(user_id)\n\n    # Met en cache pour 1h\n    await redis.setex(f"user:{user_id}", 3600, json.dumps(user))\n    return user\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Architecture typique :"})," API FastAPI \u2192 Cache Redis \u2192 Base de donn\xe9es PostgreSQL, le tout en asynchrone bout en bout."]}),"\n",(0,r.jsx)(n.h2,{id:"patterns-avanc\xe9s-",children:"Patterns avanc\xe9s \ud83c\udfaf"}),"\n",(0,r.jsx)(n.h3,{id:"limiter-la-concurrence-avec-semaphore",children:"Limiter la concurrence avec Semaphore"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Le probl\xe8me :"})," Lancer 1000 requ\xeates HTTP en m\xeame temps peut surcharger le serveur ou \xe9puiser les ressources (connexions, m\xe9moire)."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"La solution :"})," Un ",(0,r.jsx)(n.strong,{children:"Semaphore"})," limite le nombre d'op\xe9rations simultan\xe9es. C'est comme un parking avec un nombre limit\xe9 de places : si toutes les places sont prises, les nouvelles voitures doivent attendre qu'une place se lib\xe8re."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from asyncio import Semaphore\n\nasync def operation(numero: int, semaphore: Semaphore):\n    # Attend qu\'une "place" soit disponible\n    async with semaphore:\n        # Maximum 3 op\xe9rations ici en m\xeame temps\n        await asyncio.sleep(2)\n        return numero\n\nasync def main():\n    semaphore = Semaphore(3)  # Maximum 3 op\xe9rations simultan\xe9es\n    # Lance 10 op\xe9rations, mais seulement 3 \xe0 la fois\n    tasks = [operation(i, semaphore) for i in range(10)]\n    resultats = await asyncio.gather(*tasks)\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"R\xe9sultat :"})," 10 op\xe9rations s'ex\xe9cutent par vagues de 3, au lieu de toutes en m\xeame temps."]}),"\n",(0,r.jsx)(n.h3,{id:"retry-avec-backoff-exponentiel",children:"Retry avec backoff exponentiel"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Le probl\xe8me :"})," Une API temporairement indisponible ou un timeout r\xe9seau ne doit pas faire \xe9chouer toute l'op\xe9ration."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"La solution :"})," R\xe9essayer automatiquement avec des d\xe9lais croissants (1s, 2s, 4s, 8s...)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'async def retry_with_backoff(coro, max_retries=3, initial_delay=1.0, backoff_factor=2.0):\n    delay = initial_delay\n    for attempt in range(max_retries):\n        try:\n            return await coro()\n        except Exception as e:\n            if attempt == max_retries - 1:\n                raise  # Dernier essai, on abandonne\n            await asyncio.sleep(delay)  # Attente avant r\xe9essai\n            delay *= backoff_factor  # Double le d\xe9lai : 1s, 2s, 4s...\n\n# Utilisation\nresultat = await retry_with_backoff(lambda: fetch_data("api.com"))\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Avantage :"})," R\xe9silience face aux erreurs temporaires sans surcharger le serveur avec des r\xe9essais trop fr\xe9quents."]}),"\n",(0,r.jsx)(n.h3,{id:"context-manager-asynchrone",children:"Context Manager asynchrone"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Utilit\xe9 :"})," G\xe9rer automatiquement l'ouverture et la fermeture de ressources asynchrones (connexions DB, clients HTTP, fichiers...)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"class AsyncResource:\n    async def __aenter__(self):\n        # Initialisation (ex: ouvrir connexion DB)\n        await self.connect()\n        return self\n\n    async def __aexit__(self, exc_type, exc_val, exc_tb):\n        # Nettoyage automatique (ex: fermer connexion)\n        await self.disconnect()\n\n# Le nettoyage est garanti, m\xeame en cas d'erreur\nasync with AsyncResource() as resource:\n    await resource.operation()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"bonnes-pratiques-",children:"Bonnes pratiques \ud83d\udc1b"}),"\n",(0,r.jsx)(n.h3,{id:"erreurs-courantes-\xe0-\xe9viter",children:"Erreurs courantes \xe0 \xe9viter"}),"\n",(0,r.jsxs)(n.h4,{id:"1-oublier-le-await",children:["1. Oublier le ",(0,r.jsx)(n.code,{children:"await"})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Erreur fr\xe9quente :"})," Appeler une coroutine sans ",(0,r.jsx)(n.code,{children:"await"})," ne fait rien, elle ne s'ex\xe9cute pas !"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# \u274c Mauvais : la fonction ne s'ex\xe9cute jamais\nresult = async_function()  # Retourne un objet coroutine non ex\xe9cut\xe9\nprint(result)  # <coroutine object async_function at 0x...>\n\n# \u2705 Bon : la fonction s'ex\xe9cute vraiment\nresult = await async_function()\nprint(result)  # R\xe9sultat attendu\n"})}),"\n",(0,r.jsx)(n.h4,{id:"2-bloquer-levent-loop",children:"2. Bloquer l'event loop"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Le probl\xe8me le plus grave :"})," Utiliser des fonctions bloquantes (",(0,r.jsx)(n.code,{children:"time.sleep"}),", ",(0,r.jsx)(n.code,{children:"requests.get"}),", op\xe9rations CPU lourdes) dans une coroutine paralyse tout le syst\xe8me asynchrone."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# \u274c CATASTROPHIQUE : bloque TOUT pendant 10 secondes\nasync def bad():\n    time.sleep(10)  # Aucune autre coroutine ne peut s\'ex\xe9cuter !\n    return "Done"\n\n# \u2705 Bon : suspend seulement cette coroutine\nasync def good():\n    await asyncio.sleep(10)  # Les autres coroutines continuent\n    return "Done"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"R\xe8gle d'or :"})," Dans une fonction ",(0,r.jsx)(n.code,{children:"async"}),", toutes les op\xe9rations I/O doivent \xeatre async (avec ",(0,r.jsx)(n.code,{children:"await"}),")."]}),"\n",(0,r.jsx)(n.h4,{id:"3-n\xe9gliger-la-gestion-des-ressources",children:"3. N\xe9gliger la gestion des ressources"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Probl\xe8me :"})," Les connexions DB, HTTP clients, fichiers doivent \xeatre ferm\xe9s proprement."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# \u274c Risque de fuite de connexions\nasync def bad():\n    client = httpx.AsyncClient()\n    response = await client.get(url)\n    # Oubli de fermer le client !\n\n# \u2705 Bon : fermeture automatique\nasync def good():\n    async with httpx.AsyncClient() as client:\n        response = await client.get(url)\n        # Client ferm\xe9 automatiquement, m\xeame en cas d'erreur\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mode-debug--d\xe9tecter-les-probl\xe8mes",children:"Mode debug : d\xe9tecter les probl\xe8mes"}),"\n",(0,r.jsx)(n.p,{children:"Le mode debug d'asyncio d\xe9tecte automatiquement les erreurs courantes (coroutines non await\xe9s, event loop bloqu\xe9 trop longtemps...)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Active les warnings d\xe9taill\xe9s\nasyncio.run(main(), debug=True)\n\n# Affiche un warning si une coroutine met plus de 100ms sans yield\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Utile pendant le d\xe9veloppement"})," pour rep\xe9rer les op\xe9rations bloquantes accidentelles."]}),"\n",(0,r.jsx)(n.h2,{id:"conclusion-",children:"Conclusion \ud83c\udfaf"}),"\n",(0,r.jsxs)(n.p,{children:["La programmation asynchrone en Python avec ",(0,r.jsx)(n.code,{children:"async"}),"/",(0,r.jsx)(n.code,{children:"await"})," et ",(0,r.jsx)(n.code,{children:"asyncio"})," est essentielle pour cr\xe9er des applications performantes et r\xe9actives. Elle brille particuli\xe8rement avec FastAPI pour les APIs modernes."]}),"\n",(0,r.jsx)(n.p,{children:"Points cl\xe9s \xe0 retenir :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"async/await"})," : syntaxe simple pour la concurrence"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"asyncio"})," : biblioth\xe8que standard puissante"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"I/O-bound"})," : parfait pour les op\xe9rations r\xe9seau/disque"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FastAPI"})," : framework id\xe9al pour l'async"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Patterns"})," : queue, semaphore, retry, etc."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Ces connaissances permettent de cr\xe9er des applications Python hautement performantes."}),"\n",(0,r.jsx)(n.h2,{id:"ressources-utiles-",children:"Ressources utiles \ud83d\udcda"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.python.org/3/library/asyncio.html",children:"Documentation asyncio"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://realpython.com/async-io-python/",children:"Real Python - Async IO"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://fastapi.tiangolo.com/async/",children:"FastAPI Async"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.aiohttp.org/",children:"aiohttp Documentation"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);