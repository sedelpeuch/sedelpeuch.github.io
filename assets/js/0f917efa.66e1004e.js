"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[5596],{28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var r=s(96540);const i={},t=r.createContext(i);function a(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(t.Provider,{value:n},e.children)}},69870:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>c});var r=s(97128),i=s(74848),t=s(28453);const a={title:"Cr\xe9er une API GraphQL moderne avec FastAPI et Strawberry",description:"\xc9tapes pratiques pour concevoir, coder et tester une API GraphQL en Python.",tags:["Devops","Python","API"]},l="Cr\xe9er une API GraphQL moderne avec FastAPI et Strawberry",o={authorsImageUrls:[]},c=[{value:"Introduction",id:"introduction",level:2},{value:"Outils utilis\xe9s",id:"outils-utilis\xe9s",level:2},{value:"FastAPI",id:"fastapi",level:3},{value:"Strawberry",id:"strawberry",level:3},{value:"Pourquoi utiliser FastAPI et Strawberry ensemble ?",id:"pourquoi-utiliser-fastapi-et-strawberry-ensemble-",level:2},{value:"Initialisation du projet Python",id:"initialisation-du-projet-python",level:2},{value:"1. Cr\xe9ation du projet et du fichier pyproject.toml",id:"1-cr\xe9ation-du-projet-et-du-fichier-pyprojecttoml",level:3},{value:"2. Installation des d\xe9pendances",id:"2-installation-des-d\xe9pendances",level:3},{value:"Mise en place du serveur FastAPI (main.py)",id:"mise-en-place-du-serveur-fastapi-mainpy",level:2},{value:"D\xe9finition du sch\xe9ma GraphQL : les queries (schema.py)",id:"d\xe9finition-du-sch\xe9ma-graphql--les-queries-schemapy",level:2},{value:"Cas d\u2019usage fictif : gestion de piscines",id:"cas-dusage-fictif--gestion-de-piscines",level:3},{value:"Qu\u2019est-ce qu\u2019une query GraphQL\u202f?",id:"quest-ce-quune-query-graphql",level:3},{value:"Exemple minimal de queries dans <code>schema.py</code>",id:"exemple-minimal-de-queries-dans-schemapy",level:3},{value:"Ajouter des donn\xe9es : les mutations GraphQL",id:"ajouter-des-donn\xe9es--les-mutations-graphql",level:2},{value:"Qu\u2019est-ce qu\u2019une mutation\u202f?",id:"quest-ce-quune-mutation",level:3},{value:"Exemple minimal de mutation dans <code>schema.py</code>",id:"exemple-minimal-de-mutation-dans-schemapy",level:3},{value:"Temps r\xe9el avec GraphQL : les subscriptions (WebSocket)",id:"temps-r\xe9el-avec-graphql--les-subscriptions-websocket",level:2},{value:"Qu\u2019est-ce qu\u2019une subscription\u202f?",id:"quest-ce-quune-subscription",level:3},{value:"Exemple minimal de subscription dans <code>schema.py</code>",id:"exemple-minimal-de-subscription-dans-schemapy",level:3}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"Ce guide pr\xe9sente, \xe9tape par \xe9tape, la cr\xe9ation d\u2019une API GraphQL en Python avec FastAPI et Strawberry, en expliquant les choix d\u2019outils et les bonnes pratiques \xe0 chaque \xe9tape."}),"\n",(0,i.jsx)(n.h2,{id:"outils-utilis\xe9s",children:"Outils utilis\xe9s"}),"\n",(0,i.jsx)(n.h3,{id:"fastapi",children:"FastAPI"}),"\n",(0,i.jsx)(n.p,{children:"FastAPI est un framework web moderne pour Python, con\xe7u pour cr\xe9er des APIs performantes, robustes et faciles \xe0 maintenir. Il offre :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Un support natif d\u2019async/await pour la performance"}),"\n",(0,i.jsx)(n.li,{children:"Une documentation automatique (Swagger/OpenAPI)"}),"\n",(0,i.jsx)(n.li,{children:"Une int\xe9gration simple avec les standards Python (type hints, Pydantic)"}),"\n",(0,i.jsx)(n.li,{children:"Id\xe9al pour des APIs REST ou GraphQL modernes"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"strawberry",children:"Strawberry"}),"\n",(0,i.jsx)(n.p,{children:"Strawberry est une biblioth\xe8que Python pour cr\xe9er des APIs GraphQL. Elle se distingue par :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Une syntaxe moderne bas\xe9e sur les dataclasses et les annotations de type Python"}),"\n",(0,i.jsx)(n.li,{children:"Un support natif de FastAPI et Starlette"}),"\n",(0,i.jsx)(n.li,{children:"La g\xe9n\xe9ration automatique du sch\xe9ma GraphQL et de la documentation interactive (GraphiQL)"}),"\n",(0,i.jsx)(n.li,{children:"La gestion des queries, mutations et subscriptions (WebSocket)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"pourquoi-utiliser-fastapi-et-strawberry-ensemble-",children:"Pourquoi utiliser FastAPI et Strawberry ensemble ?"}),"\n",(0,i.jsx)(n.p,{children:"FastAPI et Strawberry sont compl\xe9mentaires dans l\u2019architecture d\u2019une API GraphQL moderne\u202f:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FastAPI"})," joue le r\xf4le de serveur web\u202f: il re\xe7oit les requ\xeates HTTP/WS, g\xe8re le routage, la s\xe9curit\xe9, la documentation, et l\u2019int\xe9gration avec l\u2019\xe9cosyst\xe8me Python (middlewares, d\xe9pendances, etc.)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Strawberry"})," g\xe8re toute la logique GraphQL\u202f: il d\xe9finit le sch\xe9ma (types, queries, mutations, subscriptions), r\xe9sout les requ\xeates GraphQL, et expose l\u2019interface interactive GraphiQL."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Comment \xe7a s\u2019interconnecte ?"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Strawberry fournit un sch\xe9ma GraphQL Python."}),"\n",(0,i.jsxs)(n.li,{children:["FastAPI expose ce sch\xe9ma sur une route (ex\u202f: ",(0,i.jsx)(n.code,{children:"/graphql"}),") gr\xe2ce \xe0 ",(0,i.jsx)(n.code,{children:"GraphQLRouter"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Toute requ\xeate GraphQL (query, mutation, subscription) passe par FastAPI, qui la transmet \xe0 Strawberry pour ex\xe9cution."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Responsabilit\xe9s dans l\u2019architecture\u202f:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"FastAPI\u202f: transport, s\xe9curit\xe9, configuration serveur, int\xe9gration avec d\u2019autres services (auth, logs, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"Strawberry\u202f: logique m\xe9tier GraphQL, validation des requ\xeates, g\xe9n\xe9ration du sch\xe9ma, documentation GraphQL"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Cette s\xe9paration permet de b\xe9n\xe9ficier du meilleur des deux mondes\u202f: la puissance de FastAPI pour l\u2019API et l\u2019\xe9cosyst\xe8me Python, et la flexibilit\xe9 de Strawberry pour GraphQL."}),"\n",(0,i.jsx)(n.h2,{id:"initialisation-du-projet-python",children:"Initialisation du projet Python"}),"\n",(0,i.jsxs)(n.p,{children:["Pour d\xe9marrer un projet Python proprement, on utilise ",(0,i.jsx)(n.a,{href:"https://python-poetry.org/",children:"Poetry"})," qui g\xe8re les d\xe9pendances et l\u2019environnement virtuel."]}),"\n",(0,i.jsx)(n.h3,{id:"1-cr\xe9ation-du-projet-et-du-fichier-pyprojecttoml",children:"1. Cr\xe9ation du projet et du fichier pyproject.toml"}),"\n",(0,i.jsx)(n.p,{children:"Dans le terminal\u202f:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"poetry new exemple-graphql-fastapi\ncd exemple-graphql-fastapi\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Cela cr\xe9e la structure de base du projet et un fichier ",(0,i.jsx)(n.code,{children:"pyproject.toml"})," qui centralise la configuration\u202f:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-toml",children:'[tool.poetry]\nname = "exemple-graphql-fastapi"\nversion = "0.1.0"\ndescription = "Exemple d\'API GraphQL avec FastAPI et Strawberry"\nauthors = ["Votre Nom <email@example.com>"]\n\n[tool.poetry.dependencies]\npython = ">=3.9,<4.0"\nfastapi = "^0.110.0"\nuvicorn = "^0.29.0"\nstrawberry-graphql = "^0.220.0"\nrequests = "^2.32.4"\nwebsockets = "^15.0.1"\n\n[build-system]\nrequires = ["poetry-core>=1.0.0"]\nbuild-backend = "poetry.core.masonry.api"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"2-installation-des-d\xe9pendances",children:"2. Installation des d\xe9pendances"}),"\n",(0,i.jsx)(n.p,{children:"Toujours dans le dossier du projet\u202f:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"poetry install\n"})}),"\n",(0,i.jsx)(n.p,{children:"Cela cr\xe9e un environnement virtuel isol\xe9 et installe toutes les d\xe9pendances n\xe9cessaires."}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Astuce"})," : Pour activer l\u2019environnement virtuel Poetry dans votre shell, utilisez ",(0,i.jsx)(n.code,{children:"poetry env activate"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"mise-en-place-du-serveur-fastapi-mainpy",children:"Mise en place du serveur FastAPI (main.py)"}),"\n",(0,i.jsxs)(n.p,{children:["Le fichier ",(0,i.jsx)(n.code,{children:"main.py"})," est le point d\u2019entr\xe9e de l\u2019application. Il configure FastAPI et expose le sch\xe9ma GraphQL fourni par Strawberry sur une route d\xe9di\xe9e."]}),"\n",(0,i.jsxs)(n.p,{children:["Cr\xe9ez un fichier ",(0,i.jsx)(n.code,{children:"main.py"})," \xe0 la racine du projet avec le contenu suivant\u202f:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from fastapi import FastAPI\nfrom strawberry.fastapi import GraphQLRouter\nfrom schema import schema\n\napp = FastAPI()\ngraphql_app = GraphQLRouter(schema)\napp.include_router(graphql_app, prefix="/graphql")\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FastAPI()"})," instancie le serveur web."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GraphQLRouter(schema)"})," cr\xe9e une route GraphQL \xe0 partir du sch\xe9ma Strawberry."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"app.include_router(...)"})," expose l\u2019API GraphQL sur ",(0,i.jsx)(n.code,{children:"/graphql"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remarque"})," : Ce fichier ne contient aucune logique m\xe9tier, il sert uniquement \xe0 brancher le sch\xe9ma GraphQL sur le serveur HTTP. Toute la logique (types, queries, mutations, subscriptions) sera d\xe9finie dans ",(0,i.jsx)(n.code,{children:"schema.py"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"d\xe9finition-du-sch\xe9ma-graphql--les-queries-schemapy",children:"D\xe9finition du sch\xe9ma GraphQL : les queries (schema.py)"}),"\n",(0,i.jsxs)(n.p,{children:["Pour organiser la logique m\xe9tier, on cr\xe9e un fichier ",(0,i.jsx)(n.code,{children:"schema.py"})," qui contiendra tout le sch\xe9ma GraphQL\u202f: types, queries, mutations, subscriptions."]}),"\n",(0,i.jsx)(n.h3,{id:"cas-dusage-fictif--gestion-de-piscines",children:"Cas d\u2019usage fictif : gestion de piscines"}),"\n",(0,i.jsx)(n.p,{children:"Imaginons une API pour g\xe9rer un parc de piscines publiques. On souhaite exposer en lecture la liste des piscines, avec leurs caract\xe9ristiques principales (nom, localisation, capacit\xe9, horaires, etc.)."}),"\n",(0,i.jsx)(n.h3,{id:"quest-ce-quune-query-graphql",children:"Qu\u2019est-ce qu\u2019une query GraphQL\u202f?"}),"\n",(0,i.jsxs)(n.p,{children:["En GraphQL, une ",(0,i.jsx)(n.strong,{children:"query"})," est une op\xe9ration de lecture\u202f: elle permet au client de demander exactement les donn\xe9es dont il a besoin, sous la forme d\u2019un arbre, en une seule requ\xeate HTTP. Contrairement \xe0 REST o\xf9 chaque endpoint correspond \xe0 une ressource ou une action, GraphQL expose un unique endpoint ",(0,i.jsx)(n.code,{children:"/graphql"})," et c\u2019est la query qui d\xe9crit la forme et la profondeur des donn\xe9es attendues."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Une query interroge le sch\xe9ma GraphQL pour obtenir des objets, des listes ou des champs pr\xe9cis."}),"\n",(0,i.jsx)(n.li,{children:"Le serveur ex\xe9cute la query et retourne uniquement les champs demand\xe9s, dans la structure voulue."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Exemple de query c\xf4t\xe9 client\u202f:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"query {\n  pools {\n    name\n    city\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"R\xe9ponse typique du serveur\u202f:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "pools": [\n      {"name": "Aquaparc", "city": "Paris"},\n      {"name": "Blue Lagoon", "city": "Lyon"}\n    ]\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"exemple-minimal-de-queries-dans-schemapy",children:["Exemple minimal de queries dans ",(0,i.jsx)(n.code,{children:"schema.py"})]}),"\n",(0,i.jsxs)(n.p,{children:["Cr\xe9ez un fichier ",(0,i.jsx)(n.code,{children:"schema.py"})," \xe0 la racine du projet\u202f:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import strawberry\nfrom typing import List\n\n@strawberry.type\nclass Pool:\n    name: str\n    city: str\n    capacity: int\n\n# Donn\xe9es fictives pour l\'exemple\ndata = [\n    Pool(name="Aquaparc", city="Paris", capacity=200),\n    Pool(name="Blue Lagoon", city="Lyon", capacity=150),\n]\n\n@strawberry.type\nclass Query:\n    @strawberry.field\n    def pools(self) -> List[Pool]:\n        return data\n\nschema = strawberry.Schema(query=Query)\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["On d\xe9finit un type ",(0,i.jsx)(n.code,{children:"Pool"})," (nom, ville, capacit\xe9)."]}),"\n",(0,i.jsx)(n.li,{children:"On cr\xe9e une liste de piscines fictives."}),"\n",(0,i.jsxs)(n.li,{children:["On expose une query ",(0,i.jsx)(n.code,{children:"pools"})," qui retourne la liste des piscines."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remarque"})," : Ce sch\xe9ma est minimal pour illustrer la structure. On pourra l\u2019enrichir ensuite (filtres, mutations, etc.)."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"ajouter-des-donn\xe9es--les-mutations-graphql",children:"Ajouter des donn\xe9es : les mutations GraphQL"}),"\n",(0,i.jsxs)(n.p,{children:["Apr\xe8s les queries (lecture), GraphQL permet aussi de modifier les donn\xe9es via des ",(0,i.jsx)(n.strong,{children:"mutations"}),". Une mutation est l\u2019\xe9quivalent d\u2019une op\xe9ration d\u2019\xe9criture (cr\xe9ation, modification, suppression) dans le sch\xe9ma."]}),"\n",(0,i.jsx)(n.h3,{id:"quest-ce-quune-mutation",children:"Qu\u2019est-ce qu\u2019une mutation\u202f?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Une mutation GraphQL permet au client de demander une modification de l\u2019\xe9tat du serveur (ajout, mise \xe0 jour, suppression d\u2019un objet)."}),"\n",(0,i.jsx)(n.li,{children:"Comme pour les queries, le client choisit les champs \xe0 retourner dans la r\xe9ponse."}),"\n",(0,i.jsxs)(n.li,{children:["Les mutations sont regroup\xe9es dans une classe ",(0,i.jsx)(n.code,{children:"Mutation"})," dans le sch\xe9ma Strawberry."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Exemple de mutation c\xf4t\xe9 client\u202f:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'mutation {\n  addPool(name: "Piscine Soleil", city: "Marseille", capacity: 120) {\n    name\n    city\n    capacity\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"R\xe9ponse typique du serveur\u202f:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "addPool": {\n      "name": "Piscine Soleil",\n      "city": "Marseille",\n      "capacity": 120\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"exemple-minimal-de-mutation-dans-schemapy",children:["Exemple minimal de mutation dans ",(0,i.jsx)(n.code,{children:"schema.py"})]}),"\n",(0,i.jsx)(n.p,{children:"On enrichit le sch\xe9ma pour permettre d\u2019ajouter une piscine\u202f:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import strawberry\nfrom typing import List\n\n@strawberry.type\nclass Pool:\n    name: str\n    city: str\n    capacity: int\n\n# Donn\xe9es fictives pour l\'exemple\ndata = [\n    Pool(name="Aquaparc", city="Paris", capacity=200),\n    Pool(name="Blue Lagoon", city="Lyon", capacity=150),\n]\n\n@strawberry.type\nclass Query:\n    @strawberry.field\n    def pools(self) -> List[Pool]:\n        return data\n\n@strawberry.type\nclass Mutation:\n    @strawberry.mutation\n    def add_pool(self, name: str, city: str, capacity: int) -> Pool:\n        pool = Pool(name=name, city=city, capacity=capacity)\n        data.append(pool)\n        return pool\n\nschema = strawberry.Schema(query=Query, mutation=Mutation)\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["On d\xe9finit une classe ",(0,i.jsx)(n.code,{children:"Mutation"})," avec une m\xe9thode ",(0,i.jsx)(n.code,{children:"add_pool"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Cette mutation prend des arguments (name, city, capacity), cr\xe9e une nouvelle piscine, l\u2019ajoute \xe0 la liste, et la retourne."}),"\n",(0,i.jsx)(n.li,{children:"On passe la mutation au sch\xe9ma Strawberry."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remarque"})," : En production, on utiliserait une base de donn\xe9es au lieu d\u2019une liste Python, mais ce mod\xe8le illustre la m\xe9canique GraphQL."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"temps-r\xe9el-avec-graphql--les-subscriptions-websocket",children:"Temps r\xe9el avec GraphQL : les subscriptions (WebSocket)"}),"\n",(0,i.jsxs)(n.p,{children:["En plus des queries (lecture) et des mutations (\xe9criture), GraphQL propose un troisi\xe8me concept\u202f: les ",(0,i.jsx)(n.strong,{children:"subscriptions"}),". Les subscriptions permettent au client de s\u2019abonner \xe0 des \xe9v\xe9nements c\xf4t\xe9 serveur et de recevoir des notifications en temps r\xe9el, g\xe9n\xe9ralement via WebSocket."]}),"\n",(0,i.jsx)(n.h3,{id:"quest-ce-quune-subscription",children:"Qu\u2019est-ce qu\u2019une subscription\u202f?"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Une subscription GraphQL permet au client de recevoir automatiquement des mises \xe0 jour d\xe8s qu\u2019un \xe9v\xe9nement se produit (ex\u202f: ajout d\u2019une piscine)."}),"\n",(0,i.jsx)(n.li,{children:"La connexion se fait via WebSocket, ce qui permet au serveur de pousser les donn\xe9es vers le client sans que celui-ci ait \xe0 interroger en boucle."}),"\n",(0,i.jsx)(n.li,{children:"Les subscriptions sont utiles pour le temps r\xe9el\u202f: notifications, chat, monitoring, etc."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Exemple de subscription c\xf4t\xe9 client\u202f:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"subscription {\n  poolAdded {\n    name\n    city\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\xc0 chaque fois qu\u2019une piscine est ajout\xe9e, le serveur envoie automatiquement les infos de la nouvelle piscine \xe0 tous les clients abonn\xe9s."}),"\n",(0,i.jsxs)(n.h3,{id:"exemple-minimal-de-subscription-dans-schemapy",children:["Exemple minimal de subscription dans ",(0,i.jsx)(n.code,{children:"schema.py"})]}),"\n",(0,i.jsx)(n.p,{children:"On enrichit le sch\xe9ma pour notifier en temps r\xe9el l\u2019ajout d\u2019une piscine\u202f:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import asyncio\nimport strawberry\nfrom typing import List, AsyncGenerator\n\n@strawberry.type\nclass Pool:\n    name: str\n    city: str\n    capacity: int\n\n# Donn\xe9es fictives pour l\'exemple\ndata = [\n    Pool(name="Aquaparc", city="Paris", capacity=200),\n    Pool(name="Blue Lagoon", city="Lyon", capacity=150),\n]\n\nsubscribers: List[asyncio.Queue] = []\n\n@strawberry.type\nclass Subscription:\n    @strawberry.subscription\n    async def pool_added(self) -> AsyncGenerator[Pool, None]:\n        queue = asyncio.Queue()\n        subscribers.append(queue)\n        try:\n            while True:\n                pool = await queue.get()\n                yield pool\n        finally:\n            subscribers.remove(queue)\n\n@strawberry.type\nclass Query:\n    @strawberry.field\n    def pools(self) -> List[Pool]:\n        return data\n\n@strawberry.type\nclass Mutation:\n    @strawberry.mutation\n    def add_pool(self, name: str, city: str, capacity: int) -> Pool:\n        pool = Pool(name=name, city=city, capacity=capacity)\n        data.append(pool)\n        # Notifier les abonn\xe9s\n        for queue in subscribers:\n            queue.put_nowait(pool)\n        return pool\n\nschema = strawberry.Schema(query=Query, mutation=Mutation, subscription=Subscription)\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["On d\xe9finit une classe ",(0,i.jsx)(n.code,{children:"Subscription"})," avec une m\xe9thode ",(0,i.jsx)(n.code,{children:"pool_added"})," qui \xe9coute les nouveaux ajouts."]}),"\n",(0,i.jsx)(n.li,{children:"Lorsqu\u2019une piscine est ajout\xe9e via la mutation, tous les abonn\xe9s sont notifi\xe9s en temps r\xe9el."}),"\n",(0,i.jsx)(n.li,{children:"Le sch\xe9ma Strawberry inclut maintenant la subscription."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Remarque"})," : Pour tester les subscriptions, il faut utiliser un client compatible WebSocket (ex\u202f: GraphiQL, Apollo, ou un script Python avec ",(0,i.jsx)(n.code,{children:"websockets"}),")."]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},97128:e=>{e.exports=JSON.parse('{"permalink":"/blog/2025/07/15/09-scripting/strawberry","source":"@site/blog/09-scripting/2025-07-15-strawberry.md","title":"Cr\xe9er une API GraphQL moderne avec FastAPI et Strawberry","description":"\xc9tapes pratiques pour concevoir, coder et tester une API GraphQL en Python.","date":"2025-07-15T00:00:00.000Z","tags":[{"inline":true,"label":"Devops","permalink":"/blog/tags/devops"},{"inline":true,"label":"Python","permalink":"/blog/tags/python"},{"inline":true,"label":"API","permalink":"/blog/tags/api"}],"readingTime":7.31,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Cr\xe9er une API GraphQL moderne avec FastAPI et Strawberry","description":"\xc9tapes pratiques pour concevoir, coder et tester une API GraphQL en Python.","tags":["Devops","Python","API"]},"unlisted":false,"nextItem":{"title":"GraphQL vs REST : Comprendre les concepts cl\xe9s des API modernes","permalink":"/blog/2025/07/01/09-scripting/graphql"}}')}}]);