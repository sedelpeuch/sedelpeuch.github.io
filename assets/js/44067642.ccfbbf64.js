"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[1156],{3077:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>o});var a=n(74848),l=n(28453);const i={title:"Vid\xe9o 7.2"},r=void 0,t={id:"enseirb/s7/compilation/cours7",title:"Vid\xe9o 7.2",description:"Production pour les appels de fonction. Production pour les sous-bloc (variables locales)",source:"@site/docs/enseirb/s7/compilation/cours7.md",sourceDirName:"enseirb/s7/compilation",slug:"/enseirb/s7/compilation/cours7",permalink:"/docs/enseirb/s7/compilation/cours7",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Vid\xe9o 7.2"},sidebar:"tutorialSidebar",previous:{title:"Vid\xe9o 7.1",permalink:"/docs/enseirb/s7/compilation/cours6"},next:{title:"TD - Feuille 1",permalink:"/docs/enseirb/s7/compilation/td1"}},c={},o=[{value:"Production pour les appels de fonction. Production pour les sous-bloc (variables locales)",id:"production-pour-les-appels-de-fonction-production-pour-les-sous-bloc-variables-locales",level:2},{value:"Appel d&#39;une fonction",id:"appel-dune-fonction",level:3}];function m(e){const s={annotation:"annotation",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",p:"p",pre:"pre",semantics:"semantics",span:"span",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h2,{id:"production-pour-les-appels-de-fonction-production-pour-les-sous-bloc-variables-locales",children:"Production pour les appels de fonction. Production pour les sous-bloc (variables locales)"}),"\n",(0,a.jsx)(s.p,{children:"Question : o\xf9 et comment stocker / adresser les variables locales \xe0 un sous bloc\n?"}),"\n",(0,a.jsx)(s.p,{children:"Premi\xe8re solution, renommer les variables locales pour les traiter \"comme\" des\nvariables globales. Cette solution fonction cependant la profondeur\nd'implication des blocs doit \xeatre born\xe9e (\xe0 l'ex\xe9cution). Cela interdit la\ncompilation de fonctions r\xe9cursives."}),"\n",(0,a.jsxs)(s.p,{children:["Une deuxi\xe8me solution est d'utiliser la pile. On stocker les variables locales\ndans la pile\n",(0,a.jsx)(s.img,{src:n(67672).A+"",width:"576",height:"438"})]}),"\n",(0,a.jsxs)(s.p,{children:["La question est comment acc\xe9der (en lecture ou \xe9criture) \xe0 ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"x"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"x"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"x"})]})})]})," ou ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"g"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"g"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"})]})})]})," ?"]}),"\n",(0,a.jsxs)(s.p,{children:["LA solution est d'utiliser un pointeur d'environnement (frame pointer) fp qui\nd\xe9signe, dans la pile un emplacement fixe pendant toute la dur\xe9e de vie du sous\nbloc. \xc0 partir de l\xe0, on peut coder ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"x"}),(0,a.jsx)(s.mo,{children:"\u2192"}),(0,a.jsx)(s.mo,{children:"\u2217"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"f"}),(0,a.jsx)(s.mi,{children:"p"}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsx)(s.mn,{children:"4"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"x \\rightarrow *(fp+4)"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"x"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"\u2192"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord",children:"\u2217"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord",children:"4"}),(0,a.jsx)(s.span,{className:"mclose",children:")"})]})]})]})," et ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"g"}),(0,a.jsx)(s.mo,{children:"\u2192"}),(0,a.jsx)(s.mo,{children:"\u2217"}),(0,a.jsx)(s.mo,{stretchy:"false",children:"("}),(0,a.jsx)(s.mi,{children:"f"}),(0,a.jsx)(s.mi,{children:"p"}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsx)(s.mn,{children:"8"}),(0,a.jsx)(s.mo,{stretchy:"false",children:")"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"g \\rightarrow\n*(fp+8)"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,a.jsx)(s.span,{className:"mrel",children:"\u2192"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord",children:"\u2217"}),(0,a.jsx)(s.span,{className:"mopen",children:"("}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"p"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord",children:"8"}),(0,a.jsx)(s.span,{className:"mclose",children:")"})]})]})]}),". Comme la valeur de fp ne change pas pendant la dur\xe9e de vie du bloc,\non a bien un codage de ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"x"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"x"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",children:"x"})]})})]})," et ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"g"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"g"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.625em",verticalAlign:"-0.1944em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"g"})]})})]}),"."]}),"\n",(0,a.jsx)(s.p,{children:"Entr\xe9e dans le bloc :"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-c",children:"empiler g (sp = sp - 4)\nempiler x (sp = sp - 4)\nfp = sp\n"})}),"\n",(0,a.jsx)(s.p,{children:"Cependant cela provoque un probl\xe8me, on perd la valeur pr\xe9c\xe9dente du fp. Pour\npallier ce probl\xe8me il faut sauvegarder le fp dans la pile"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-c",children:"empiler g (sp = sp - 4)\nempiler x (sp = sp - 4)\nempiler fp (*sp = fp, sp = sp -4)\nfp = sp\n"})}),"\n",(0,a.jsx)(s.p,{children:"\xc0 la sortie du bloc"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-c",children:"//d\xe9piler les variables locales\nfp = *fp\n//eventuellement une valeur de retour\n"})}),"\n",(0,a.jsx)(s.p,{children:"On g\xe9n\xe9ralise ce principe pour les appels de fonctions. Les ingr\xe9dients d'une\nfonction"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-c",children:"int inc(int x){\n    int y = 1;\n    if (x < 0) return x;\n    else return (x - y);\n}\n"})}),"\n",(0,a.jsx)(s.p,{children:"C'est les types qui indiquent la n\xe9cessite de d\xe9finir des emplacements, m\xe9moire\net leur taille. Id\xe9e : stocker ces \xe9l\xe9ments sur la pile. O\xf9 ? Prendre une\nconvention de position par rapport au fp. fp a une adresse sur la pile fixe\npendant toute l'ex\xe9cution \xe0 un appel de fonction."}),"\n",(0,a.jsx)(s.p,{children:"La position, relative au fp, de chaque des \xe9l\xe9ments est fix\xe9e \xe0 la compilation."}),"\n",(0,a.jsx)(s.p,{children:"Le contexte contient, a minima, une sauvegarde du fp lors de l'appel.\nL'adressage des variables, locales, des arguments, et de la valeur de retour se\nfait relativement au fp courant."}),"\n",(0,a.jsx)(s.h3,{id:"appel-dune-fonction",children:"Appel d'une fonction"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{children:"Sauvegarde du contexte courant fp\nEmpilement des arguments\nR\xe9server la place du r\xe9sultat\nPositionner le fp\nEmpilement des variables locales\ngoto \xe0 l'adresse du code de la fonction\n"})}),"\n",(0,a.jsx)(s.p,{children:"Question : comment finir l'appel de fonction ? On a besoin d'un branchement \xe0\nl'endroit de l'appel. Cela implique la n\xe9cessit\xe9 de stocker lors de l'appel un\nautre pointeur : le compteur ordinal (co) qui d\xe9signe l'adresse courante de\nl'instructeur a execot\xe9. On finit l'appel par un goto co apr\xe8s avoir \"retrouv\xe9\"\nce compteur ordinal. En code 3 adresses (et dans la plupart des assembleurs) on\nne fera pas des goto mais on utilisera une paire d'instruction particuli\xe8re\n(jump et return). En g\xe9n\xe9ral, jump et return seront charg\xe9 respectivement"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"des branchements"}),"\n",(0,a.jsx)(s.li,{children:"de la sauvegarde / restauration du fp et du co."}),"\n"]})]})}function d(e={}){const{wrapper:s}={...(0,l.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}},67672:(e,s,n)=>{n.d(s,{A:()=>a});const a=n.p+"assets/images/71-f818beb6828638310f4c3833068cdfab.png"},28453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>t});var a=n(96540);const l={},i=a.createContext(l);function r(e){const s=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),a.createElement(i.Provider,{value:s},e.children)}}}]);