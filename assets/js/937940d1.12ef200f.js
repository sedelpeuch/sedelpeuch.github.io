"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[3518],{2203(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>o});var r=s(99991),l=s(74848),i=s(28453);const a={title:"Ansible avanc\xe9 : R\xf4les, Ansible Vault et int\xe9gration CI/CD",description:"Fonctionnalit\xe9s avanc\xe9es d'Ansible pour cr\xe9er des playbooks modulaires, s\xe9curiser les secrets et automatiser les d\xe9ploiements.",tags:["Ansible","IaC","DevOps","CI/CD","Automation"]},t=void 0,c={authorsImageUrls:[]},o=[{value:"Les r\xf4les Ansible : modularit\xe9 et r\xe9utilisabilit\xe9 \ud83d\udce6",id:"les-r\xf4les-ansible--modularit\xe9-et-r\xe9utilisabilit\xe9-",level:2},{value:"Structure d&#39;un r\xf4le",id:"structure-dun-r\xf4le",level:3},{value:"Cr\xe9er un r\xf4le avec ansible-galaxy",id:"cr\xe9er-un-r\xf4le-avec-ansible-galaxy",level:3},{value:"Exemple de r\xf4le complet : webserver",id:"exemple-de-r\xf4le-complet--webserver",level:3},{value:"Utiliser un r\xf4le dans un playbook",id:"utiliser-un-r\xf4le-dans-un-playbook",level:3},{value:"Collections Ansible \ud83d\udcda",id:"collections-ansible-",level:2},{value:"Installer une collection",id:"installer-une-collection",level:3},{value:"Fichier requirements.yml",id:"fichier-requirementsyml",level:3},{value:"Utiliser une collection",id:"utiliser-une-collection",level:3},{value:"Cr\xe9er sa propre collection",id:"cr\xe9er-sa-propre-collection",level:3},{value:"Ansible Vault : g\xe9rer les secrets en toute s\xe9curit\xe9 \ud83d\udd12",id:"ansible-vault--g\xe9rer-les-secrets-en-toute-s\xe9curit\xe9-",level:2},{value:"Cr\xe9er un fichier chiffr\xe9",id:"cr\xe9er-un-fichier-chiffr\xe9",level:3},{value:"Chiffrer un fichier existant",id:"chiffrer-un-fichier-existant",level:3},{value:"Modifier un fichier chiffr\xe9",id:"modifier-un-fichier-chiffr\xe9",level:3},{value:"D\xe9chiffrer un fichier",id:"d\xe9chiffrer-un-fichier",level:3},{value:"Utiliser Vault dans un playbook",id:"utiliser-vault-dans-un-playbook",level:3},{value:"Ex\xe9cuter avec Vault",id:"ex\xe9cuter-avec-vault",level:3},{value:"Fichier de mot de passe",id:"fichier-de-mot-de-passe",level:3},{value:"Script pour r\xe9cup\xe9rer le mot de passe",id:"script-pour-r\xe9cup\xe9rer-le-mot-de-passe",level:3},{value:"Vault IDs : g\xe9rer plusieurs cl\xe9s",id:"vault-ids--g\xe9rer-plusieurs-cl\xe9s",level:3},{value:"Chiffrer des variables individuelles",id:"chiffrer-des-variables-individuelles",level:3},{value:"Bonnes pratiques avanc\xe9es \ud83c\udfc6",id:"bonnes-pratiques-avanc\xe9es-",level:2},{value:"1. Structure de projet recommand\xe9e",id:"1-structure-de-projet-recommand\xe9e",level:3},{value:"2. Utiliser des tags strat\xe9giquement",id:"2-utiliser-des-tags-strat\xe9giquement",level:3},{value:"3. Gestion des erreurs robuste",id:"3-gestion-des-erreurs-robuste",level:3},{value:"Conclusion \ud83c\udfaf",id:"conclusion-",level:2},{value:"Ressources utiles \ud83d\udcda",id:"ressources-utiles-",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.p,{children:["L'",(0,l.jsx)(n.a,{href:"/blog/2025/06/09/08-iac/ansible-introduction",children:"article pr\xe9c\xe9dent sur Ansible"})," couvrait les bases de cet outil d'automatisation puissant. Cet article explore des concepts avanc\xe9s qui permettent de cr\xe9er des infrastructures complexes de mani\xe8re modulaire, s\xe9curis\xe9e et automatis\xe9e. \ud83d\ude80"]}),"\n",(0,l.jsx)(n.h2,{id:"les-r\xf4les-ansible--modularit\xe9-et-r\xe9utilisabilit\xe9-",children:"Les r\xf4les Ansible : modularit\xe9 et r\xe9utilisabilit\xe9 \ud83d\udce6"}),"\n",(0,l.jsx)(n.p,{children:"Les r\xf4les sont la pierre angulaire de la modularit\xe9 dans Ansible. Ils permettent d'organiser les playbooks en composants r\xe9utilisables et maintenables."}),"\n",(0,l.jsx)(n.h3,{id:"structure-dun-r\xf4le",children:"Structure d'un r\xf4le"}),"\n",(0,l.jsx)(n.p,{children:"Un r\xf4le suit une structure de r\xe9pertoires standardis\xe9e :"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"roles/\n\u2514\u2500\u2500 webserver/\n    \u251c\u2500\u2500 defaults/           # Variables par d\xe9faut (priorit\xe9 la plus basse)\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 vars/              # Variables du r\xf4le (priorit\xe9 haute)\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 tasks/             # T\xe2ches principales du r\xf4le\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 handlers/          # Gestionnaires d'\xe9v\xe9nements\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 templates/         # Templates Jinja2\n    \u2502   \u2514\u2500\u2500 nginx.conf.j2\n    \u251c\u2500\u2500 files/             # Fichiers statiques\n    \u2502   \u2514\u2500\u2500 index.html\n    \u251c\u2500\u2500 meta/              # M\xe9tadonn\xe9es et d\xe9pendances\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u2514\u2500\u2500 README.md          # Documentation du r\xf4le\n"})}),"\n",(0,l.jsx)(n.h3,{id:"cr\xe9er-un-r\xf4le-avec-ansible-galaxy",children:"Cr\xe9er un r\xf4le avec ansible-galaxy"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Cr\xe9er la structure d'un nouveau r\xf4le\nansible-galaxy init webserver\n\n# Cr\xe9er un r\xf4le dans un r\xe9pertoire sp\xe9cifique\nansible-galaxy init roles/webserver\n\n# Voir la structure cr\xe9\xe9e\ntree roles/webserver\n"})}),"\n",(0,l.jsx)(n.h3,{id:"exemple-de-r\xf4le-complet--webserver",children:"Exemple de r\xf4le complet : webserver"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"tasks/main.yml"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"---\n# Installation et configuration de Nginx\n- name: Installer les paquets requis\n  apt:\n    name:\n      - nginx\n      - python3-pip\n    state: present\n    update_cache: yes\n\n- name: Configurer Nginx\n  template:\n    src: nginx.conf.j2\n    dest: /etc/nginx/sites-available/{{ site_name }}\n    owner: root\n    group: root\n    mode: '0644'\n  notify: reload nginx\n\n- name: Activer le site\n  file:\n    src: /etc/nginx/sites-available/{{ site_name }}\n    dest: /etc/nginx/sites-enabled/{{ site_name }}\n    state: link\n  notify: reload nginx\n\n- name: D\xe9ployer le contenu du site\n  template:\n    src: index.html.j2\n    dest: /var/www/{{ site_name }}/index.html\n    owner: www-data\n    group: www-data\n    mode: '0644'\n\n- name: S'assurer que Nginx est d\xe9marr\xe9\n  service:\n    name: nginx\n    state: started\n    enabled: yes\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"defaults/main.yml"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'---\n# Variables par d\xe9faut du r\xf4le webserver\nsite_name: example.com\ndocument_root: /var/www/{{ site_name }}\nserver_port: 80\nserver_name: "{{ site_name }}"\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"vars/main.yml"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"---\n# Variables sp\xe9cifiques au r\xf4le (priorit\xe9 plus haute)\nnginx_worker_processes: auto\nnginx_worker_connections: 1024\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"handlers/main.yml"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"---\n# Gestionnaires pour Nginx\n- name: reload nginx\n  service:\n    name: nginx\n    state: reloaded\n\n- name: restart nginx\n  service:\n    name: nginx\n    state: restarted\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"templates/nginx.conf.j2"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-jinja2",children:"server {\n    listen {{ server_port }};\n    server_name {{ server_name }};\n\n    root {{ document_root }};\n    index index.html;\n\n    location / {\n        try_files $uri $uri/ =404;\n    }\n\n    access_log /var/log/nginx/{{ site_name }}_access.log;\n    error_log /var/log/nginx/{{ site_name }}_error.log;\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"meta/main.yml"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"---\n# M\xe9tadonn\xe9es et d\xe9pendances du r\xf4le\ngalaxy_info:\n  author: Votre Nom\n  description: Installation et configuration de Nginx\n  company: Votre Entreprise\n  license: MIT\n  min_ansible_version: 2.9\n\n  platforms:\n    - name: Ubuntu\n      versions:\n        - focal\n        - jammy\n    - name: Debian\n      versions:\n        - bullseye\n        - bookworm\n\n  galaxy_tags:\n    - nginx\n    - webserver\n    - web\n\ndependencies: []\n"})}),"\n",(0,l.jsx)(n.h3,{id:"utiliser-un-r\xf4le-dans-un-playbook",children:"Utiliser un r\xf4le dans un playbook"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'---\n- name: Configurer les serveurs web\n  hosts: webservers\n  become: yes\n\n  roles:\n    - role: webserver\n      vars:\n        site_name: monsite.com\n        server_port: 8080\n\n# Ou avec une syntaxe plus d\xe9taill\xe9e\n- name: Configurer avec des conditions\n  hosts: webservers\n  become: yes\n\n  roles:\n    - role: webserver\n      when: ansible_os_family == "Debian"\n      tags:\n        - nginx\n        - web\n'})}),"\n",(0,l.jsx)(n.h2,{id:"collections-ansible-",children:"Collections Ansible \ud83d\udcda"}),"\n",(0,l.jsx)(n.p,{children:"Les collections sont des packages qui regroupent modules, r\xf4les, plugins et playbooks. Elles remplacent progressivement les r\xf4les Galaxy."}),"\n",(0,l.jsx)(n.h3,{id:"installer-une-collection",children:"Installer une collection"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Installer depuis Ansible Galaxy\nansible-galaxy collection install community.general\n\n# Installer depuis un fichier requirements.yml\nansible-galaxy collection install -r requirements.yml\n\n# Installer une version sp\xe9cifique\nansible-galaxy collection install community.general:5.8.0\n"})}),"\n",(0,l.jsx)(n.h3,{id:"fichier-requirementsyml",children:"Fichier requirements.yml"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'---\ncollections:\n  # Depuis Ansible Galaxy\n  - name: community.general\n    version: ">=5.0.0"\n\n  - name: ansible.posix\n    version: "1.5.1"\n\n  - name: community.docker\n\n  # Depuis un d\xe9p\xf4t Git\n  - name: https://github.com/organisation/ma-collection.git\n    type: git\n    version: main\n'})}),"\n",(0,l.jsx)(n.h3,{id:"utiliser-une-collection",children:"Utiliser une collection"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"---\n- name: Utiliser des modules de collections\n  hosts: all\n\n  tasks:\n    # M\xe9thode 1 : FQCN (Fully Qualified Collection Name)\n    - name: Installer un paquet avec community.general\n      community.general.npm:\n        name: express\n        global: yes\n\n    # M\xe9thode 2 : Importer la collection\n    - name: Docker tasks\n      block:\n        - community.docker.docker_container:\n            name: nginx\n            image: nginx:latest\n            state: started\n      collections:\n        - community.docker\n"})}),"\n",(0,l.jsx)(n.h3,{id:"cr\xe9er-sa-propre-collection",children:"Cr\xe9er sa propre collection"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Cr\xe9er la structure d'une collection\nansible-galaxy collection init mon_namespace.ma_collection\n\n# Structure cr\xe9\xe9e\nmon_namespace/\n\u2514\u2500\u2500 ma_collection/\n    \u251c\u2500\u2500 docs/\n    \u251c\u2500\u2500 galaxy.yml          # M\xe9tadonn\xe9es de la collection\n    \u251c\u2500\u2500 plugins/\n    \u2502   \u251c\u2500\u2500 modules/        # Modules personnalis\xe9s\n    \u2502   \u251c\u2500\u2500 inventory/      # Plugins d'inventaire\n    \u2502   \u2514\u2500\u2500 lookup/         # Plugins lookup\n    \u251c\u2500\u2500 roles/              # R\xf4les inclus dans la collection\n    \u251c\u2500\u2500 playbooks/          # Playbooks d'exemple\n    \u2514\u2500\u2500 README.md\n"})}),"\n",(0,l.jsx)(n.h2,{id:"ansible-vault--g\xe9rer-les-secrets-en-toute-s\xe9curit\xe9-",children:"Ansible Vault : g\xe9rer les secrets en toute s\xe9curit\xe9 \ud83d\udd12"}),"\n",(0,l.jsx)(n.p,{children:"Ansible Vault permet de chiffrer les fichiers contenant des donn\xe9es sensibles."}),"\n",(0,l.jsx)(n.h3,{id:"cr\xe9er-un-fichier-chiffr\xe9",children:"Cr\xe9er un fichier chiffr\xe9"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Cr\xe9er un nouveau fichier chiffr\xe9\nansible-vault create secrets.yml\n\n# Vous serez invit\xe9 \xe0 entrer un mot de passe\n# Puis un \xe9diteur s'ouvrira pour saisir le contenu\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Contenu de secrets.yml (d\xe9chiffr\xe9) :"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'---\ndb_password: "SuperSecretPassword123!"\napi_key: "abc123def456ghi789"\nssl_certificate_key: |\n'})}),"\n",(0,l.jsx)(n.h3,{id:"chiffrer-un-fichier-existant",children:"Chiffrer un fichier existant"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Chiffrer un fichier existant\nansible-vault encrypt vars/production.yml\n\n# Chiffrer plusieurs fichiers\nansible-vault encrypt vars/*.yml\n"})}),"\n",(0,l.jsx)(n.h3,{id:"modifier-un-fichier-chiffr\xe9",children:"Modifier un fichier chiffr\xe9"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# \xc9diter un fichier chiffr\xe9 (d\xe9chiffrement temporaire)\nansible-vault edit secrets.yml\n\n# Voir le contenu sans \xe9diter\nansible-vault view secrets.yml\n"})}),"\n",(0,l.jsx)(n.h3,{id:"d\xe9chiffrer-un-fichier",children:"D\xe9chiffrer un fichier"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# D\xe9chiffrer un fichier (attention, perte de la protection !)\nansible-vault decrypt secrets.yml\n\n# Rechiffrer avec un nouveau mot de passe\nansible-vault rekey secrets.yml\n"})}),"\n",(0,l.jsx)(n.h3,{id:"utiliser-vault-dans-un-playbook",children:"Utiliser Vault dans un playbook"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'---\n- name: D\xe9ploiement avec secrets\n  hosts: production\n  vars_files:\n    - vars/common.yml\n    - secrets.yml  # Fichier chiffr\xe9 avec Vault\n\n  tasks:\n    - name: Configurer la base de donn\xe9es\n      mysql_user:\n        name: app_user\n        password: "{{ db_password }}"  # Depuis secrets.yml\n        priv: "appdb.*:ALL"\n        state: present\n\n    - name: Configurer l\'API\n      template:\n        src: api_config.j2\n        dest: /etc/app/config.json\n      vars:\n        api_secret: "{{ api_key }}"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"ex\xe9cuter-avec-vault",children:"Ex\xe9cuter avec Vault"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Demander le mot de passe interactivement\nansible-playbook deploy.yml --ask-vault-pass\n\n# Utiliser un fichier de mot de passe\nansible-playbook deploy.yml --vault-password-file ~/.vault_pass.txt\n\n# Utiliser un script pour obtenir le mot de passe\nansible-playbook deploy.yml --vault-password-file get_vault_pass.sh\n"})}),"\n",(0,l.jsx)(n.h3,{id:"fichier-de-mot-de-passe",children:"Fichier de mot de passe"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Cr\xe9er un fichier de mot de passe\necho "MonMotDePasseVault" > ~/.vault_pass.txt\nchmod 600 ~/.vault_pass.txt\n\n# Configurer dans ansible.cfg\ncat >> ansible.cfg << EOF\n[defaults]\nvault_password_file = ~/.vault_pass.txt\nEOF\n'})}),"\n",(0,l.jsx)(n.h3,{id:"script-pour-r\xe9cup\xe9rer-le-mot-de-passe",children:"Script pour r\xe9cup\xe9rer le mot de passe"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# get_vault_pass.sh - R\xe9cup\xe8re le mot de passe depuis un gestionnaire de secrets\n\n# Exemple avec pass (passwordstore.org)\npass show ansible/vault\n\n# Exemple avec AWS Secrets Manager\naws secretsmanager get-secret-value \\\n  --secret-id ansible-vault \\\n  --query SecretString \\\n  --output text\n\n# Exemple avec 1Password CLI\nop read "op://DevOps/Ansible Vault/password"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"vault-ids--g\xe9rer-plusieurs-cl\xe9s",children:"Vault IDs : g\xe9rer plusieurs cl\xe9s"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Cr\xe9er des fichiers avec diff\xe9rents Vault IDs\nansible-vault create --vault-id dev@prompt secrets_dev.yml\nansible-vault create --vault-id prod@prompt secrets_prod.yml\n\n# Utiliser avec des fichiers de mots de passe\nansible-vault create --vault-id dev@.vault_dev secrets_dev.yml\n\n# Ex\xe9cuter avec plusieurs Vault IDs\nansible-playbook deploy.yml \\\n  --vault-id dev@.vault_dev \\\n  --vault-id prod@.vault_prod\n"})}),"\n",(0,l.jsx)(n.h3,{id:"chiffrer-des-variables-individuelles",children:"Chiffrer des variables individuelles"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"---\n# Au lieu de chiffrer tout le fichier\ndb_host: localhost\ndb_user: app_user\ndb_password: !vault |\n  $ANSIBLE_VAULT;1.1;AES256\n  66386439653936393039346235323131386335333132333239336631643366326362333733363264\n  3939666233316362313938396331626664626134623239360a356430646364633338336564383661\n  ...\n\n# Cr\xe9er une variable chiffr\xe9e\nansible-vault encrypt_string 'SuperSecretPassword' --name 'db_password'\n"})}),"\n",(0,l.jsx)(n.h2,{id:"bonnes-pratiques-avanc\xe9es-",children:"Bonnes pratiques avanc\xe9es \ud83c\udfc6"}),"\n",(0,l.jsx)(n.h3,{id:"1-structure-de-projet-recommand\xe9e",children:"1. Structure de projet recommand\xe9e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"ansible-project/\n\u251c\u2500\u2500 ansible.cfg\n\u251c\u2500\u2500 inventories/\n\u2502   \u251c\u2500\u2500 production/\n\u2502   \u2502   \u251c\u2500\u2500 hosts.yml\n\u2502   \u2502   \u2514\u2500\u2500 group_vars/\n\u2502   \u2502       \u251c\u2500\u2500 all.yml\n\u2502   \u2502       \u2514\u2500\u2500 webservers.yml\n\u2502   \u2514\u2500\u2500 staging/\n\u2502       \u251c\u2500\u2500 hosts.yml\n\u2502       \u2514\u2500\u2500 group_vars/\n\u251c\u2500\u2500 roles/\n\u2502   \u251c\u2500\u2500 common/\n\u2502   \u251c\u2500\u2500 webserver/\n\u2502   \u2514\u2500\u2500 database/\n\u251c\u2500\u2500 playbooks/\n\u2502   \u251c\u2500\u2500 deploy.yml\n\u2502   \u251c\u2500\u2500 rollback.yml\n\u2502   \u2514\u2500\u2500 maintenance.yml\n\u251c\u2500\u2500 collections/\n\u2502   \u2514\u2500\u2500 requirements.yml\n\u251c\u2500\u2500 group_vars/\n\u2502   \u2514\u2500\u2500 all/\n\u2502       \u251c\u2500\u2500 vars.yml\n\u2502       \u2514\u2500\u2500 vault.yml\n\u2514\u2500\u2500 README.md\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-utiliser-des-tags-strat\xe9giquement",children:"2. Utiliser des tags strat\xe9giquement"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'---\n- name: Configuration compl\xe8te\n  hosts: webservers\n\n  tasks:\n    - name: Installer les paquets\n      apt:\n        name: "{{ item }}"\n        state: present\n      loop:\n        - nginx\n        - python3\n      tags:\n        - install\n        - packages\n\n    - name: Configurer Nginx\n      template:\n        src: nginx.conf.j2\n        dest: /etc/nginx/nginx.conf\n      tags:\n        - config\n        - nginx\n\n    - name: D\xe9ployer l\'application\n      copy:\n        src: app/\n        dest: /var/www/app/\n      tags:\n        - deploy\n        - app\n\n# Ex\xe9cuter uniquement certaines t\xe2ches\n# ansible-playbook deploy.yml --tags "config"\n# ansible-playbook deploy.yml --skip-tags "deploy"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-gestion-des-erreurs-robuste",children:"3. Gestion des erreurs robuste"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'---\n- name: Gestion d\'erreurs avanc\xe9e\n  hosts: all\n\n  tasks:\n    - name: T\xe2che qui peut \xe9chouer\n      command: /opt/script.sh\n      register: script_result\n      ignore_errors: yes\n\n    - name: Traiter le r\xe9sultat\n      block:\n        - debug:\n            msg: "Script r\xe9ussi : {{ script_result.stdout }}"\n      rescue:\n        - debug:\n            msg: "Script \xe9chou\xe9 : {{ script_result.stderr }}"\n        - include_tasks: rollback.yml\n      always:\n        - name: Nettoyage\n          file:\n            path: /tmp/script-lock\n            state: absent\n'})}),"\n",(0,l.jsx)(n.h2,{id:"conclusion-",children:"Conclusion \ud83c\udfaf"}),"\n",(0,l.jsx)(n.p,{children:"Ansible offre des fonctionnalit\xe9s avanc\xe9es puissantes pour g\xe9rer des infrastructures complexes de mani\xe8re s\xe9curis\xe9e et automatis\xe9e. Les r\xf4les et collections permettent de cr\xe9er des composants r\xe9utilisables, Vault prot\xe8ge les secrets, et l'int\xe9gration CI/CD automatise les d\xe9ploiements."}),"\n",(0,l.jsx)(n.p,{children:"Points cl\xe9s \xe0 retenir :"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"R\xf4les"})," : modulariser et r\xe9utiliser le code"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Collections"})," : packages complets de fonctionnalit\xe9s"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Vault"})," : chiffrer les donn\xe9es sensibles"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"CI/CD"})," : automatiser les d\xe9ploiements"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Strat\xe9gies"})," : blue-green, canary, rollback automatique"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"La ma\xeetrise de ces concepts permet de cr\xe9er des infrastructures as code robustes, maintenables et s\xe9curis\xe9es."}),"\n",(0,l.jsx)(n.h2,{id:"ressources-utiles-",children:"Ressources utiles \ud83d\udcda"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html",children:"Ansible Best Practices"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://galaxy.ansible.com/",children:"Ansible Galaxy"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/user_guide/vault.html",children:"Ansible Vault Documentation"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/user_guide/collections_using.html",children:"Ansible Collections"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}},28453(e,n,s){s.d(n,{R:()=>a,x:()=>t});var r=s(96540);const l={},i=r.createContext(l);function a(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),r.createElement(i.Provider,{value:n},e.children)}},99991(e){e.exports=JSON.parse('{"permalink":"/blog/2025/11/21/08-iac/ansible-playbooks-avances","source":"@site/blog/08-iac/2025-11-21-ansible-playbooks-avances.md","title":"Ansible avanc\xe9 : R\xf4les, Ansible Vault et int\xe9gration CI/CD","description":"Fonctionnalit\xe9s avanc\xe9es d\'Ansible pour cr\xe9er des playbooks modulaires, s\xe9curiser les secrets et automatiser les d\xe9ploiements.","date":"2025-11-21T00:00:00.000Z","tags":[{"inline":true,"label":"Ansible","permalink":"/blog/tags/ansible"},{"inline":true,"label":"IaC","permalink":"/blog/tags/ia-c"},{"inline":true,"label":"DevOps","permalink":"/blog/tags/dev-ops"},{"inline":true,"label":"CI/CD","permalink":"/blog/tags/ci-cd"},{"inline":true,"label":"Automation","permalink":"/blog/tags/automation"}],"readingTime":6.51,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Ansible avanc\xe9 : R\xf4les, Ansible Vault et int\xe9gration CI/CD","description":"Fonctionnalit\xe9s avanc\xe9es d\'Ansible pour cr\xe9er des playbooks modulaires, s\xe9curiser les secrets et automatiser les d\xe9ploiements.","tags":["Ansible","IaC","DevOps","CI/CD","Automation"]},"unlisted":false,"prevItem":{"title":"Prometheus : Le syst\xe8me de monitoring moderne pour les infrastructures","permalink":"/blog/2025/11/21/07-monitoring/prometheus-introduction"},"nextItem":{"title":"Programmation asynchrone en Python : async/await et asyncio","permalink":"/blog/2025/11/21/09-scripting/python-async-await"}}')}}]);