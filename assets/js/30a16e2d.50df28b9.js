"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[8325],{56680:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>n,toc:()=>u});var n=s(15003),t=s(74848),l=s(28453);const a={title:"Pratiques recommand\xe9es pour Docker",description:"L'adoption de Docker augmente constamment et beaucoup le connaissent, mais tout le monde n'utilise pas Docker selon les meilleures pratiques.",tags:["Containerization","Docker","Devops"]},r=void 0,o={authorsImageUrls:[]},u=[{value:"Utilisez une image Docker officielle et v\xe9rifi\xe9e comme image de base, chaque fois disponible",id:"utilisez-une-image-docker-officielle-et-v\xe9rifi\xe9e-comme-image-de-base-chaque-fois-disponible",level:2},{value:"Utilisez des versions d&#39;image docker sp\xe9cifiques",id:"utilisez-des-versions-dimage-docker-sp\xe9cifiques",level:2},{value:"Utiliser des images officielles de petite taille",id:"utiliser-des-images-officielles-de-petite-taille",level:2},{value:"Optimiser la mise en cache pour les couches d&#39;image lors de la construction d&#39;une image",id:"optimiser-la-mise-en-cache-pour-les-couches-dimage-lors-de-la-construction-dune-image",level:2},{value:"\xe0 l&#39;aide d&#39;un fichier .dockerignore",id:"\xe0-laide-dun-fichier-dockerignore",level:2},{value:"Utilisez des versions multi-\xe9tages",id:"utilisez-des-versions-multi-\xe9tages",level:2},{value:"Utilisez l&#39;utilisateur le moins privil\xe9gi\xe9",id:"utilisez-lutilisateur-le-moins-privil\xe9gi\xe9",level:2},{value:"Scannez vos images pour les vuln\xe9rabilit\xe9s de s\xe9curit\xe9",id:"scannez-vos-images-pour-les-vuln\xe9rabilit\xe9s-de-s\xe9curit\xe9",level:2}];function c(e){const i={a:"a",h2:"h2",li:"li",ol:"ol",p:"p",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.h2,{id:"utilisez-une-image-docker-officielle-et-v\xe9rifi\xe9e-comme-image-de-base-chaque-fois-disponible",children:"Utilisez une image Docker officielle et v\xe9rifi\xe9e comme image de base, chaque fois disponible"}),"\n",(0,t.jsx)(i.p,{children:"Disons que vous d\xe9veloppez une application Node.js et que vous souhaitez la cr\xe9er et l'ex\xe9cuter en tant qu'image Docker."}),"\n",(0,t.jsx)(i.p,{children:"Au lieu de prendre une image du syst\xe8me d'exploitation de base et d'installer Node.js, NPM et tous les autres outils dont vous avez besoin pour votre application, utilisez l'image de node officiel pour votre application."}),"\n",(0,t.jsx)(i.h2,{id:"utilisez-des-versions-dimage-docker-sp\xe9cifiques",children:"Utilisez des versions d'image docker sp\xe9cifiques"}),"\n",(0,t.jsx)(i.p,{children:"D'accord, nous avons donc s\xe9lectionn\xe9 l'image de base, mais maintenant lorsque nous construisons notre image d'applications \xe0 partir de ce Dockerfile, il utilisera toujours la derni\xe8re balise de l'image de n\u0153ud."}),"\n",(0,t.jsx)(i.p,{children:"Ainsi, au lieu d'une \xe9tiquette d'image al\xe9atoire, vous souhaitez fixer la version, et tout comme vous d\xe9ployez votre propre application avec une version sp\xe9cifique, vous souhaitez utiliser l'image officielle avec une version sp\xe9cifique."}),"\n",(0,t.jsx)(i.h2,{id:"utiliser-des-images-officielles-de-petite-taille",children:"Utiliser des images officielles de petite taille"}),"\n",(0,t.jsx)(i.p,{children:"Lors du choix d'une image Node.js, vous verrez qu'il y a en fait plusieurs images officielles. Non seulement avec diff\xe9rents num\xe9ros de version mais aussi avec diff\xe9rentes distributions de syst\xe8mes d'exploitation:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.p,{children:"Taille de l'image : si l'image est bas\xe9e sur une distribution de syst\xe8me d'exploitation \xe0 part enti\xe8re comme Ubuntu ou Centos, vous aurez un tas d'outils d\xe9j\xe0 emball\xe9s dans l'image. Ainsi, la taille de l'image sera plus grande, mais vous n'avez pas besoin de la plupart de ces outils dans vos images d'application."}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["Probl\xe8me de s\xe9curit\xe9 : avec de nombreux outils install\xe9s \xe0 l'int\xe9rieur, vous devez consid\xe9rer l'aspect de s\xe9curit\xe9. Parce que ces images de base contiennent g\xe9n\xe9ralement ",(0,t.jsx)(i.a,{href:"https://snyk.io/blog/openSourcesEcurity-2020Survey/",children:"des centaines de vuln\xe9rabilit\xe9s connues"})," et cr\xe9ent essentiellement une plus grande surface d'attaque \xe0 votre image d'application."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Ainsi, la meilleure pratique ici serait de s\xe9lectionner une image avec une version sp\xe9cifique bas\xe9e sur une distribution plus maigre comme Alpine."}),"\n",(0,t.jsx)(i.h2,{id:"optimiser-la-mise-en-cache-pour-les-couches-dimage-lors-de-la-construction-dune-image",children:"Optimiser la mise en cache pour les couches d'image lors de la construction d'une image"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsx)(i.li,{children:"Que sont les layer d'image? Une image Docker est construite sur la base d'un dockerfile."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Et dans un dockerfile, chaque commande ou instruction cr\xe9e un layer d'image."}),"\n",(0,t.jsx)(i.p,{children:"Ainsi, lorsque nous utilisons une image de base d'alpine, il a d\xe9j\xe0 des layers, car il a d\xe9j\xe0 \xe9t\xe9 construit en utilisant son propre dockerfile. Dans notre dockerfile, nous avons quelques autres commandes qui ajouteront chacune un nouveau layer \xe0 cette image."}),"\n",(0,t.jsx)(i.p,{children:"Ainsi, lorsque vous reconstruisez votre image, si votre Dockerfile n'a pas chang\xe9, Docker n'utilisera que les layers en cache pour construire l'image."}),"\n",(0,t.jsx)(i.p,{children:"Avantages des layers d'image en cache:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"Contruction d'image plus rapide"}),"\n",(0,t.jsx)(i.li,{children:"Push et pull plus rapides de nouvelles versions d'image: Si je pull une nouvelle version d'image de la m\xeame application et, disons, 2 nouveaux layers ont \xe9t\xe9 ajout\xe9es dans la nouvelle version: seule la nouvelle version des layers ajout\xe9es seront t\xe9l\xe9charg\xe9es Les autres sont d\xe9j\xe0 mis en cache localement par Docker."}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"Optimiser la mise en cache : une fois qu'un layer change, tous les layers suivants doivent \xe9galement \xeatre recr\xe9\xe9es. En d'autres termes: lorsque vous modifiez le contenu d'une ligne dans le dockerfile, les caches de toutes les lignes ou layers suivantes seront invalid\xe9s."}),"\n",(0,t.jsx)(i.p,{children:"Ainsi, la r\xe8gle ici et la meilleure pratique est: placez vos commandes dans le Dockerfile du moins au plus fr\xe9quemment modif\xe9."}),"\n",(0,t.jsx)(i.h2,{id:"\xe0-laide-dun-fichier-dockerignore",children:"\xe0 l'aide d'un fichier .dockerignore"}),"\n",(0,t.jsx)(i.p,{children:"C'est assez simple. Nous cr\xe9ons simplement ce fichier .dockerignore et r\xe9pertorions tous les fichiers et dossiers que nous voulons \xeatre ignor\xe9s, et lors de la cr\xe9ation de l'image, Docker examinera le contenu et ignorera tout ce qui est sp\xe9cifi\xe9 \xe0 l'int\xe9rieur."}),"\n",(0,t.jsx)(i.h2,{id:"utilisez-des-versions-multi-\xe9tages",children:"Utilisez des versions multi-\xe9tages"}),"\n",(0,t.jsx)(i.p,{children:"Maintenant, disons qu'il existe un outil dans votre projet dont vous avez besoin pour construire l'image mais vous n'en avez pas besoin dans l'image finale pour ex\xe9cuter leapplication."}),"\n",(0,t.jsx)(i.p,{children:"Supposons que vous conserviez ces artefacts dans votre image finale, m\xeame s'ils sont absolument inutiles pour ex\xe9cuter l'application. Dans ce cas, cela entra\xeenera \xe0 nouveau une augmentation de la taille de l'image et une augmentation de la surface d'attaque."}),"\n",(0,t.jsx)(i.p,{children:"Pour cela, vous pouvez utiliser ce qu'on appelle les constructions \xe0 plusieurs \xe9tages"}),"\n",(0,t.jsx)(i.p,{children:"La fonction de construction en plusieurs \xe9tapes vous permet d'utiliser plusieurs images temporaires pendant le processus de construction, mais ne conserve que la derni\xe8re image comme artefact final."}),"\n",(0,t.jsx)(i.h2,{id:"utilisez-lutilisateur-le-moins-privil\xe9gi\xe9",children:"Utilisez l'utilisateur le moins privil\xe9gi\xe9"}),"\n",(0,t.jsx)(i.p,{children:"Maintenant, lorsque nous cr\xe9ons cette image et que nous l'ex\xe9cutons finalement en tant que conteneur, quel utilisateur du syst\xe8me d'exploitation sera utilis\xe9 pour d\xe9marrer l'application \xe0 l'int\xe9rieur? Par d\xe9faut, lorsqu'un DockerFile ne sp\xe9cifie pas un utilisateur, il utilise un utilisateur root. Mais en r\xe9alit\xe9, il n'y a surtout aucune raison d'ex\xe9cuter des conteneurs avec des privil\xe8ges root."}),"\n",(0,t.jsx)(i.p,{children:"Cela introduit essentiellement un probl\xe8me de s\xe9curit\xe9 car lorsque le conteneur commence sur l'h\xf4te, il aura potentiellement un acc\xe8s root sur l'h\xf4te Docker."}),"\n",(0,t.jsx)(i.p,{children:"Pour \xe9viter cela, la meilleure pratique consiste \xe0 cr\xe9er simplement un utilisateur d\xe9di\xe9 et un groupe d\xe9di\xe9 dans l'image Docker pour ex\xe9cuter l'application et \xe9galement ex\xe9cuter l'application \xe0 l'int\xe9rieur du conteneur avec cet utilisateur."}),"\n",(0,t.jsx)(i.h2,{id:"scannez-vos-images-pour-les-vuln\xe9rabilit\xe9s-de-s\xe9curit\xe9",children:"Scannez vos images pour les vuln\xe9rabilit\xe9s de s\xe9curit\xe9"}),"\n",(0,t.jsx)(i.p,{children:"Enfin, comment s'assurer et valider que l'image que vous construisez a peu ou pas de vuln\xe9rabilit\xe9s de s\xe9curit\xe9 ?"}),"\n",(0,t.jsx)(i.p,{children:"La meilleure pratique est, une fois que vous avez construit l'image, la scannez pour des vuln\xe9rabilit\xe9s de s\xe9curit\xe9 \xe0 l'aide de la commande docker scan."}),"\n",(0,t.jsx)(i.p,{children:"En arri\xe8re-plan, Docker utilise en fait un service appel\xe9 SNYK pour faire la num\xe9risation de la vuln\xe9rabilit\xe9 des images. Le scan utilise une base de donn\xe9es de vuln\xe9rabilit\xe9s, qui est constamment mise \xe0 jour."})]})}function d(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,i,s)=>{s.d(i,{R:()=>a,x:()=>r});var n=s(96540);const t={},l=n.createContext(t);function a(e){const i=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),n.createElement(l.Provider,{value:i},e.children)}},15003:e=>{e.exports=JSON.parse('{"permalink":"/blog/2024/08/30/03-containerization/docker-best-practices","source":"@site/blog/03-containerization/2024-08-30-docker-best-practices.md","title":"Pratiques recommand\xe9es pour Docker","description":"L\'adoption de Docker augmente constamment et beaucoup le connaissent, mais tout le monde n\'utilise pas Docker selon les meilleures pratiques.","date":"2024-08-30T00:00:00.000Z","tags":[{"inline":true,"label":"Containerization","permalink":"/blog/tags/containerization"},{"inline":true,"label":"Docker","permalink":"/blog/tags/docker"},{"inline":true,"label":"Devops","permalink":"/blog/tags/devops"}],"readingTime":4.505,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Pratiques recommand\xe9es pour Docker","description":"L\'adoption de Docker augmente constamment et beaucoup le connaissent, mais tout le monde n\'utilise pas Docker selon les meilleures pratiques.","tags":["Containerization","Docker","Devops"]},"unlisted":false,"prevItem":{"title":"GitHub GHCR","permalink":"/blog/2024/09/31/03-containerization/ghrc"},"nextItem":{"title":"D\xe9bogage des conteneurs Docker","permalink":"/blog/2024/08/15/03-containerization/debugging-docker-containers"}}')}}]);