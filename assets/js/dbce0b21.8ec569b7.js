"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[6252],{19350:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var t=n(74848),i=n(28453);const o={title:"GitHub GHCR",tags:["CI/CD","GitHub","Devops"]},a=void 0,r={permalink:"/blog/2024/02/18/04-ci-cd/ghrc",source:"@site/blog/04-ci-cd/2024-02-18-ghrc.md",title:"GitHub GHCR",description:"GitHub Container Registry (GHCR) est un service d'h\xe9bergement de packages logiciels propos\xe9 par GitHub, permettant aux utilisateurs de stocker des packages priv\xe9s ou publics et de les utiliser comme d\xe9pendances dans leurs projets. Compatible avec plusieurs langages de programmation, GitHub Packages propose des registres pour des gestionnaires de packages tels que npm, RubyGems, Maven, Gradle, Docker, et NuGet. L'authentification sur GitHub Packages se fait exclusivement via un \"personal access token (classic)\". Les utilisateurs doivent disposer de ce token pour effectuer des op\xe9rations telles que la publication, l'installation et la suppression de packages, qu'ils soient publics, priv\xe9s ou internes. Pour les packages priv\xe9s, GitHub Packages applique des limites de stockage et de transfert de donn\xe9es en fonction du plan du compte. La gestion des packages peut \xeatre r\xe9alis\xe9e \xe0 travers l'interface utilisateur GitHub ou via l'API REST. Des webhooks peuvent \xe9galement \xeatre configur\xe9s pour suivre des \xe9v\xe9nements li\xe9s aux packages, comme la publication ou la mise \xe0 jour.",date:"2024-02-18T00:00:00.000Z",tags:[{inline:!0,label:"CI/CD",permalink:"/blog/tags/ci-cd"},{inline:!0,label:"GitHub",permalink:"/blog/tags/git-hub"},{inline:!0,label:"Devops",permalink:"/blog/tags/devops"}],readingTime:2.845,hasTruncateMarker:!0,authors:[],frontMatter:{title:"GitHub GHCR",tags:["CI/CD","GitHub","Devops"]},unlisted:!1,prevItem:{title:"Le concept de conteneur Docker",permalink:"/blog/2024/02/18/03-containerization/docker"},nextItem:{title:"Runner GitHub Self-Hosted",permalink:"/blog/2024/02/11/04-ci-cd/self-host-runner"}},c={authorsImageUrls:[]},l=[{value:"Cr\xe9ez un fichier YAML pour le Workflow",id:"cr\xe9ez-un-fichier-yaml-pour-le-workflow",level:2},{value:"Configurez les Options du Workflow",id:"configurez-les-options-du-workflow",level:3},{value:"Utilisation d\u2019un package GHCR",id:"utilisation-dun-package-ghcr",level:2}];function u(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"GitHub Container Registry (GHCR) est un service d'h\xe9bergement de packages logiciels propos\xe9 par GitHub, permettant aux utilisateurs de stocker des packages priv\xe9s ou publics et de les utiliser comme d\xe9pendances dans leurs projets. Compatible avec plusieurs langages de programmation, GitHub Packages propose des registres pour des gestionnaires de packages tels que npm, RubyGems, Maven, Gradle, Docker, et NuGet. L'authentification sur GitHub Packages se fait exclusivement via un \"personal access token (classic)\". Les utilisateurs doivent disposer de ce token pour effectuer des op\xe9rations telles que la publication, l'installation et la suppression de packages, qu'ils soient publics, priv\xe9s ou internes. Pour les packages priv\xe9s, GitHub Packages applique des limites de stockage et de transfert de donn\xe9es en fonction du plan du compte. La gestion des packages peut \xeatre r\xe9alis\xe9e \xe0 travers l'interface utilisateur GitHub ou via l'API REST. Des webhooks peuvent \xe9galement \xeatre configur\xe9s pour suivre des \xe9v\xe9nements li\xe9s aux packages, comme la publication ou la mise \xe0 jour."}),"\n",(0,t.jsxs)(s.p,{children:["Le workflow suppose que vous avez un ",(0,t.jsx)(s.code,{children:"Dockerfile"})," \xe0 la racine du d\xe9p\xf4t. Ce ",(0,t.jsx)(s.code,{children:"Dockerfile"})," doit r\xe9ussir la commande de ",(0,t.jsx)(s.code,{children:"build"})," avec succ\xe8s"]}),"\n",(0,t.jsx)(s.h2,{id:"cr\xe9ez-un-fichier-yaml-pour-le-workflow",children:"Cr\xe9ez un fichier YAML pour le Workflow"}),"\n",(0,t.jsxs)(s.p,{children:["Cr\xe9ez un fichier YAML (par exemple, ",(0,t.jsx)(s.code,{children:"docker-publish.yml"}),") dans le r\xe9pertoire ",(0,t.jsx)(s.code,{children:".github/workflows/"})," de votre d\xe9p\xf4t avec le contenu suivant :"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"name: Create and publish a Docker image\n\non:\n    push:\n    branches: ['release']\n\nenv:\n    REGISTRY: ghcr.io\n    IMAGE_NAME: ${{ github.repository }}\n\njobs:\n    build-and-push-image:\n    runs-on: ubuntu-latest\n\n    permissions:\n        contents: read\n        packages: write\n\n    steps:\n        - name: Checkout repository\n        uses: actions/checkout@v4\n\n        - name: Log in to the Container registry\n        uses: docker/login-action@65b78e6e13532edd9afa3aa52ac7964289d1a9c1\n        with:\n            registry: ${{ env.REGISTRY }}\n            username: ${{ github.actor }}\n            password: ${{ secrets.GITHUB_TOKEN }}\n\n        - name: Extract metadata (tags, labels) for Docker\n        id: meta\n        uses: docker/metadata-action@9ec57ed1fcdbf14dcef7dfbe97b2010124a938b7\n        with:\n            images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}\n\n        - name: Build and push Docker image\n        uses: docker/build-push-action@f2a1d5e99d037542a71f64918e516c093c6f3fc4\n        with:\n            context: .\n            push: true\n            tags: ${{ steps.meta.outputs.tags }}\n            labels: ${{ steps.meta.outputs.labels }}\n"})}),"\n",(0,t.jsx)(s.h3,{id:"configurez-les-options-du-workflow",children:"Configurez les Options du Workflow"}),"\n",(0,t.jsx)(s.p,{children:"Dans le fichier YAML, vous pouvez personnaliser les options suivantes selon vos besoins :"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"branches"}),": Modifiez la branche d\xe9clenchant le workflow."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"REGISTRY"})," et ",(0,t.jsx)(s.code,{children:"IMAGE_NAME"}),": Modifiez-les si vous souhaitez utiliser un autre registre ou nom d'image."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"permissions"}),": Ajustez les autorisations en fonction de vos besoins."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Enregistrez et Poussez vos Modifications"}),'\nEnregistrez les modifications dans le fichier YAML et poussez-les vers la branche "release" de votre d\xe9p\xf4t GitHub.']}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:'git add .github/workflows/docker-publish.yml\ngit commit -m "Ajout du workflow de publication Docker"\ngit push origin release\n'})}),"\n",(0,t.jsx)(s.h2,{id:"utilisation-dun-package-ghcr",children:"Utilisation d\u2019un package GHCR"}),"\n",(0,t.jsx)(s.p,{children:"Une fois d\xe9ploy\xe9, le package s\u2019utilise comme n\u2019importe quel docker"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"docker pull ghcr.io/{USER}/{REPO-NAME}:master\n"})}),"\n",(0,t.jsxs)(s.p,{children:["\ud83d\udca1 L\u2019utilisation des Github GHCR entraine des consommations d\u2019espace. Le CATIE a le droit \xe0 2Gb de stockage sur GHCR et 10Gb de transit par mois. Au del\xe0 de ces limites, nous sommes factur\xe9s.\nL\u2019utilisation (sous n\u2019importe quelle forme) de GHCR sur des d\xe9p\xf4ts ",(0,t.jsx)(s.strong,{children:"publics"})," est totalement gratuite Sur des d\xe9p\xf4ts priv\xe9s : le pull via des actions est gratuit. Pour les actions ",(0,t.jsx)(s.code,{children:"self-hosted"})," le pull est gratuit si l\u2019action est authentifi\xe9e par le ",(0,t.jsx)(s.code,{children:"GITHUB_TOKEN"})," et non un PAT."]}),"\n",(0,t.jsx)(s.p,{children:"Voici un exemple d\u2019utilisation sans co\xfbt associ\xe9"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:'name: Run in container from GHCR\n\non: [ push ]\n\njobs:\n    myJob:\n    runs-on: ubuntu-latest\n    container:\n        image: ghcr.io/sedelpeuch/github-ghcr-test:master\n    steps:\n\n        - name: Checkout code\n        uses: actions/checkout@v2\n\n        - name: Run a command\n        run: echo "Running inside the container"\n'})}),"\n",(0,t.jsxs)(s.p,{children:["L\u2019image ",(0,t.jsxs)(s.a,{href:"http://ghcr.io/sedelpeuch/github-ghcr-test:master",children:["ghcr.io/sedelpeuch/github-ghcr-test",":master"]})," est priv\xe9e, l\u2019acc\xe8s est possible sans donner de PAT gr\xe2ce \xe0 l\u2019authentification par jeton automatique qui poss\xe8de la lecture des packages priv\xe9s ",(0,t.jsx)(s.a,{href:"https://docs.github.com/fr/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token",children:"https://docs.github.com/fr/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token"})]})]})}function d(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>r});var t=n(96540);const i={},o=t.createContext(i);function a(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);