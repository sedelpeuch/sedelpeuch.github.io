"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[7022],{26210:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var s=t(70589),i=t(74848),o=t(28453);const r={title:"Actions Composites",description:"Cr\xe9\xe9er une action r\xe9utilisable",tags:["CI/CD","GitHub","Devops"]},a=void 0,l={authorsImageUrls:[]},c=[{value:"Exemple de cr\xe9ation et d&#39;utilisation d&#39;une action GitHub",id:"exemple-de-cr\xe9ation-et-dutilisation-dune-action-github",level:2},{value:"Comment cr\xe9er ses propres actions",id:"comment-cr\xe9er-ses-propres-actions",level:2},{value:"Cr\xe9ation d\u2019une action",id:"cr\xe9ation-dune-action",level:2},{value:"Tester l\u2019action dans un workflow",id:"tester-laction-dans-un-workflow",level:2},{value:"Action dans un workflow priv\xe9",id:"action-dans-un-workflow-priv\xe9",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"exemple-de-cr\xe9ation-et-dutilisation-dune-action-github",children:"Exemple de cr\xe9ation et d'utilisation d'une action GitHub"}),"\n",(0,i.jsx)(n.p,{children:"Voici un exemple de cr\xe9ation et d'utilisation d'une action GitHub pour automatiser le d\xe9ploiement d'une application Node.js."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Cr\xe9ez un fichier ",(0,i.jsx)(n.code,{children:"action.yml"})," dans le r\xe9pertoire ",(0,i.jsx)(n.code,{children:".github/actions/deploy"})," de votre d\xe9p\xf4t avec le contenu suivant :"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"name: 'Deploy Node.js App'\ndescription: 'Deploy a Node.js application to a remote server'\ninputs:\n  server:\n    description: 'The remote server to deploy to'\n    required: true\n  username:\n    description: 'The username to use for the deployment'\n    required: true\n  password:\n    description: 'The password to use for the deployment'\n    required: true\nruns:\n  using: 'composite'\n  steps:\n    - name: Checkout code\n      uses: actions/checkout@v4\n    - name: Install dependencies\n      run: npm install\n    - name: Build application\n      run: npm run build\n    - name: Deploy application\n      run: |\n        sshpass -p ${{ inputs.password }} ssh ${{ inputs.username }}@${{ inputs.server }} 'mkdir -p /var/www/myapp'\n        sshpass -p ${{ inputs.password }} scp -r ./build/* ${{ inputs.username }}@${{ inputs.server }}:/var/www/myapp\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Cr\xe9ez un fichier ",(0,i.jsx)(n.code,{children:"deploy.yml"})," dans le r\xe9pertoire ",(0,i.jsx)(n.code,{children:".github/workflows"})," de votre d\xe9p\xf4t avec le contenu suivant :"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"name: Deploy Node.js App\n\non:\n  push:\n    branches:\n      - main\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Deploy application\n        uses: ./.github/actions/deploy\n        with:\n          server: ${{ secrets.DEPLOY_SERVER }}\n          username: ${{ secrets.DEPLOY_USERNAME }}\n          password: ${{ secrets.DEPLOY_PASSWORD }}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Dans cet exemple, l'action ",(0,i.jsx)(n.code,{children:"Deploy Node.js App"})," est utilis\xe9e pour d\xe9ployer une application Node.js sur un serveur distant. L'action est d\xe9clench\xe9e \xe0 chaque fois qu'un push est effectu\xe9 sur la branche ",(0,i.jsx)(n.code,{children:"main"}),". Les informations de d\xe9ploiement (serveur, nom d'utilisateur et mot de passe) sont stock\xe9es dans les secrets du d\xe9p\xf4t pour des raisons de s\xe9curit\xe9."]}),"\n",(0,i.jsx)(n.p,{children:"Les actions GitHub permettent d'automatiser, personnaliser et ex\xe9cuter un flux de travail directement depuis votre d\xe9p\xf4t. Avec les actions GitHub, il est possible de cr\xe9er des t\xe2ches personnalis\xe9es pour automatiser un flux de travail, partager et d\xe9couvrir des actions pour effectuer des t\xe2ches sp\xe9cifiques."}),"\n",(0,i.jsx)(n.h2,{id:"comment-cr\xe9er-ses-propres-actions",children:"Comment cr\xe9er ses propres actions"}),"\n",(0,i.jsxs)(n.p,{children:["Documentation compl\xe8te : ",(0,i.jsx)(n.a,{href:"https://docs.github.com/fr/actions/creating-actions",children:"https://docs.github.com/fr/actions/creating-actions"})]}),"\n",(0,i.jsx)(n.p,{children:"La cr\xe9ation d'actions personnalis\xe9es offre la possibilit\xe9 de concevoir du code sp\xe9cifique qui interagit avec le d\xe9p\xf4t selon les besoins. Ces actions peuvent s'int\xe9grer aux API de GitHub ou \xe0 toute API tierce accessible publiquement. Par exemple, une action pourrait \xeatre configur\xe9e pour publier des modules npm, envoyer des alertes par SMS en cas de cr\xe9ation de probl\xe8mes urgents, ou encore d\xe9ployer du code pr\xeat pour la production.\nCe guide expose les \xe9l\xe9ments fondamentaux requis pour la cr\xe9ation et l'utilisation d'une action composite empaquet\xe9e."}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["Lors de la cr\xe9ation de flux de travail et d'actions, il est imp\xe9ratif d'\xe9valuer constamment la possibilit\xe9 d'ex\xe9cution d'une entr\xe9e non fiable provenant de sources potentiellement malveillantes. Certains contextes doivent \xeatre trait\xe9s comme des entr\xe9es non fiables, car un attaquant pourrait ins\xe9rer son propre contenu malveillant. Pour de plus amples informations, veuillez consulter la section \xab ",(0,i.jsx)(n.a,{href:"https://docs.github.com/fr/actions/security-guides/security-hardening-for-github-actions#understanding-the-risk-of-script-injections",children:"Durcissement de la s\xe9curit\xe9 pour GitHub Actions"})," \xbb."]})}),"\n",(0,i.jsx)(n.h2,{id:"cr\xe9ation-dune-action",children:"Cr\xe9ation d\u2019une action"}),"\n",(0,i.jsxs)(n.p,{children:["Un d\xe9p\xf4t doit \xeatre cr\xe9\xe9 sur ",(0,i.jsx)(n.a,{href:"http://GitHub.com",children:"GitHub.com"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Cr\xe9ez un nouveau d\xe9p\xf4t sur ",(0,i.jsx)(n.a,{href:"http://GitHub.com",children:"GitHub"}),", en choisissant n'importe quel nom de d\xe9p\xf4t ou en utilisant l'exemple suivant : ",(0,i.jsx)(n.code,{children:"hello-world-composite-action"}),". Les fichiers peuvent \xeatre ajout\xe9s une fois que le projet est pouss\xe9 sur GitHub. Pour plus d'informations, veuillez vous r\xe9f\xe9rer \xe0 la section ",(0,i.jsx)(n.a,{href:"https://docs.github.com/fr/repositories/creating-and-managing-repositories/creating-a-new-repository",children:"Cr\xe9ation d'un d\xe9p\xf4t"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Dans le d\xe9p\xf4t ",(0,i.jsx)(n.code,{children:"hello-world-composite-action"}),", cr\xe9ez un fichier nomm\xe9 ",(0,i.jsx)(n.code,{children:"goodbye.sh"})," et ajoutez le code ",(0,i.jsx)(n.code,{children:'echo "Goodbye'})]}),"\n",(0,i.jsxs)(n.li,{children:["Rendez ",(0,i.jsx)(n.code,{children:"goodbye.sh"})," ex\xe9cutable depuis votre terminal."]}),"\n",(0,i.jsxs)(n.li,{children:["Dans le d\xe9p\xf4t ",(0,i.jsx)(n.code,{children:"hello-world-composite-action"}),", cr\xe9ez un fichier nomm\xe9 ",(0,i.jsx)(n.code,{children:"action.yml"})," et ajoutez le code suivant en exemple. Pour plus d'informations sur cette syntaxe, consultez la section ",(0,i.jsx)(n.a,{href:"https://docs.github.com/fr/actions/creating-actions/metadata-syntax-for-github-actions#runs-for-composite-actions",children:"Syntaxe des m\xe9tadonn\xe9es pour les actions GitHub"})," ."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"    name: 'Hello World'\n    description: 'Greet someone'\n    inputs:\n      who-to-greet:  # id of input\n        description: 'Who to greet'\n        required: true\n        default: 'World'\n    outputs:\n      random-number:\n        description: \"Random number\"\n        value: ${{ steps.random-number-generator.outputs.random-number }}\n    runs:\n      using: \"composite\"\n      steps:\n        - run: echo Hello ${{ inputs.who-to-greet }}.\n          shell: bash\n        - id: random-number-generator\n          run: echo \"random-number=$(echo $RANDOM)\" >> $GITHUB_OUTPUT\n          shell: bash\n        - run: echo \"${{ github.action_path }}\" >> $GITHUB_PATH\n          shell: bash\n        - run: goodbye.sh\n          shell: bash\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Ce fichier d\xe9finit l'entr\xe9e ",(0,i.jsx)(n.code,{children:"who-to-greet"}),", mappe le nombre g\xe9n\xe9r\xe9 al\xe9atoirement \xe0 la variable de sortie ",(0,i.jsx)(n.code,{children:"random-number"}),", ajoute le chemin d'acc\xe8s de l'action au chemin d'acc\xe8s du syst\xe8me de l'ex\xe9cuteur (pour localiser le script ",(0,i.jsx)(n.code,{children:"goodbye.sh"})," lors de l'ex\xe9cution) et ex\xe9cute le script ."]}),"\n",(0,i.jsxs)(n.li,{children:["Effectuez le commit de votre fichier ",(0,i.jsx)(n.code,{children:"action.yml"})," depuis votre terminal."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'    git add action.yml\n    git commit -m "Add action"\n    git push\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Ajoutez une \xe9tiquette depuis votre terminal. Cet exemple utilise une \xe9tiquette nomm\xe9e ",(0,i.jsx)(n.code,{children:"v1"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'    git tag -a -m "Description of this release" v1\n    git push --follow-tags\n'})}),"\n",(0,i.jsx)(n.h2,{id:"tester-laction-dans-un-workflow",children:"Tester l\u2019action dans un workflow"}),"\n",(0,i.jsxs)(n.p,{children:["Copiez le code de workflow dans un fichier ",(0,i.jsx)(n.code,{children:".github/workflows/main.yml"})," d'un autre d\xe9p\xf4t"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"    on: [push]\n\n    jobs:\n      hello_world_job:\n        runs-on: ubuntu-latest\n        name: A job to say hello\n        steps:\n          - uses: actions/checkout@v4\n          - id: foo\n            uses: actions/hello-world-composite-action@v1\n            with:\n              who-to-greet: 'Mona the Octocat'\n          - run: echo random-number ${{ steps.foo.outputs.random-number }}\n            shell: bash\n"})}),"\n",(0,i.jsx)(n.h2,{id:"action-dans-un-workflow-priv\xe9",children:"Action dans un workflow priv\xe9"}),"\n",(0,i.jsx)(n.p,{children:"Dans les param\xe8tres des actions, il est n\xe9cessaire de la partager \xe0 l\u2019organisation"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"AllowAction",src:t(96168).A+"",width:"788",height:"273"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},96168:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/allow_action-bfc7861aa70e40d33daa3bd986fb4ec3.png"},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(96540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}},70589:e=>{e.exports=JSON.parse('{"permalink":"/blog/2024/03/28/04-ci-cd/action","source":"@site/blog/04-ci-cd/2024-03-28-action.md","title":"Actions Composites","description":"Cr\xe9\xe9er une action r\xe9utilisable","date":"2024-03-28T00:00:00.000Z","tags":[{"inline":true,"label":"CI/CD","permalink":"/blog/tags/ci-cd"},{"inline":true,"label":"GitHub","permalink":"/blog/tags/git-hub"},{"inline":true,"label":"Devops","permalink":"/blog/tags/devops"}],"readingTime":4.075,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Actions Composites","description":"Cr\xe9\xe9er une action r\xe9utilisable","tags":["CI/CD","GitHub","Devops"]},"unlisted":false,"prevItem":{"title":"Runner GitHub Self-Hosted","permalink":"/blog/2024/04/15/04-ci-cd/self-host-runner"},"nextItem":{"title":"Workflows","permalink":"/blog/2024/03/17/04-ci-cd/workflow"}}')}}]);