"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[8972],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var r=s(96540);const t={},i=r.createContext(t);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(i.Provider,{value:n},e.children)}},64691:e=>{e.exports=JSON.parse('{"permalink":"/blog/2025/06/06/06-orchestration/renouveller-certificats","source":"@site/blog/06-orchestration/2025-06-06-renouveller-certificats.md","title":"Renouvellement des certificats Kubernetes sur kubeadm","description":"Guide pratique pour renouveler les certificats expirants dans un cluster Kubernetes d\xe9ploy\xe9 avec kubeadm.","date":"2025-06-06T00:00:00.000Z","tags":[{"inline":true,"label":"Kubernetes","permalink":"/blog/tags/kubernetes"},{"inline":true,"label":"Orchestration","permalink":"/blog/tags/orchestration"},{"inline":true,"label":"Devops","permalink":"/blog/tags/devops"}],"readingTime":4.71,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Renouvellement des certificats Kubernetes sur kubeadm","description":"Guide pratique pour renouveler les certificats expirants dans un cluster Kubernetes d\xe9ploy\xe9 avec kubeadm.","tags":["Kubernetes","Orchestration","Devops"]},"unlisted":false,"nextItem":{"title":"Pydantic: Validation de donn\xe9es robuste pour Python","permalink":"/blog/2025/03/30/09-scripting/pydantic-validation-donnees"}}')},73410:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>o});var r=s(64691),t=s(74848),i=s(28453);const l={title:"Renouvellement des certificats Kubernetes sur kubeadm",description:"Guide pratique pour renouveler les certificats expirants dans un cluster Kubernetes d\xe9ploy\xe9 avec kubeadm.",tags:["Kubernetes","Orchestration","Devops"]},c=void 0,a={authorsImageUrls:[]},o=[{value:"La probl\xe9matique des certificats expirants \ud83d\udcc5",id:"la-probl\xe9matique-des-certificats-expirants-",level:2},{value:"V\xe9rification des dates d&#39;expiration \u23f1\ufe0f",id:"v\xe9rification-des-dates-dexpiration-\ufe0f",level:2},{value:"Processus de renouvellement des certificats \ud83d\udd04",id:"processus-de-renouvellement-des-certificats-",level:2},{value:"1. Renouvellement de tous les certificats",id:"1-renouvellement-de-tous-les-certificats",level:3},{value:"2. Renouvellement des certificats sp\xe9cifiques",id:"2-renouvellement-des-certificats-sp\xe9cifiques",level:3},{value:"3. Mise \xe0 jour des fichiers kubeconfig",id:"3-mise-\xe0-jour-des-fichiers-kubeconfig",level:3},{value:"Red\xe9marrage des composants \ud83d\udd04",id:"red\xe9marrage-des-composants-",level:2},{value:"Forcer le red\xe9marrage en cas de probl\xe8me \u26a0\ufe0f",id:"forcer-le-red\xe9marrage-en-cas-de-probl\xe8me-\ufe0f",level:3},{value:"Automatisation du renouvellement \ud83e\udd16",id:"automatisation-du-renouvellement-",level:2},{value:"Bonnes pratiques \ud83d\udee1\ufe0f",id:"bonnes-pratiques-\ufe0f",level:2},{value:"Conclusion \ud83c\udfaf",id:"conclusion-",level:2}];function u(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Les certificats jouent un r\xf4le crucial dans la s\xe9curit\xe9 de Kubernetes. Ils assurent l'authentification et le chiffrement des communications entre les diff\xe9rents composants du cluster. Cependant, ces certificats ont une dur\xe9e de vie limit\xe9e et doivent \xeatre renouvel\xe9s avant leur expiration pour maintenir le bon fonctionnement du cluster. \ud83d\udd10"}),"\n",(0,t.jsx)(n.h2,{id:"la-probl\xe9matique-des-certificats-expirants-",children:"La probl\xe9matique des certificats expirants \ud83d\udcc5"}),"\n",(0,t.jsx)(n.p,{children:"Par d\xe9faut, les certificats g\xe9n\xe9r\xe9s par kubeadm ont une dur\xe9e de validit\xe9 d'un an. Lorsqu'ils expirent, les composants du cluster ne peuvent plus communiquer entre eux de mani\xe8re s\xe9curis\xe9e, ce qui peut entra\xeener une panne compl\xe8te du cluster."}),"\n",(0,t.jsx)(n.p,{children:"Les sympt\xf4mes typiques d'un certificat expir\xe9 incluent :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Impossibilit\xe9 d'utiliser ",(0,t.jsx)(n.code,{children:"kubectl"})]}),"\n",(0,t.jsx)(n.li,{children:"Les nouveaux pods ne sont plus programm\xe9s"}),"\n",(0,t.jsxs)(n.li,{children:["Messages d'erreur du type ",(0,t.jsx)(n.code,{children:"x509: certificate has expired or is not yet valid"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"v\xe9rification-des-dates-dexpiration-\ufe0f",children:"V\xe9rification des dates d'expiration \u23f1\ufe0f"}),"\n",(0,t.jsx)(n.p,{children:"Avant de proc\xe9der au renouvellement, il est important de v\xe9rifier la date d'expiration des certificats actuels. Pour cela, vous pouvez utiliser la commande suivante :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubeadm certs check-expiration\n"})}),"\n",(0,t.jsx)(n.p,{children:"Cette commande affiche une liste de tous les certificats avec leurs dates d'expiration respectives :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED\nadmin.conf                 Jun 05, 2026 12:51 UTC   364d            ca                      no\napiserver                  Jun 05, 2026 12:51 UTC   364d            ca                      no\napiserver-kubelet-client   Jun 05, 2026 12:51 UTC   364d            ca                      no\ncontroller-manager.conf    Jun 05, 2026 12:51 UTC   364d            ca                      no\nkubelet.conf              Jun 05, 2026 12:51 UTC   364d            ca                      no\nscheduler.conf             Jun 05, 2026 12:51 UTC   364d            ca                      no\n...\n"})}),"\n",(0,t.jsx)(n.h2,{id:"processus-de-renouvellement-des-certificats-",children:"Processus de renouvellement des certificats \ud83d\udd04"}),"\n",(0,t.jsx)(n.h3,{id:"1-renouvellement-de-tous-les-certificats",children:"1. Renouvellement de tous les certificats"}),"\n",(0,t.jsx)(n.p,{children:"La m\xe9thode la plus simple consiste \xe0 renouveler tous les certificats \xe0 la fois :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm certs renew all\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Cette commande renouvelle tous les certificats g\xe9r\xe9s par kubeadm et les stocke dans le r\xe9pertoire ",(0,t.jsx)(n.code,{children:"/etc/kubernetes/pki"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"2-renouvellement-des-certificats-sp\xe9cifiques",children:"2. Renouvellement des certificats sp\xe9cifiques"}),"\n",(0,t.jsx)(n.p,{children:"Si vous pr\xe9f\xe9rez renouveler les certificats un par un, vous pouvez sp\xe9cifier le certificat \xe0 renouveler :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo kubeadm certs renew apiserver\nsudo kubeadm certs renew apiserver-kubelet-client\nsudo kubeadm certs renew front-proxy-client\n# etc.\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-mise-\xe0-jour-des-fichiers-kubeconfig",children:"3. Mise \xe0 jour des fichiers kubeconfig"}),"\n",(0,t.jsx)(n.p,{children:"Apr\xe8s avoir renouvel\xe9 les certificats, il est n\xe9cessaire de mettre \xe0 jour les fichiers kubeconfig :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,t.jsx)(n.h2,{id:"red\xe9marrage-des-composants-",children:"Red\xe9marrage des composants \ud83d\udd04"}),"\n",(0,t.jsx)(n.p,{children:"Pour que les nouveaux certificats soient pris en compte, il faut red\xe9marrer les composants du plan de contr\xf4le :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart kubelet\n"})}),"\n",(0,t.jsx)(n.p,{children:"Sur un cluster multi-n\u0153uds, vous devez \xe9galement red\xe9marrer le kubelet sur chaque n\u0153ud worker :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Sur chaque n\u0153ud worker\nsudo systemctl restart kubelet\n"})}),"\n",(0,t.jsx)(n.h3,{id:"forcer-le-red\xe9marrage-en-cas-de-probl\xe8me-\ufe0f",children:"Forcer le red\xe9marrage en cas de probl\xe8me \u26a0\ufe0f"}),"\n",(0,t.jsx)(n.p,{children:"Dans certains cas, un simple red\xe9marrage du kubelet peut ne pas suffire pour que les nouveaux certificats soient pris en compte. Si vous rencontrez toujours des probl\xe8mes apr\xe8s le red\xe9marrage normal, deux m\xe9thodes plus radicales peuvent \xeatre utilis\xe9es :"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"M\xe9thode 1 : Manipulation des manifests statiques"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Sauvegarde et renommage temporaire des manifests\ncd /etc/kubernetes/manifests\nsudo mkdir -p /root/manifests_backup\nsudo cp *.yaml /root/manifests_backup/\nsudo mv *.yaml /tmp/\n\n# Attendre que le cluster s'arr\xeate (les pods du plan de contr\xf4le dispara\xeetront)\n# Puis restaurer les manifests pour red\xe9marrer les composants\nsudo mv /tmp/*.yaml .\n"})}),"\n",(0,t.jsx)(n.p,{children:"Cette m\xe9thode force kubelet \xe0 supprimer puis recr\xe9er tous les pods du plan de contr\xf4le, garantissant ainsi l'utilisation des nouveaux certificats."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"M\xe9thode 2 : Suppression manuelle des pods"})}),"\n",(0,t.jsx)(n.p,{children:"Si vous avez encore acc\xe8s \xe0 l'API Kubernetes, vous pouvez supprimer manuellement les pods du plan de contr\xf4le :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Attention : commande \xe0 utiliser avec pr\xe9caution\nkubectl -n kube-system delete pod -l component=kube-apiserver\nkubectl -n kube-system delete pod -l component=kube-controller-manager\nkubectl -n kube-system delete pod -l component=kube-scheduler\nkubectl -n kube-system delete pod -l k8s-app=kube-proxy\n"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["\u26a0\ufe0f ",(0,t.jsx)(n.strong,{children:"Attention"})," : Ces m\xe9thodes provoquent une interruption temporaire du service. Planifiez-les pendant une fen\xeatre de maintenance."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"automatisation-du-renouvellement-",children:"Automatisation du renouvellement \ud83e\udd16"}),"\n",(0,t.jsx)(n.p,{children:"Pour \xe9viter de devoir g\xe9rer manuellement le renouvellement des certificats, vous pouvez mettre en place une t\xe2che cron qui v\xe9rifie et renouvelle automatiquement les certificats :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Cr\xe9er un script de renouvellement des certificats\ncat > /usr/local/bin/renew-k8s-certs.sh << \'EOF\'\n#!/bin/bash\n# V\xe9rifier si des certificats expirent dans moins de 30 jours\nEXPIRING_CERTS=$(kubeadm certs check-expiration | grep -B 1 "< 30d" | grep -v "RESIDUAL" | awk \'{print $1}\')\n\nif [ ! -z "$EXPIRING_CERTS" ]; then\n    echo "Renouvellement des certificats qui expirent bient\xf4t..."\n    sudo kubeadm certs renew all\n    sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n    sudo chown $(id -u):$(id -g) $HOME/.kube/config\n    sudo systemctl restart kubelet\n    echo "Certificats renouvel\xe9s avec succ\xe8s !"\nelse\n    echo "Aucun certificat n\'expire dans moins de 30 jours."\nfi\nEOF\n\nchmod +x /usr/local/bin/renew-k8s-certs.sh\n\n# Ajouter une t\xe2che cron pour ex\xe9cuter le script une fois par mois\n(crontab -l 2>/dev/null; echo "0 0 1 * * /usr/local/bin/renew-k8s-certs.sh >> /var/log/renew-k8s-certs.log 2>&1") | crontab -\n'})}),"\n",(0,t.jsx)(n.h2,{id:"bonnes-pratiques-\ufe0f",children:"Bonnes pratiques \ud83d\udee1\ufe0f"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Planification pr\xe9ventive"})," : Renouvelez vos certificats au moins un mois avant leur expiration pour \xe9viter toute interruption de service."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Sauvegarde"})," : Avant de proc\xe9der au renouvellement, effectuez une sauvegarde du r\xe9pertoire ",(0,t.jsx)(n.code,{children:"/etc/kubernetes/pki"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Documentation"})," : Documentez clairement les dates de renouvellement et mettez en place des alertes pour \xeatre notifi\xe9 avant l'expiration."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Test"})," : Testez le processus de renouvellement dans un environnement de d\xe9veloppement avant de l'appliquer en production."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"conclusion-",children:"Conclusion \ud83c\udfaf"}),"\n",(0,t.jsx)(n.p,{children:"Le renouvellement des certificats est une t\xe2che de maintenance critique pour garantir la s\xe9curit\xe9 et la disponibilit\xe9 de votre cluster Kubernetes. En suivant ce guide, vous pouvez facilement renouveler vos certificats et \xe9viter les probl\xe8mes li\xe9s \xe0 leur expiration."}),"\n",(0,t.jsx)(n.p,{children:"N'oubliez pas que la s\xe9curit\xe9 est un processus continu, et la gestion proactive des certificats fait partie int\xe9grante de la maintenance d'un cluster Kubernetes robuste et s\xe9curis\xe9."})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}}}]);