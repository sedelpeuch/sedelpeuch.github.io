"use strict";(self.webpackChunksedelpeuch_net=self.webpackChunksedelpeuch_net||[]).push([[955],{67956:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var t=r(74848),i=r(28453);const s={title:"Action Runner Controller GitHub",description:"Explication de l'installation et de l'utilisation de l'Action Runner Controller GitHub",tags:["CI/CD","GitHub","Devops"]},l=void 0,o={permalink:"/blog/2024/02/25/04-ci-cd/github-arc",source:"@site/blog/04-ci-cd/2024-02-25-github-arc.md",title:"Action Runner Controller GitHub",description:"Explication de l'installation et de l'utilisation de l'Action Runner Controller GitHub",date:"2024-02-25T00:00:00.000Z",tags:[{inline:!0,label:"CI/CD",permalink:"/blog/tags/ci-cd"},{inline:!0,label:"GitHub",permalink:"/blog/tags/git-hub"},{inline:!0,label:"Devops",permalink:"/blog/tags/devops"}],readingTime:3.21,hasTruncateMarker:!0,authors:[],frontMatter:{title:"Action Runner Controller GitHub",description:"Explication de l'installation et de l'utilisation de l'Action Runner Controller GitHub",tags:["CI/CD","GitHub","Devops"]},unlisted:!1,prevItem:{title:"Architecture compl\xe8te",permalink:"/blog/2024/03/03/04-ci-cd/exemple"},nextItem:{title:"Le concept de conteneur Docker",permalink:"/blog/2024/02/18/03-containerization/docker"}},a={authorsImageUrls:[]},c=[{value:"GitHub ARC",id:"github-arc",level:2},{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Installation rapide",id:"installation-rapide",level:2},{value:"Usage",id:"usage",level:2},{value:"Authentification",id:"authentification",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Docker cache",id:"docker-cache",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Actions Runner Controller (ARC) est un op\xe9rateur de Kubernetes qui orchestre et g\xe8re les runners auto-h\xe9berg\xe9s pour les actions GitHub."}),"\n",(0,t.jsx)(n.h2,{id:"github-arc",children:"GitHub ARC"}),"\n",(0,t.jsx)(n.p,{children:"Les runners auto-h\xe9berg\xe9s offrent un contr\xf4le total sur l'environnement d'ex\xe9cution, permettant de personnaliser les configurations et d'optimiser les performances selon les besoins sp\xe9cifiques. Ils sont \xe9galement plus rentables \xe0 long terme, car ils n'entra\xeenent pas de co\xfbts suppl\xe9mentaires li\xe9s \xe0 l'utilisation des ressources de GitHub. Cependant, ils n\xe9cessitent une maintenance r\xe9guli\xe8re et une gestion de la s\xe9curit\xe9 pour garantir leur bon fonctionnement et leur protection contre les menaces potentielles. En revanche, GitHub Actions Runner Controller (ARC) est une solution \xe9volutive g\xe9r\xe9e par GitHub, qui permet de g\xe9rer automatiquement les runners dans un environnement Kubernetes. ARC offre une gestion simplifi\xe9e et une mise \xe0 l'\xe9chelle automatique des runners en fonction des besoins, ce qui est id\xe9al pour les grandes organisations avec des charges de travail variables. Cependant, l'utilisation de GitHub ARC peut entra\xeener des co\xfbts plus \xe9lev\xe9s pour les d\xe9ploiements \xe0 grande \xe9chelle, et les utilisateurs ont moins de contr\xf4le sur l'environnement d'ex\xe9cution par rapport aux runners auto-h\xe9berg\xe9s."}),"\n",(0,t.jsx)(n.p,{children:"Avec ARC, il est possible de cr\xe9er des ensembles de runners qui \xe9voluent automatiquement en fonction du nombre de workflows ex\xe9cut\xe9s dans votre d\xe9p\xf4t, organisation ou entreprise."}),"\n",(0,t.jsx)(n.p,{children:"Le diagramme suivant illustre l'architecture du mode Scaleset Runner Autoscaling d'Arc."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners-with-actions-runner-controller/quickstart-for-actions-runner-controller",children:"Documentation compl\xe8te"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"alt text",src:r(52158).A+"",width:"1440",height:"729"})}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsxs)(n.p,{children:["Sur GitHub les ARC sont identifi\xe9s par leur nom d'installation. Il est important de choisir un nom unique pour chaque installation. De plus pour simplifier l'\xe9criture des workflows il est consill\xe9 de g\xe9rer les runners par des groupes de runners. La cl\xe9 ",(0,t.jsx)(n.code,{children:"runs-on"})," des jobs des workflows doit \xeatre \xe9gale \xe0 un groupe de runners."]})}),"\n",(0,t.jsx)(n.h2,{id:"pr\xe9requis",children:"Pr\xe9requis"}),"\n",(0,t.jsx)(n.p,{children:"Pour utiliser l'ARC, il est n\xe9cessaire de disposer des \xe9l\xe9ments suivants :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Un cluster Kubernetes"}),"\n",(0,t.jsx)(n.li,{children:"Helm 3.0 ou version ult\xe9rieure"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"installation-rapide",children:"Installation rapide"}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["La suite du guide permet de rapidement installer ARC. Les diff\xe9rents concepts et la configuration avanc\xe9e ne sont pas abord\xe9s. Pour une installation plus compl\xe8te, regarder la ",(0,t.jsx)(n.a,{href:"https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners-with-actions-runner-controller/quickstart-for-actions-runner-controller",children:"documentation officielle"}),"."]})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Le pod de contr\xf4le est en charge de la gestion des pods de runner. Il s'occupe de la cr\xe9ation, de la mise \xe0 l'\xe9chelle et de la suppression des pods de runner."}),"\n",(0,t.jsx)(n.li,{children:"Le pod de runner est d\xe9di\xe9 \xe0 l'ex\xe9cution des workflows GitHub Actions. Il se compose de deux conteneurs : un conteneur DinD et un conteneur runner. Le conteneur DinD fournit un environnement d'ex\xe9cution Docker pour le conteneur runner. Le conteneur runner est utilis\xe9 pour ex\xe9cuter les workflows GitHub Actions."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(n.p,{children:"Pour lancer le pod de contr\xf4le :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'NAMESPACE="arc-systems"\nhelm install arc \\\n    --namespace "${NAMESPACE}" \\\n    --create-namespace \\\n    oci://ghcr.io/actions/actions-runner-controller-charts/gha-runner-scale-set-controller\n'})}),"\n",(0,t.jsx)(n.p,{children:"Pour lancer le pod de runner :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'INSTALLATION_NAME="elegantencoder"\nNAMESPACE="arc-runners"\nhelm install "${INSTALLATION_NAME}" \\\n    --namespace "${NAMESPACE}" \\\n    --create-namespace \\\n    -f value.yaml \\\n    oci://ghcr.io/actions/actions-runner-controller-charts/gha-runner-scale-set;\n'})}),"\n",(0,t.jsx)(n.h2,{id:"authentification",children:"Authentification"}),"\n",(0,t.jsx)(n.p,{children:"Pour que le pod de contr\xf4le puisse cr\xe9er des pods de runner, il faut lui donner les droits n\xe9cessaires. Pour cela, il faut cr\xe9er un secret contenant un token d'authentification. Les diff\xe9rents \xe9l\xe9ments proviennent de l'enregistrement d'une application GitHub au niveau de l'organisation concern\xe9e."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl create secret generic pre-defined-secret \\\n   --namespace=arc-runners \\\n   --from-literal=github_app_id=xxx \\\n   --from-literal=github_app_installation_id=xxx \\\n   --from-literal=github_app_private_key='xxx'\n"})}),"\n",(0,t.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,t.jsx)(n.p,{children:"Dashboard Helm"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"helm dashboard --bind 0.0.0.0\n"})}),"\n",(0,t.jsx)(n.p,{children:"Portainer"}),"\n",(0,t.jsx)(n.h2,{id:"docker-cache",children:"Docker cache"}),"\n",(0,t.jsx)(n.p,{children:"Nous avons rencontr\xe9 un probl\xe8me de lenteur lors de la construction des images Docker. Pour y rem\xe9dier, nous avons mis en place la mutualisation des couches des images Docker entre les diff\xe9rents pods et l'h\xf4te. Cela implique la cr\xe9ation d'un volume partag\xe9 entre les diff\xe9rents pods et l'h\xf4te. Ces volumes sont mont\xe9s dans le conteneur DinD du pod qui les utilise pour fournir les images Docker au conteneur du runner. Chaque pod de runner contient un conteneur DinD qui est utilis\xe9 pour construire les images Docker."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- name: overlay2\n    hostPath:\n    path: /var/lib/docker/overlay2\n- name: image-overlay2\n    hostPath:\n    path: /var/lib/docker/image/overlay2\n"})})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},52158:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/arc-f0e0447cc92a8d4f3224674d4da3736d.png"},28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var t=r(96540);const i={},s=t.createContext(i);function l(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);