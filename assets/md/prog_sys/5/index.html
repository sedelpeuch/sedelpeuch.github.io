<!DOCTYPE html>
<html lang="en-Us"><head>
  <meta charset="utf-8">
  <title>Appels système du Système de Gestion de Fichier</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Semestre 7 de l&#39;ENSEIRB-MATEMECA">
  <meta name="author" content="Sébastien">
  <meta name="generator" content="Hugo 0.74.3" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://Sdelpeuch.github.io/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="https://Sdelpeuch.github.io/plugins/Ionicons/css/ionicons.min.css">
  
  <link rel="stylesheet" href="https://Sdelpeuch.github.io/plugins/magnific-popup/magnific-popup.css">
  
  <link rel="stylesheet" href="https://Sdelpeuch.github.io/plugins/slick/slick.css">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://Sdelpeuch.github.io/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://Sdelpeuch.github.io/images/favicon.png" type="image/x-icon">
  <link rel="icon" href="https://Sdelpeuch.github.io/images/favicon.png" type="image/x-icon">

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->

<header class="navigation">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        
        <nav class="navbar">
          
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navigation">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
              <img src="https://Sdelpeuch.github.io/images/telechargement.png" alt="Semestre 8" width="65px" class="img-responsive">
            </a>
          </div>
          
          <div class="collapse navbar-collapse" id="navigation">
            <ul class="nav navbar-nav navbar-right">
              
              
              <li><a href="/">Accueil</a></li>
              
              
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                  aria-expanded="false">Semestre 8 <span class="ion-ios-arrow-down"></span></a>
                <ul class="dropdown-menu">
                  
                  <li><a href="/semestre8/apptcp-ip">Applications TCP/IP</a></li>
                  
                  <li><a href="/semestre8/complex">Calculabilité</a></li>
                  
                  <li><a href="/semestre8/crypto">Cryptologie</a></li>
                  
                  <li><a href="/semestre8/ia">Intelligence artificielle</a></li>
                  
                  <li><a href="/semestre8/maker">Maker</a></li>
                  
                  <li><a href="/semestre8/qualite">Qualité</a></li>
                  
                  <li><a href="/semestre8/robotique">Robotique</a></li>
                  
                  <li><a href="/semestre8/se">Sys Exploitation</a></li>
                  
                  <li><a href="/semestre8/jeux">Théorie des jeux</a></li>
                  
                  <li><a href="/semestre8/projet">Évaluation des projets</a></li>
                  
                </ul>
              </li>
              
              
              
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                  aria-expanded="false">Semestre 7 <span class="ion-ios-arrow-down"></span></a>
                <ul class="dropdown-menu">
                  
                  <li><a href="/semestre7/compilation/">Compilation</a></li>
                  
                  <li><a href="/semestre7/gl">Génie Logiciel</a></li>
                  
                  <li><a href="/semestre7/poo">POO</a></li>
                  
                  <li><a href="/semestre7/cpp">Programmation C&#43;&#43;</a></li>
                  
                  <li><a href="/semestre7/quantique">Quantique</a></li>
                  
                  <li><a href="/semestre7/bdd">SGBD</a></li>
                  
                  <li><a href="/semestre7/prog_sys/">Système</a></li>
                  
                  <li><a href="/semestre7/tcp">TCP/IP</a></li>
                  
                </ul>
              </li>
              
              
              
              <li><a href="/semestre6/semestre_6">Semestre 6</a></li>
              
              
              
              <li><a href="/semestre5/semestre_5">Semestre 5</a></li>
              
              
              
              <li><a href="/contact">Contact</a></li>
              
              
              
              <li><a href="/cpbx">CPBx</a></li>
              
              

              
            </ul>
          </div>
        </nav>
      </div>
    </div>
  </div>
</header>

<section class="page-title bg-2" style="background-image: url('https://Sdelpeuch.github.io/images/banner/info.jpg');">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="block">
          <h1>Appels système du Système de Gestion de Fichier</h1>
          <p></p>
        </div>
      </div>
    </div>
  </div>
</section>


<section class="page-wrapper">
	<div class="container">
		<div class="row">
			<div class="col-md-8">
				<div class="post post-single">
					<h2 class="post-title">Appels système du Système de Gestion de Fichier</h2>
					<div class="post-meta">
						<ul>
              <li><i class="ion-calendar"></i> November 11, 2020</li>
              
              
              
              
              
              
              <li><i class="ion-pricetags"></i> 
                
                <a href="/tags/programmation%20syst%c3%a8me">Programmation système</a>
								
              </li>
            </ul>
					</div>
					
					
					
					<div class="post-content post-excerpt">
						<p>Les appels système d&rsquo;entrées-sorties ou entrées-sorties de bas niveau sont
rudimentaires mais polymorphes, en effet c&rsquo;est eux qui permettent d&rsquo;écrire des
programmes indépendamment des supports physiques sur lesquels se font les
entrées/sorties et de pouvoir facilement changer les supports physiques associés
a une entrée-sortie. Les appels système du système de gestion de fichier sont :</p>
<ul>
<li><strong>open/creat</strong> ouverture/création d&rsquo;un fichier</li>
<li><strong>read/write</strong> lecture/écriture sur un fichier ouvert</li>
<li><strong>lseek</strong> déplacement du pointeur de fichier</li>
<li><strong>dup,dup2</strong> copie d&rsquo;ouverture de fichier</li>
<li><strong>close</strong> fermeture d&rsquo;un fichier</li>
<li><strong>mount</strong> changement d&rsquo;un disque</li>
<li><strong>mknode</strong> création d&rsquo;un inode de fichier spécial</li>
<li><strong>pipe</strong> création d&rsquo;un tube</li>
<li><strong>fcntl</strong> manipulation des caractéristiques des ouvertures de fichiers</li>
</ul>
<p>Les appels système sont réalisés par le noyau et retournent -1 en cas d&rsquo;erreur.</p>
<h2 id="open"><code>open</code></h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;fcntl.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">open</span>(<span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>ref, <span style="color:#66d9ef">int</span> mode, <span style="color:#66d9ef">int</span> perm);
</code></pre></div><p>Ouverture du fichier de référence (absolue ou relative à &ldquo;.&quot;). Le mode
d&rsquo;ouverture est une conjonction des masques suivants :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">O_RDONLY
O_WRONLY
O_RDWR
O_NDELAY
O_APPEND
O_CREAT
O_TRUNC
O_EXCL
</code></pre></div><p>La paramètre permission n&rsquo;a de sens qu&rsquo;à la création du fichier, il permet de
positionner les valeurs du champ <code>mode</code> de l&rsquo;inode. Les droits effectivement
positionnés dépendant de la valeur umask, grâce à la formule <code>droit = perm &amp; ~ umask</code>. La valeur par défaut de umask est 066. La valeur de retour de <code>open</code> est
le numéro dans la table de descripteur du processus qui a été utilisé par
<code>open</code>. Ce numéro est appelé descripteur de l&rsquo;ouverture. Ce descripteur est
utilisé dans les autres appels système pour spécifier l&rsquo;ouverture de fichier sur
laquelle on veut travailler et -1 en cas d&rsquo;échec de l&rsquo;ouverture.</p>
<h3 id="déroulement-interne-dun-appel-de-open">Déroulement interne d&rsquo;un appel de <code>open</code></h3>
<ol>
<li>Le système détermine l&rsquo;inode du fichier référence</li>
<li>Soit l&rsquo;inode est dans la table des inodes en mémoire. Soit il alloue une
entrée et recopie l&rsquo;inode du disque.</li>
<li>Le système vérifie les droits d&rsquo;accès dans le mode demandé.</li>
<li>Il alloue une entrée dans la table des fichiers ouverts du système, et
positionne le curseur de lecture écriture dans le fichier (offset = 0, sauf
dans le cas du mode <code>O_APPEND</code> offset= taille du fichier).</li>
<li>Le système alloue une place dans la table des descripteurs <code>_iob</code> du fichier.</li>
<li>Il renvoie au processus le numéro de descripteur, c&rsquo;est à dire le numéro de
l&rsquo;entrée qu&rsquo;il vient d&rsquo;allouer dans le table <code>_iob</code>.</li>
</ol>
<p>Si l&rsquo;opération a échoué dans une des étapes le systèmé renvoie -1.</p>
<h2 id="creat"><code>creat</code></h2>
<p>Création d&rsquo;un fichier et ouverture en écriture <code>int creat(char* reference, int permissions);</code>. Le système détermine l&rsquo;inode du catalogue où l&rsquo;on demande la
création du fichier.</p>
<ul>
<li>Si il existe déjà une inode pour le fichier
<ul>
<li>Le noyau lit l&rsquo;inode en question (allocation dans la table des inodes en
mémoire), vérifie que c&rsquo;est une fichier ordinaire autorisé en écriture par
les propriétaire effectif du processus, sinon échec.</li>
<li>Le système libère les blocs de données et réduit la taille du fichier à
zéro, il ne modifie pas les droits qu&rsquo;avait le fichier antérieurement</li>
</ul>
</li>
<li>Si n&rsquo;existait pas d&rsquo;inode pour le fichier
<ul>
<li>Le système teste les droit en écriture sur le catalogue</li>
<li>Il alloue une nouvelle inode</li>
<li>Il alloue une nouvelle entrée dans la  table des inodes en mémoire</li>
</ul>
</li>
</ul>
<h2 id="read"><code>read</code></h2>
<p><code>int nbcharlus = read(int d, char* tampon, int nbalire)</code></p>
<ul>
<li><strong>descripteur</strong> entrée de la table des descripteurs correspondante au fichier
dans lequel doit être effectuée la lecture (fourni par <code>open</code>)</li>
<li><strong>nbalire</strong> nombre de caractère à lire dans le fichier</li>
<li><strong>tampon</strong> un tableau de caractères alloué par l&rsquo;utilisateur. Les caractères
lus sont placés dans ce tampon</li>
<li><strong>nbcharlus</strong> nombre de caractères effectivement lus, ou -1 en cas d&rsquo;échec de
l&rsquo;appel système, la fin de fichier est atteinte quand le nombre de caractères
lus est inférieur au nombre de caractères demandés.</li>
</ul>
<p>Déroulement :</p>
<ol>
<li>Vérification du descripteur -&gt; accès aux tables système</li>
<li>Droits (mode adéquat)</li>
<li>Grâce à l&rsquo;inode le système obtient les adresses du bloc contenant les données
à lire. Le système effectue la lecture de ces blocs</li>
<li>Le système recopie les données du buffer cache vers le tampon de
l&rsquo;utilisateur</li>
<li>Le curseur dans le fichier est remit à jour dans l&rsquo;entrée de la table des
fichiers ouverts</li>
<li>Le système renvoie le nombre de caractères effectivement lus</li>
</ol>
<h2 id="write"><code>write</code></h2>
<p><code>int nbcecrits = write(int desc, char* tampon, int nbaecrire);</code> Même déroulement
que <code>read</code> mais avec une allocation éventuelle de bloc-disque dans le cas d&rsquo;un
ajout au-delà de la fin du fihcier. Dans le cas où l&rsquo;appel concerne une
périphérique en mode caractère : le système active la fonction <code>write</code>
(réciproquement <code>read</code> pour une lecture) du périphérique qui utilise directement
l&rsquo;adresse du tampon utilisateur.</p>
<p>Remarquons ici encore le polymorphisme de ces deux appels système qui permet de
lire et d&rsquo;écrire sur une grande variété de périphériques en utilisant une seule
syntaxe. Le code C utilisant l&rsquo;appel système marchera donc indifféremment sur
tous les types de périphériques qui sont définis dans le système de fichier. Par
exemple, il existe deux périphériques &ldquo;logiques&rdquo; qui sont <code>/dev/null</code> et
<code>/dev/zero</code> (que l&rsquo;on ne trouve pas sur toutes les machines). Le premier est
toujours vide en lecture et les écritures n&rsquo;ont aucun effet (il est donc
possible de déverser n&rsquo;importe quoi sur ce périphérique). Le deuxième fournit en
lecture une infinité de zéro et n&rsquo;accepte pas l&rsquo;écriture.</p>
<h2 id="lseek"><code>lseek</code></h2>
<p><code>off_t lseek(int d, off_t offset, int direction)</code> <code>lseek</code> permet de déplacer le
curseur de fichier dans la <strong>table des fichiers ouverts</strong> du système, offset est
un déplacement en octets, d est le descripteur et direction une des trois macros
<code>L_SET, L_INCR, L_XTND</code>.</p>
<ul>
<li><code>L_SET</code> la nouvelle position est offset sauf si offset est supérieur à la
taille du fichier, auquel cas la position est égale à la taille du fichier. Si
l&rsquo;offset est négatif, alors la position est zéro.</li>
<li><code>L_INCR</code> la position courante est incrémentée de <code>offset</code> place</li>
<li><code>L_XTND</code> déplacement par rapport à la fin du fichier, cette option permet
d&rsquo;augmenter la taille du fichier</li>
</ul>
<p>La valeur de retour de <code>lseek</code> est la nouvelle position du curseur dans le
fichier ou -1 si l&rsquo;appel a échoué.</p>
<h2 id="dup-et-dup2"><code>dup</code> et <code>dup2</code></h2>
<p>Les appls <code>dup</code> et <code>dup2</code> permettent de dupliquer des entrées de la table des
descripteurs du processus. <code>int descripteur2 = dup(int descripteur1);</code></p>
<ol>
<li>vérification que descripteur est le numéro d&rsquo;une entrée non nulle</li>
<li>recopie dans la première entrée libre du table des descriptuers l&rsquo;entrée
correspondant à descripteur1.</li>
<li>le compteur de descripteurs de l&rsquo;entrée associée à descripteur1 dans la table
des ouvertures de fichiers est incrémenté</li>
<li>renvoi de l&rsquo;indice dans la table des descripteurs de l&rsquo;entrée nouvellement
allouée.</li>
</ol>
<h2 id="close"><code>close</code></h2>
<p>Fermeture d&rsquo;un fichier <code>int ok = close(descripteur);</code></p>
<ol>
<li>si descripteur n&rsquo;est pas un descripteur valide retour -1</li>
<li>l&rsquo;entrée d&rsquo;indice descripteur de la table est libérée</li>
<li>le compteur de l&rsquo;entrée de la table des fichiers ouvert associé à descripteur
est décrémenté.</li>
</ol>

					</div>
					<div class="post-comments">
						
					</div>
				</div>
			</div>
      <div class="col-md-4">
        <aside class="sidebar">







































<div class="widget widget-latest-post">
    <h4 class="widget-title">Derniers cours</h4>
    
    <div class="media">
      <div class="media-body">
        <h4 class="media-heading"><a href="https://Sdelpeuch.github.io/assets/md/ia/1/"></a></h4>
        <h5>[IA]</h5>
        <p></p>
      </div>
    </div>
    
    <div class="media">
      <div class="media-body">
        <h4 class="media-heading"><a href="https://Sdelpeuch.github.io/assets/md/projet/1/">Le système d&#39;organisation comptable</a></h4>
        <h5>[Évaluation des projets et maîtrise des coûts]</h5>
        <p>Les obligations comptables et fiscales de …</p>
      </div>
    </div>
    
    <div class="media">
      <div class="media-body">
        <h4 class="media-heading"><a href="https://Sdelpeuch.github.io/assets/md/projet/2/">Le système d&#39;organisation comptable</a></h4>
        <h5>[Évaluation des projets et maîtrise des coûts]</h5>
        <p>Un projet est un ensemble finalisé d’activités et …</p>
      </div>
    </div>
    
    <div class="media">
      <div class="media-body">
        <h4 class="media-heading"><a href="https://Sdelpeuch.github.io/assets/md/jeux/5/">Cours 5</a></h4>
        <h5>[Jeux]</h5>
        <p>Réalisation d&rsquo;un algorithme de complexité en …</p>
      </div>
    </div>
    
    <div class="media">
      <div class="media-body">
        <h4 class="media-heading"><a href="https://Sdelpeuch.github.io/assets/md/se/4/">Concurrence et synchronisation</a></h4>
        <h5>[SE]</h5>
        <p>Les systèmes d&rsquo;exploitations actuels …</p>
      </div>
    </div>
    
    <div class="media">
      <div class="media-body">
        <h4 class="media-heading"><a href="https://Sdelpeuch.github.io/assets/md/se/5/">Gestion du temps</a></h4>
        <h5>[SE]</h5>
        <p>La notion de temps est critique pour …</p>
      </div>
    </div>
    
  </div>
</aside>


      </div>
		</div>
	</div>
</section>

<footer class="footer">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<div class="footer-manu">
					<ul>
            
            <li><a href="https://Sdelpeuch.github.io/about">Semestre 7</a></li>
            
            <li><a href="https://Sdelpeuch.github.io/contact">Semestre 6</a></li>
            
            <li><a href="https://Sdelpeuch.github.io/project">Semestre 5</a></li>
            
            <li><a href="https://Sdelpeuch.github.io/cpbx">CPBx</a></li>
            
					</ul>
				</div>
				<p class="copyright">Copyright © 2020 <a href="https://themefisher.com">Themefisher</a> All Rights Reserved</p>
			</div>
		</div>
	</div>
</footer>



<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcABaamniA6OL5YvYSpB3pFMNrXwXnLwU&amp;libraries=places"></script>




<script src="https://Sdelpeuch.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://Sdelpeuch.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://Sdelpeuch.github.io/plugins/slick/slick.min.js"></script>

<script src="https://Sdelpeuch.github.io/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>

<script src="https://Sdelpeuch.github.io/plugins/shuffle/shuffle.min.js"></script>

<script src="https://Sdelpeuch.github.io/plugins/google-map/gmap.js"></script>




<script src="https://Sdelpeuch.github.io/js/script.min.js"></script>







<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	This site uses cookies. By continuing to use this website, you agree to their use. <span id="js-cookie-button" class="btn btn-main btn-solid-border">I Accept</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires:  2 
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>


<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
</body>

</html>